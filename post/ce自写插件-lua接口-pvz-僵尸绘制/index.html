<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="本文介绍如何反汇编硬追基址编写一个CE插件，提供LUA接口，以实现在PC版植物大战僵尸游戏中绘制僵尸的功能。其中，该插件使用C++编写，通过CE提供的LUA接口实现与游戏的交互"><meta name=keywords content="CE插件，LUA接口，PVZ，僵尸绘制，游戏交互，C++,反汇编硬追基址"><title>CE自写插件反汇编硬追基址提供LUA接口实现pvz僵尸绘制</title><link rel=canonical href=https://blog.xpdbk.com/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/><link rel=stylesheet href=/scss/style.min.4abc0166ff4ffe916115760ea25e9d237708854e3a46f1ca649e667d5d2528a1.css><script>function addLoadEvent(e){var t=window.onload;typeof window.onload!="function"?window.onload=e:window.onload=function(){t(),e()}}</script><meta property="og:title" content="CE自写插件反汇编硬追基址提供LUA接口实现pvz僵尸绘制"><meta property="og:description" content="本文介绍如何反汇编硬追基址编写一个CE插件，提供LUA接口，以实现在PC版植物大战僵尸游戏中绘制僵尸的功能。其中，该插件使用C++编写，通过CE提供的LUA接口实现与游戏的交互"><meta property="og:url" content="https://blog.xpdbk.com/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/"><meta property="og:site_name" content="LEl_FENG的博客"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="CE修改器"><meta property="article:tag" content="反汇编"><meta property="article:published_time" content="2023-07-17T21:20:43+07:00"><meta property="article:modified_time" content="2024-01-01T05:59:18+00:00"><meta property="og:image" content="https://blog.xpdbk.com/img/default.webp"><meta name=twitter:site content="@HuaweiH45278254"><meta name=twitter:creator content="@HuaweiH45278254"><meta name=twitter:title content="CE自写插件反汇编硬追基址提供LUA接口实现pvz僵尸绘制"><meta name=twitter:description content="本文介绍如何反汇编硬追基址编写一个CE插件，提供LUA接口，以实现在PC版植物大战僵尸游戏中绘制僵尸的功能。其中，该插件使用C++编写，通过CE提供的LUA接口实现与游戏的交互"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.xpdbk.com/img/default.webp"><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-F7BV1R4CWR"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F7BV1R4CWR",{anonymize_ip:!1})}</script><meta name=referrer content="no-referrer"><style>.blur{color:transparent;text-shadow:0 0 8px rgba(0,0,0,.5)}.blur:hover{color:transparent;text-shadow:0 0 0 #000}.shady{color:#000;font-weight:700;box-shadow:0 -20px #000 inset;transition:all .3s ease}.shady:hover{font-weight:700;color:#fff;box-shadow:0 -20px #000 inset}</style><script>function confirmLink(e){var t=e.href,n=`您即将离开当前网站,前往:

${t}

确定继续前往?`;confirm(n)&&window.open(t)}document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll('a[href^="http"]');for(let t of e)/^https:\/\/blog\.xpdbk\.com/.test(t.href)||t.addEventListener("click",e=>{e.preventDefault(),confirmLink(t)})})</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jolg1fwpj8")</script><link rel=apple-touch-icon sizes=180x180 href=https://cdn.jsdelivr.net/gh/1x000/zdzy/tp/avatar.jpg></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><div id=article-toolbar style=position:sticky;top:5px;z-index:1000><a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>返回</span></a></div><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#硬追前言>硬追前言：</a></li><li><a href=#事前准备>事前准备</a></li><li><a href=#教程内容>教程内容</a></li><li><a href=#找到僵尸血量>找到僵尸血量</a></li><li><a href=#开始反汇编追踪之旅>开始反汇编追踪之旅</a></li><li><a href=#作业>作业</a></li><li><a href=#总结注意事项>总结(注意事项)</a></li><li><a href=#个人感言无关技术可跳过>个人感言（无关技术，可跳过）</a></li><li><a href=#上篇前言>上篇前言：</a></li><li><a href=#效果图>效果图</a></li><li><a href=#事前准备-1>事前准备</a></li><li><a href=#需要知道的pvz数据>需要知道的pvz数据</a></li><li><a href=#教程内容-1>教程内容</a></li><li><a href=#编写我们的lua绘制脚本>编写我们的LUA绘制脚本</a><ol><li><a href=#tip遇到不懂的方法或属性可以查看下方提供的lua参考文档>tip:<strong>遇到不懂的方法或属性可以查看下方提供的LUA参考文档</strong></a></li><li><a href=#创建一个透明窗口>创建一个透明窗口</a></li><li><a href=#在透明窗口里绘制>在透明窗口里绘制</a></li><li><a href=#添加时钟实时绘制绘制模板>添加时钟实时绘制(绘制模板)</a></li><li><a href=#lua和asm混用>lua和asm混用</a></li><li><a href=#修改绘制模板实现pvz僵尸血量绘制需要加载插件>修改绘制模板实现pvz僵尸血量绘制（需要加载插件）</a><ol><li><a href=#不使用插件插件使用lua间接调用>不使用插件插件使用LUA间接调用</a></li></ol></li></ol></li><li><a href=#lua参考文档>LUA参考文档</a></li><li><a href=#lua文档查询>LUA文档查询</a></li><li><a href=#lua常用函数介绍>LUA常用函数介绍</a><ol><li><a href=#数据读取相关>数据读取相关</a></li><li><a href=#绘制相关类参考文档>绘制相关类(参考文档)</a><ol><li><a href=#form-class>Form Class</a></li><li><a href=#custmcontrol-class>CustmControl class</a></li><li><a href=#wincontrol-class>WinControl Class</a></li><li><a href=#control-class>Control Class</a></li><li><a href=#canvas-class>Canvas Class</a></li><li><a href=#pen-class>Pen Class</a></li><li><a href=#brush-class>Brush Class</a></li><li><a href=#font-class>Font Class</a></li></ol></li><li><a href=#时钟类参考文档>时钟类（参考文档）</a><ol><li><a href=#timer-class>Timer Class</a></li></ol></li><li><a href=#内存流相关类参考文档>内存流相关类（参考文档）</a><ol><li><a href=#memorystream-class>MemoryStream Class</a></li><li><a href=#stream-class>Stream Class</a></li></ol></li><li><a href=#其它绘制用到的方法参考方法>其它绘制用到的方法（参考方法）</a><ol><li><a href=#createform>createForm</a></li><li><a href=#getscreenheight>getScreenHeight</a></li><li><a href=#getscreenwidth>getScreenWidth</a></li><li><a href=#createtimer>createTimer</a></li><li><a href=#findwindow>findWindow</a></li><li><a href=#getwindowcaption>getWindowCaption</a></li></ol></li><li><a href=#补充方法可以间接调用win32-api等>补充方法(可以间接调用Win32 API等)</a><ol><li><a href=#creatememorystream>createMemoryStream</a></li><li><a href=#executecodelocalex>executeCodeLocalEx</a></li><li><a href=#getaddress>getAddress</a></li></ol></li></ol></li><li><a href=#注意事项>注意事项</a></li><li><a href=#个人感言及附件下载>个人感言及附件下载</a></li><li><a href=#下篇前言>下篇前言：</a></li><li><a href=#事前准备-2>事前准备</a></li><li><a href=#教程内容-2>教程内容</a></li><li><a href=#vs2015的安装>VS2015的安装</a><ol><li><a href=#插件编译环境>插件编译环境</a></li></ol></li><li><a href=#plugin-源码解析>Plugin 源码解析</a><ol><li><a href=#源码结构>源码结构</a></li><li><a href=#需要用到的静态库文件>需要用到的静态库文件</a></li><li><a href=#编译lib静态库文件非必须>编译lib静态库文件(非必须)</a><ol><li><a href=#生成lua53-64lib>生成lua53-64.lib</a></li><li><a href=#生成lua53-32lib>生成lua53-32.lib</a></li></ol></li><li><a href=#编译example-c插件>编译example-c插件</a></li><li><a href=#源码解析>源码解析</a><ol><li><a href=#导出函数说明>导出函数说明</a></li><li><a href=#导出函数具体分析>导出函数具体分析</a></li><li><a href=#在ce-lua中调用插件提供的函数>在CE LUA中调用插件提供的函数</a></li></ol></li></ol></li><li><a href=#开发自己的ce-plugin>开发自己的CE Plugin</a><ol><li><a href=#创建项目>创建项目</a></li><li><a href=#设置项目属性>设置项目属性</a></li><li><a href=#导入ce相关文件>导入CE相关文件</a></li><li><a href=#添加dll入口函数>添加DLL入口函数</a></li><li><a href=#添加del导出配置>添加.del导出配置</a></li><li><a href=#编写自己的功能>编写自己的功能</a></li><li><a href=#测试自己的功能>测试自己的功能</a></li></ol></li><li><a href=#总结>总结</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E5%B7%A5%E5%85%B7/ style=background-color:#2ajg2f;color:#fff>工具文章</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/>CE自写插件反汇编硬追基址提供LUA接口实现pvz僵尸绘制</a></h2><h3 class=article-subtitle>本文介绍如何反汇编硬追基址编写一个CE插件，提供LUA接口，以实现在PC版植物大战僵尸游戏中绘制僵尸的功能。其中，该插件使用C++编写，通过CE提供的LUA接口实现与游戏的交互</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>2023-07-17</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20h4L18.5 9.5a1.5 1.5.0 00-4-4L4 16v4"/><path d="M13.5 6.5l4 4"/></svg><time class=article-words>文章字数: 22032 字</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>阅读时长: 44 分钟</time></div></footer></div></header><section class=article-content><section class="toc toc--inline"><h2>目录</h2><div><nav id=TableOfContents><ol><li><a href=#硬追前言>硬追前言：</a></li><li><a href=#事前准备>事前准备</a></li><li><a href=#教程内容>教程内容</a></li><li><a href=#找到僵尸血量>找到僵尸血量</a></li><li><a href=#开始反汇编追踪之旅>开始反汇编追踪之旅</a></li><li><a href=#作业>作业</a></li><li><a href=#总结注意事项>总结(注意事项)</a></li><li><a href=#个人感言无关技术可跳过>个人感言（无关技术，可跳过）</a></li><li><a href=#上篇前言>上篇前言：</a></li><li><a href=#效果图>效果图</a></li><li><a href=#事前准备-1>事前准备</a></li><li><a href=#需要知道的pvz数据>需要知道的pvz数据</a></li><li><a href=#教程内容-1>教程内容</a></li><li><a href=#编写我们的lua绘制脚本>编写我们的LUA绘制脚本</a><ol><li><a href=#tip遇到不懂的方法或属性可以查看下方提供的lua参考文档>tip:<strong>遇到不懂的方法或属性可以查看下方提供的LUA参考文档</strong></a></li><li><a href=#创建一个透明窗口>创建一个透明窗口</a></li><li><a href=#在透明窗口里绘制>在透明窗口里绘制</a></li><li><a href=#添加时钟实时绘制绘制模板>添加时钟实时绘制(绘制模板)</a></li><li><a href=#lua和asm混用>lua和asm混用</a></li><li><a href=#修改绘制模板实现pvz僵尸血量绘制需要加载插件>修改绘制模板实现pvz僵尸血量绘制（需要加载插件）</a><ol><li><a href=#不使用插件插件使用lua间接调用>不使用插件插件使用LUA间接调用</a></li></ol></li></ol></li><li><a href=#lua参考文档>LUA参考文档</a></li><li><a href=#lua文档查询>LUA文档查询</a></li><li><a href=#lua常用函数介绍>LUA常用函数介绍</a><ol><li><a href=#数据读取相关>数据读取相关</a></li><li><a href=#绘制相关类参考文档>绘制相关类(参考文档)</a><ol><li><a href=#form-class>Form Class</a></li><li><a href=#custmcontrol-class>CustmControl class</a></li><li><a href=#wincontrol-class>WinControl Class</a></li><li><a href=#control-class>Control Class</a></li><li><a href=#canvas-class>Canvas Class</a></li><li><a href=#pen-class>Pen Class</a></li><li><a href=#brush-class>Brush Class</a></li><li><a href=#font-class>Font Class</a></li></ol></li><li><a href=#时钟类参考文档>时钟类（参考文档）</a><ol><li><a href=#timer-class>Timer Class</a></li></ol></li><li><a href=#内存流相关类参考文档>内存流相关类（参考文档）</a><ol><li><a href=#memorystream-class>MemoryStream Class</a></li><li><a href=#stream-class>Stream Class</a></li></ol></li><li><a href=#其它绘制用到的方法参考方法>其它绘制用到的方法（参考方法）</a><ol><li><a href=#createform>createForm</a></li><li><a href=#getscreenheight>getScreenHeight</a></li><li><a href=#getscreenwidth>getScreenWidth</a></li><li><a href=#createtimer>createTimer</a></li><li><a href=#findwindow>findWindow</a></li><li><a href=#getwindowcaption>getWindowCaption</a></li></ol></li><li><a href=#补充方法可以间接调用win32-api等>补充方法(可以间接调用Win32 API等)</a><ol><li><a href=#creatememorystream>createMemoryStream</a></li><li><a href=#executecodelocalex>executeCodeLocalEx</a></li><li><a href=#getaddress>getAddress</a></li></ol></li></ol></li><li><a href=#注意事项>注意事项</a></li><li><a href=#个人感言及附件下载>个人感言及附件下载</a></li><li><a href=#下篇前言>下篇前言：</a></li><li><a href=#事前准备-2>事前准备</a></li><li><a href=#教程内容-2>教程内容</a></li><li><a href=#vs2015的安装>VS2015的安装</a><ol><li><a href=#插件编译环境>插件编译环境</a></li></ol></li><li><a href=#plugin-源码解析>Plugin 源码解析</a><ol><li><a href=#源码结构>源码结构</a></li><li><a href=#需要用到的静态库文件>需要用到的静态库文件</a></li><li><a href=#编译lib静态库文件非必须>编译lib静态库文件(非必须)</a><ol><li><a href=#生成lua53-64lib>生成lua53-64.lib</a></li><li><a href=#生成lua53-32lib>生成lua53-32.lib</a></li></ol></li><li><a href=#编译example-c插件>编译example-c插件</a></li><li><a href=#源码解析>源码解析</a><ol><li><a href=#导出函数说明>导出函数说明</a></li><li><a href=#导出函数具体分析>导出函数具体分析</a></li><li><a href=#在ce-lua中调用插件提供的函数>在CE LUA中调用插件提供的函数</a></li></ol></li></ol></li><li><a href=#开发自己的ce-plugin>开发自己的CE Plugin</a><ol><li><a href=#创建项目>创建项目</a></li><li><a href=#设置项目属性>设置项目属性</a></li><li><a href=#导入ce相关文件>导入CE相关文件</a></li><li><a href=#添加dll入口函数>添加DLL入口函数</a></li><li><a href=#添加del导出配置>添加.del导出配置</a></li><li><a href=#编写自己的功能>编写自己的功能</a></li><li><a href=#测试自己的功能>测试自己的功能</a></li></ol></li><li><a href=#总结>总结</a></li></ol></nav></div></section><blockquote><p>本文为转载文，看此文之前请看本站的声明</p><p>仅为技术科普，请勿用于非法用途</p><p>内容未隐讳任何个人、群体、公司。非文学作品，请勿用于阅读理解的练习</p><p>根据《计算机软件保护条例》第十七条，本站所有软件和文章请仅用于学习研究用途</p><p>本站一切资源和文章不代表本站立场，并不代表本站赞同其观点和对其真实性负责</p></blockquote><h2 id=硬追前言>硬追前言：</h2><p>看了很多有关植物大战僵尸的教程，比较少看到用汇编来找基址的，大多是用"找出是什么访问了这个地址"来找的</p><p>但是这种方法存在弊端，一是可能存在多个指针，二是不一定搜的到</p><p>今天给大家带来CE反汇编硬追pvz的僵尸数组头部教程</p><p>适合学习人群：比萌新稍微强一丝丝足矣</p><h2 id=事前准备>事前准备</h2><p>本人使用的工具：CE7.2汉化版（不用在意版本问题） PS：OD什么的不需要啦</p><p>本人使用的游戏：植物大战僵尸原版的汉化版(非年度版)        就是阳光基址是006A9EC0+768+5560的那个</p><h2 id=教程内容>教程内容</h2><h2 id=找到僵尸血量>找到僵尸血量</h2><p>首先瞄准一只普通僵尸，搜索得到它的血量</p><p>PS:普通僵尸的初始血量是270 豌豆射手的攻击是20 （模糊搜索可以找到这些数据）<br><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128193537060.webp width=804 height=656 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128193537060_hu5d6b8eaae283bde8e4f45cc43a230a43_69392_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128193537060_hu5d6b8eaae283bde8e4f45cc43a230a43_69392_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-mage-20210128193537060 class=gallery-image data-flex-grow=122 data-flex-basis=294px></p><p>所以我们先搜270<br><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128193756710.webp width=1308 height=909 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128193756710_huaead7241e72ac8761cdaf0ffe914236e_92310_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128193756710_huaead7241e72ac8761cdaf0ffe914236e_92310_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210128193756710 class=gallery-image data-flex-grow=143 data-flex-basis=345px></p><p>然后命中之后再搜250，过滤得到</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129000559707.webp width=1278 height=54 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129000559707_hu3112bafbdf798ce3799c617a658983c0_4258_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129000559707_hu3112bafbdf798ce3799c617a658983c0_4258_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129000559707 class=gallery-image data-flex-grow=2366 data-flex-basis=5680px></p><p>很轻松地得到这一只僵尸的血量，先把僵尸的血量改成9999（接下来要让它被狠狠地揍，我们好断点追踪），然后右键"找出是什么改写了这个地址"<br><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128194254141.webp width=1094 height=636 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128194254141_hub0f1ae1671367744682b6a52dd056462_43352_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128194254141_hub0f1ae1671367744682b6a52dd056462_43352_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210128194254141 class=gallery-image data-flex-grow=172 data-flex-basis=412px></p><p>接下来点击"显示反汇编程序"即可开启我们的反汇编之旅</p><h2 id=开始反汇编追踪之旅>开始反汇编追踪之旅</h2><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128194429846.webp width=1819 height=1207 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128194429846_hu63f472c40f6bb446196b76f664154eba_256240_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128194429846_hu63f472c40f6bb446196b76f664154eba_256240_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-image-20210128194429846 class=gallery-image data-flex-grow=150 data-flex-basis=361px></p><p>反汇编窗口如上所示，贴上代码:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-NASM data-lang=NASM><span class=line><span class=ln>1</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>131319</span> <span class=o>-</span> <span class=mi>89</span> <span class=nv>BD</span> <span class=nv>C8000000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=p>[</span><span class=nb>ebp</span><span class=o>+</span><span class=mi>000000</span><span class=nv>C8</span><span class=p>],</span><span class=nb>edi</span><span class=err> </span> <span class=err> </span> 
</span></span></code></pre></div><p>从这句我们可以得到ebp+c8这个地址里存的值就是这只僵尸的血量</p><p>于是问题转化为ebp从何而来？</p><p>我们在这里F5下个断点 顺便给这里加上备注<br><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128195008278.webp width=1819 height=1207 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128195008278_hu139dc47c7db0ae8aae41d2c2323ad711_265580_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128195008278_hu139dc47c7db0ae8aae41d2c2323ad711_265580_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-image-20210128195008278 class=gallery-image data-flex-grow=150 data-flex-basis=361px></p><p>然后回到游戏，等待僵尸被攻击后，断下</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129000720679.webp width=2360 height=2012 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129000720679_hu1616a629446d07f3a8e441405052e29b_484466_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129000720679_hu1616a629446d07f3a8e441405052e29b_484466_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129000720679 class=gallery-image data-flex-grow=117 data-flex-basis=281px></p><p>这里我们可以看到EBP=14EE1914  ，暂且记下</p><p>大家都知道代码是从上往下执行的，于是我们以这行代码为起点，向上查找是什么给EBP赋值的</p><p>再贴代码:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-NASM data-lang=NASM><span class=line><span class=ln> 1</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>D0</span> <span class=o>-</span> <span class=mi>83</span> <span class=nv>EC</span> <span class=mi>08</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>sub</span> <span class=nb>esp</span><span class=p>,</span><span class=mi>08</span> <span class=err>{</span> <span class=mi>8</span> <span class=err>}</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>D3</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>44</span> <span class=mi>24</span> <span class=mi>14</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,[</span><span class=nb>esp</span><span class=o>+</span><span class=mi>14</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>D7</span> <span class=o>-</span> <span class=mi>53</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>push</span> <span class=nb>ebx</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err> {这里是函数头部}</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>D8</span> <span class=o>-</span> <span class=mi>55</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>push</span> <span class=nb>ebp</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>D9</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>6</span><span class=nv>C</span> <span class=mi>24</span> <span class=mi>14</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>ebp</span><span class=p>,[</span><span class=nb>esp</span><span class=o>+</span><span class=mi>14</span><span class=p>]</span><span class=err> </span> <span class=err>  </span> <span class=err>   {</span><span class=nb>ebp</span><span class=err>在这里被赋值}</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>DD</span> <span class=o>-</span> <span class=mi>56</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>push</span> <span class=nb>esi</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>DE</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>F0</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>esi</span><span class=p>,</span><span class=nb>eax</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>E0</span> <span class=o>-</span> <span class=mi>83</span> <span class=nv>E6</span> <span class=mi>08</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>and</span> <span class=nb>esi</span><span class=p>,</span><span class=mi>08</span> <span class=err>{</span> <span class=mi>8</span> <span class=err>}</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>E3</span> <span class=o>-</span> <span class=mi>57</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>push</span> <span class=nb>edi</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>E4</span> <span class=o>-</span> <span class=mi>89</span> <span class=mi>74</span> <span class=mi>24</span> <span class=mi>10</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=p>[</span><span class=nb>esp</span><span class=o>+</span><span class=mi>10</span><span class=p>],</span><span class=nb>esi</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>E8</span> <span class=o>-</span> <span class=mi>75</span> <span class=mi>07</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jne</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>F1</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>EA</span> <span class=o>-</span> <span class=nv>C7</span> <span class=mi>45</span> <span class=mi>54</span> <span class=mi>19000000</span><span class=err> </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=p>[</span><span class=nb>ebp</span><span class=o>+</span><span class=mi>54</span><span class=p>],</span><span class=mi>00000019</span> <span class=err>{</span> <span class=mi>25</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>F1</span> <span class=o>-</span> <span class=nv>A8</span> <span class=mi>04</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>test</span> <span class=nb>al</span><span class=p>,</span><span class=mi>04</span> <span class=err>{</span> <span class=mi>4</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>F3</span> <span class=o>-</span> <span class=mi>74</span> <span class=mi>09</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>je</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>FE</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>F5</span> <span class=o>-</span> <span class=mi>6</span><span class=nv>A</span> <span class=mi>00</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>push</span> <span class=mi>00</span> <span class=err>{</span> <span class=mi>0</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>F7</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>C5</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,</span><span class=nb>ebp</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>F9</span> <span class=o>-</span> <span class=nv>E8</span> <span class=mi>52</span><span class=nv>F6FFFF</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>call</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>130950</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1312</span><span class=nv>FE</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>BD</span> <span class=nv>C8000000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>edi</span><span class=p>,[</span><span class=nb>ebp</span><span class=o>+</span><span class=mi>000000</span><span class=nv>C8</span><span class=p>]</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>131304</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>C5</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,</span><span class=nb>ebp</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>131306</span> <span class=o>-</span> <span class=mi>89</span> <span class=mi>7</span><span class=nv>C</span> <span class=mi>24</span> <span class=mi>14</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=p>[</span><span class=nb>esp</span><span class=o>+</span><span class=mi>14</span><span class=p>],</span><span class=nb>edi</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>13130</span><span class=nv>A</span> <span class=o>-</span> <span class=nv>E8</span> <span class=mi>01</span><span class=nv>C4FFFF</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>call</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>12</span><span class=nv>D710</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>13130</span><span class=nv>F</span> <span class=o>-</span> <span class=mi>2</span><span class=nv>B</span> <span class=mi>7</span><span class=nv>C</span> <span class=mi>24</span> <span class=mi>20</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>sub</span> <span class=nb>edi</span><span class=p>,[</span><span class=nb>esp</span><span class=o>+</span><span class=mi>20</span><span class=p>]</span>
</span></span><span class=line><span class=ln>23</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>131313</span> <span class=o>-</span> <span class=mi>89</span> <span class=mi>44</span> <span class=mi>24</span> <span class=mi>1</span><span class=nv>C</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=p>[</span><span class=nb>esp</span><span class=o>+</span><span class=mi>1</span><span class=nv>C</span><span class=p>],</span><span class=nb>eax</span>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>131317</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>C5</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,</span><span class=nb>ebp</span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>131319</span> <span class=o>-</span> <span class=mi>89</span> <span class=nv>BD</span> <span class=nv>C8000000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=p>[</span><span class=nb>ebp</span><span class=o>+</span><span class=mi>000000</span><span class=nv>C8</span><span class=p>],</span><span class=nb>edi</span> <span class=err>{</span> <span class=err>血量被赋值}</span>
</span></span></code></pre></div><p>我们找到了mov ebp,[esp+14] 并认为ebp就是在这里被赋值的，为了验证这一点，我们在这个位置下断点，并断下<br><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129000936360.webp width=2360 height=2012 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129000936360_hudc5b5ed768d3bc00ccdf1996c604cd43_445148_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129000936360_hudc5b5ed768d3bc00ccdf1996c604cd43_445148_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-image-20210129000936360 class=gallery-image data-flex-grow=117 data-flex-basis=281px></p><p>我们可以看到此时的ebp尚且为14，F8单步步过以后果然发现EBP变成了14EE1914   </p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001041030.webp width=2346 height=849 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001041030_hud47480005dba13caeca68c33b264afa3_176422_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001041030_hud47480005dba13caeca68c33b264afa3_176422_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129001041030 class=gallery-image data-flex-grow=276 data-flex-basis=663px></p><p>这时的EBP则转化为了[esp+14]，这时照理来说我们应该重复之前的操作去找esp，但实则不然</p><p>因为：</p><p>（1）ESP：栈指针寄存器(extended stack pointer)，其内存放着一个指针，该指针永远指向系统栈最上面一个栈帧的栈顶。<br>（2）EBP：基址指针寄存器(extended base pointer)，其内存放着一个指针，该指针永远指向系统栈最上面一个栈帧的底部。</p><p>萌新看到这里可能一脸懵逼：这是啥子呀，这里我也不说什么堆栈平衡的话了，通俗来说，ebp和esp都是临时的指针，只有像eax、ebx、edx、esi、edi这类寄存器我们才要向上去找是什么去赋值的，而遇到这种mov ebp,[esp+14]这类的，我们<strong>要去找之前push xxx的xxx,或者在前面直接就有mov [esp+xx],xxx的</strong></p><p>为什么呢：<strong>一个push会让esp减少4</strong>，我们会发现,这里的ebp是[esp+14]得来的，但我们又能看到上面有一个sub esp,08</p><p>也就相当于mov ebp[esp-08+14]即mov ebp[esp+c]，这里主义mov []里面的值是十六进制的，14=16*1+4=20 20-8=12</p><p>不知道进制转换的直接拿计算器算即可<br><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128201024895.webp width=1259 height=1128 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128201024895_hu61cccd1ed84aebf51868bcbf92676088_21986_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128201024895_hu61cccd1ed84aebf51868bcbf92676088_21986_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210128201024895 class=gallery-image data-flex-grow=111 data-flex-basis=267px></p><p>12=4*3 即3个push xxx，是不是感觉有点意义不明☆，<strong>暂且记下</strong></p><p>接着向上找，发现已经到达了函数的头部，于是我们<strong>得到上一层去寻找</strong>了，如何判断到达头部? 看到 ret 还有一串int3就是了</p><p>也可以右键选择当前函数，然后找到选中的第一个，就可以得到函数的头部<br><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128201630955.webp width=1649 height=97 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128201630955_huf48188fe8b1c137acbb8137e6f4d8395_17950_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210128201630955_huf48188fe8b1c137acbb8137e6f4d8395_17950_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210128201630955 class=gallery-image data-flex-grow=1700 data-flex-basis=4080px><br>回到刚才我们的那个mov [ebp+000000C8],edi，下一个断点，下完断点后回到游戏，等游戏再被断下以后,可以用shift+f8执行到返回，也可以一直手动按f8直到遇到一个ret</p><p>这里我用了后面那种方式，得到了：<br><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001324786.webp width=2360 height=2012 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001324786_huc2cf78117f6fe26bebb92a4b4b515fff_425146_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001324786_huc2cf78117f6fe26bebb92a4b4b515fff_425146_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129001324786 class=gallery-image data-flex-grow=117 data-flex-basis=281px></p><p>此时这个pop edi上面的那个call 就是我们刚才那个函数，如果在那个call那里下断，然后F7单步步入就可以进入我们刚才的地方</p><p>然后我们在call这里做个断点,并给它一个标记call1（书签也可以设置一下,避免找不到）</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001446346.webp width=2360 height=2012 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001446346_hu73702e6a269e0f6906b4ed6460539453_425380_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001446346_hu73702e6a269e0f6906b4ed6460539453_425380_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129001446346 class=gallery-image data-flex-grow=117 data-flex-basis=281px></p><p><strong>此时我们发现call之前有3个push，而这里的esi正好是第三个push，而esi的值也"正好"等于之前的14EE1914</strong>   </p><p>所以我们可以知道，之前的mov ebp,[esp+14]，其实就是将esi的值赋给了它，这边主要是说明一下值的由来，其实大家都不难发现之前就是ESI=EBP=14EE1914了</p><p>于是<strong>我们的问题便又变成了</strong>[ebp+c8]->ebp->esi->[esi+c8]</p><p>我们接着向上找ESI是由谁给它赋值的,我们发现上面没有给esi赋值的语句，那会不会是上面的call给esi赋值的呢，有这个可能，但是我们可以在call之前设置断点，发现call之前esi就已经被赋值了，一路往上直到函数头部发现ESI的值都已经是被赋值了，得出结论<strong>是从上一层给我们ESI赋值</strong>的。</p><p>于是我们故技重施，直接在call这里下断点，然后执行到返回,得到:</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001830915.webp width=2353 height=1389 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001830915_hu1ce17a9f4fd2dcee2641fbbda55db4e0_289680_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001830915_hu1ce17a9f4fd2dcee2641fbbda55db4e0_289680_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129001830915 class=gallery-image data-flex-grow=169 data-flex-basis=406px></p><p>贴上代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-NASM data-lang=NASM><span class=line><span class=ln> 1</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E004</span> <span class=o>-</span> <span class=mi>55</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>push</span> <span class=nb>ebp</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E005</span> <span class=o>-</span> <span class=mi>56</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>push</span> <span class=nb>esi</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E006</span> <span class=o>-</span> <span class=mi>57</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>push</span> <span class=nb>edi</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E007</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>F0</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>esi</span><span class=p>,</span><span class=nb>eax</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   {</span><span class=nb>esi</span><span class=err>是由</span><span class=nb>eax</span><span class=err>赋值的}</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E009</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>F9</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>edi</span><span class=p>,</span><span class=nb>ecx</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E00B</span> <span class=o>-</span> <span class=mi>56</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>push</span> <span class=nb>esi</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E00C</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>C7</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,</span><span class=nb>edi</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E00E</span> <span class=o>-</span> <span class=nv>E8</span> <span class=mi>1</span><span class=nv>DFDFFFF</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>call</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>DD30</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E013</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>5</span><span class=nv>F</span> <span class=mi>5</span><span class=nv>C</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>ebx</span><span class=p>,[</span><span class=nb>edi</span><span class=o>+</span><span class=mi>5</span><span class=nv>C</span><span class=p>]</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E016</span> <span class=o>-</span> <span class=mi>83</span> <span class=nv>FB</span> <span class=mi>06</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=nb>ebx</span><span class=p>,</span><span class=mi>06</span> <span class=err>{</span> <span class=mi>6</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E019</span> <span class=o>-</span> <span class=mi>75</span> <span class=mi>21</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jne</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E03C</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E01B</span> <span class=o>-</span> <span class=mi>85</span> <span class=nv>F6</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>test</span> <span class=nb>esi</span><span class=p>,</span><span class=nb>esi</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E01D</span> <span class=o>-</span> <span class=mi>74</span> <span class=mi>1</span><span class=nv>D</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>je</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E03C</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E01F</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>46</span> <span class=mi>24</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,[</span><span class=nb>esi</span><span class=o>+</span><span class=mi>24</span><span class=p>]</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E022</span> <span class=o>-</span> <span class=mi>83</span> <span class=nv>F8</span> <span class=mi>16</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=nb>eax</span><span class=p>,</span><span class=mi>16</span> <span class=err>{</span> <span class=mi>22</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E025</span> <span class=o>-</span> <span class=mi>74</span> <span class=mi>3</span><span class=nv>E</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>je</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E065</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E027</span> <span class=o>-</span> <span class=mi>83</span> <span class=nv>F8</span> <span class=mi>0</span><span class=nv>C</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=nb>eax</span><span class=p>,</span><span class=mi>0</span><span class=nv>C</span> <span class=err>{</span> <span class=mi>12</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E02A</span> <span class=o>-</span> <span class=mi>74</span> <span class=mi>39</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>je</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E065</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E02C</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>86</span> <span class=nv>D8000000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,[</span><span class=nb>esi</span><span class=o>+</span><span class=mi>000000</span><span class=nv>D8</span><span class=p>]</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E032</span> <span class=o>-</span> <span class=mi>83</span> <span class=nv>F8</span> <span class=mi>01</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=nb>eax</span><span class=p>,</span><span class=mi>01</span> <span class=err>{</span> <span class=mi>1</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E035</span> <span class=o>-</span> <span class=mi>74</span> <span class=mi>2</span><span class=nv>E</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>je</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E065</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E037</span> <span class=o>-</span> <span class=mi>83</span> <span class=nv>F8</span> <span class=mi>03</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=nb>eax</span><span class=p>,</span><span class=mi>03</span> <span class=err>{</span> <span class=mi>3</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>23</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E03A</span> <span class=o>-</span> <span class=mi>74</span> <span class=mi>29</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>je</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E065</span>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E03C</span> <span class=o>-</span> <span class=mi>83</span> <span class=nv>FB</span> <span class=mi>03</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=nb>ebx</span><span class=p>,</span><span class=mi>03</span> <span class=err>{</span> <span class=mi>3</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E03F</span> <span class=o>-</span> <span class=mi>74</span> <span class=mi>0</span><span class=nv>A</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>je</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E04B</span>
</span></span><span class=line><span class=ln>26</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E041</span> <span class=o>-</span> <span class=mi>83</span> <span class=nv>FB</span> <span class=mi>05</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=nb>ebx</span><span class=p>,</span><span class=mi>05</span> <span class=err>{</span> <span class=mi>5</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E044</span> <span class=o>-</span> <span class=mi>74</span> <span class=mi>05</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>je</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E04B</span>
</span></span><span class=line><span class=ln>28</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E046</span> <span class=o>-</span> <span class=mi>83</span> <span class=nv>FB</span> <span class=mi>06</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=nb>ebx</span><span class=p>,</span><span class=mi>06</span> <span class=err>{</span> <span class=mi>6</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>29</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E049</span> <span class=o>-</span> <span class=mi>75</span> <span class=mi>1</span><span class=nv>A</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jne</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E065</span>
</span></span><span class=line><span class=ln>30</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E04B</span> <span class=o>-</span> <span class=mi>83</span> <span class=nv>FB</span> <span class=mi>06</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=nb>ebx</span><span class=p>,</span><span class=mi>06</span> <span class=err>{</span> <span class=mi>6</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>31</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E04E</span> <span class=o>-</span> <span class=mi>75</span> <span class=mb>0B</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jne</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E05B</span>
</span></span><span class=line><span class=ln>32</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E050</span> <span class=o>-</span> <span class=mi>85</span> <span class=nv>F6</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>test</span> <span class=nb>esi</span><span class=p>,</span><span class=nb>esi</span>
</span></span><span class=line><span class=ln>33</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E052</span> <span class=o>-</span> <span class=mi>74</span> <span class=mi>07</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>je</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E05B</span>
</span></span><span class=line><span class=ln>34</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E054</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>C6</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,</span><span class=nb>esi</span>
</span></span><span class=line><span class=ln>35</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E056</span> <span class=o>-</span> <span class=nv>E8</span> <span class=nv>E54A0C00</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>call</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>132</span><span class=nv>B40</span>
</span></span><span class=line><span class=ln>36</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E05B</span> <span class=o>-</span> <span class=mi>56</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>push</span> <span class=nb>esi</span>
</span></span><span class=line><span class=ln>37</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E05C</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>C7</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,</span><span class=nb>edi</span>
</span></span><span class=line><span class=ln>38</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E05E</span> <span class=o>-</span> <span class=nv>E8</span> <span class=mi>2</span><span class=nv>DF3FFFF</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>call</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D390</span>
</span></span><span class=line><span class=ln>39</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E063</span> <span class=o>-</span> <span class=nv>EB</span> <span class=mb>1B</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jmp</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E080</span>
</span></span><span class=line><span class=ln>40</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E065</span> <span class=o>-</span> <span class=mi>85</span> <span class=nv>F6</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>test</span> <span class=nb>esi</span><span class=p>,</span><span class=nb>esi</span>
</span></span><span class=line><span class=ln>41</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E067</span> <span class=o>-</span> <span class=mi>74</span> <span class=mi>17</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>je</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E080</span>
</span></span><span class=line><span class=ln>42</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E069</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>C6</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,</span><span class=nb>esi</span>
</span></span><span class=line><span class=ln>43</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E06B</span> <span class=o>-</span> <span class=nv>E8</span> <span class=nv>C0F1FFFF</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>call</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D230</span>
</span></span><span class=line><span class=ln>44</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E070</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>D</span> <span class=mi>0</span><span class=nv>C</span> <span class=mi>5</span><span class=nv>B</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>lea</span> <span class=nb>ecx</span><span class=p>,[</span><span class=nb>ebx</span><span class=o>+</span><span class=nb>ebx</span><span class=o>*</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=ln>45</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E073</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>14</span> <span class=mi>8</span><span class=nv>D</span> <span class=nv>C8F16900</span><span class=err> </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>edx</span><span class=p>,[</span><span class=nb>ecx</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>29</span><span class=nv>F1C8</span><span class=p>]</span>
</span></span><span class=line><span class=ln>46</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E07A</span> <span class=o>-</span> <span class=mi>52</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>push</span> <span class=nb>edx</span>
</span></span><span class=line><span class=ln>47</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E07B</span> <span class=o>-</span> <span class=nv>E8</span> <span class=mi>40370</span><span class=nv>C00</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>call</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1317</span><span class=nv>C0</span> <span class=err>{</span> <span class=nv>call2</span> <span class=err>}</span>
</span></span></code></pre></div><p>我们向上找可以发现 mov esi,eax，说明esi是由eax得来的</p><p>问题再次转化为[ebp+c8]->ebp->esi->[esi+c8]->[eax+c8]</p><p>这时我们发现又到了函数头部，再次故技重施，下断并执行到返回，再来到上一层</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001954312.webp width=2351 height=1377 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001954312_hu21849ccd10c773ec7778c4a11d53a2b7_275642_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129001954312_hu21849ccd10c773ec7778c4a11d53a2b7_275642_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129001954312 class=gallery-image data-flex-grow=170 data-flex-basis=409px></p><p>贴上代码:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-NASM data-lang=NASM><span class=line><span class=ln> 1</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D04E</span> <span class=o>-</span> <span class=mi>5</span><span class=nv>F</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>pop</span> <span class=nb>edi</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D04F</span> <span class=o>-</span> <span class=mi>5</span><span class=nv>E</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>pop</span> <span class=nb>esi</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D050</span> <span class=o>-</span> <span class=mi>5</span><span class=nv>D</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>pop</span> <span class=nb>ebp</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D051</span> <span class=o>-</span> <span class=mi>5</span><span class=nv>B</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>pop</span> <span class=nb>ebx</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D052</span> <span class=o>-</span> <span class=mi>83</span> <span class=nv>C4</span> <span class=mi>20</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>add</span> <span class=nb>esp</span><span class=p>,</span><span class=mi>20</span> <span class=err>{</span> <span class=mi>32</span> <span class=err>}</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D055</span> <span class=o>-</span> <span class=nv>C2</span> <span class=mi>0400</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err> </span><span class=o>-</span> <span class=nv>ret</span> <span class=mi>0004</span> <span class=err>{</span> <span class=mi>4</span> <span class=err>}</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D058</span> <span class=o>-</span> <span class=nv>E8</span> <span class=nv>E3FCFFFF</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>call</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD40</span> <span class=err>{</span> <span class=nb>EAX</span><span class=err>在这里面}</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D05D</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>D0</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>edx</span><span class=p>,</span><span class=nb>eax</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err> {</span><span class=nb>edx</span><span class=err>被</span><span class=nb>eax</span><span class=err>赋值}</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D05F</span> <span class=o>-</span> <span class=mi>85</span> <span class=nv>D2</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>test</span> <span class=nb>edx</span><span class=p>,</span><span class=nb>edx</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D061</span> <span class=o>-</span> <span class=mi>74</span> <span class=nv>EB</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>je</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D04E</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D063</span> <span class=o>-</span> <span class=mi>80</span> <span class=nv>BA</span> <span class=nv>BE000000</span> <span class=mi>00</span><span class=err> </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=kt>byte</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>edx</span><span class=o>+</span><span class=mb>000000B</span><span class=nv>E</span><span class=p>],</span><span class=mi>00</span> <span class=err>{</span> <span class=mi>0</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D06A</span> <span class=o>-</span> <span class=mi>74</span> <span class=mb>0B</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>je</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D077</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D06C</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>CD</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>ecx</span><span class=p>,</span><span class=nb>ebp</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D06E</span> <span class=o>-</span> <span class=nv>E8</span> <span class=mi>1</span><span class=nv>D000000</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>call</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D090</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D073</span> <span class=o>-</span> <span class=mi>84</span> <span class=nv>C0</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>test</span> <span class=nb>al</span><span class=p>,</span><span class=nb>al</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D075</span> <span class=o>-</span> <span class=mi>75</span> <span class=nv>D7</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jne</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D04E</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D077</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>C2</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,</span><span class=nb>edx</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err> {</span><span class=nb>eax</span><span class=err>被</span><span class=nb>edx</span><span class=err>赋值}</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D079</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>CD</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>ecx</span><span class=p>,</span><span class=nb>ebp</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>D07B</span> <span class=o>-</span> <span class=nv>E8</span> <span class=mi>800</span><span class=nv>F0000</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>call</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>E000</span> <span class=err>{</span> <span class=nv>call3</span> <span class=err>}</span>
</span></span></code></pre></div><p>不难发现，我们这里的eax是由edx赋值的；再向上找到mov edx,eax，edx又变成了eax所以我们还是要找eax</p><p>这里其实还遇到了一个小问题，就是在mov edx,eax 这里要下断点证明是不是eax将值赋给了edx，但是设置了断点以后，一进游戏就断下来了，并且eax的值并不是14EE1914，这个时候可能就有人觉得这里不是赋值处了，但其实这里就是赋值的地方，它是一个<strong>共用段</strong>，于是我们要通过<strong>条件断点</strong>来过滤，条件断点设置如下</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129002638911.webp width=2353 height=886 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129002638911_hu4b2feffd35d05f732ba5b518d70d111d_202244_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129002638911_hu4b2feffd35d05f732ba5b518d70d111d_202244_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129002638911 class=gallery-image data-flex-grow=265 data-flex-basis=637px></p><p>通过条件断点后，果然断下了</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129003109596.webp width=2363 height=910 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129003109596_huaaa3805d4a0bda50d39119d3cc5111ca_200144_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129003109596_huaaa3805d4a0bda50d39119d3cc5111ca_200144_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129003109596 class=gallery-image data-flex-grow=259 data-flex-basis=623px></p><p>再往上看只有一个CALL 了，要么EAX就是在CALL里被赋值的，要么就是在上一层被赋值的</p><p>怎么确认呢？我们可以在CALL 这里下个条件断点，如果是上一层赋值的，则会断下，否则不会断下</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129003330136.webp width=1860 height=429 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129003330136_hu5f3374a7c86a45bb3e536d3bc67b392b_92758_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129003330136_hu5f3374a7c86a45bb3e536d3bc67b392b_92758_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129003330136 class=gallery-image data-flex-grow=433 data-flex-basis=1040px></p><p>设置条件断点以后发现并没有断下，得出结论，EAX是在CALL里面被赋值的</p><p>于是我们先设置一个普通的断点，然后F7单步步入CALL中，然后找到CALL的尾部（跳出CALL之前肯定EAX已经被赋值完毕了）,于是我们右键选择当前函数，然后找到被选中的最后一行，如图：</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129003745902.webp width=2342 height=1195 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129003745902_hu08843edd8c06aa629c9041218a121b5a_251894_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129003745902_hu08843edd8c06aa629c9041218a121b5a_251894_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129003745902 class=gallery-image data-flex-grow=195 data-flex-basis=470px></p><p>代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-NASM data-lang=NASM><span class=line><span class=ln> 1</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CE5F</span> <span class=o>-</span> <span class=nv>E8</span> <span class=mi>8</span><span class=nv>CFAFAFF</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>call</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C8F0</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CE64</span> <span class=o>-</span> <span class=mi>84</span> <span class=nv>C0</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>test</span> <span class=nb>al</span><span class=p>,</span><span class=nb>al</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CE66</span> <span class=o>-</span> <span class=mi>0</span><span class=nv>F85</span> <span class=mi>25</span><span class=nv>FFFFFF</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err> </span><span class=o>-</span> <span class=nv>jne</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD91</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CE6C</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>44</span> <span class=mi>24</span> <span class=mi>18</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,[</span><span class=nb>esp</span><span class=o>+</span><span class=mi>18</span><span class=p>]</span> <span class=err>{</span> <span class=nb>eax</span><span class=err>被赋值</span> <span class=err>}</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CE70</span> <span class=o>-</span> <span class=mi>5</span><span class=nv>F</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>pop</span> <span class=nb>edi</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CE71</span> <span class=o>-</span> <span class=mi>5</span><span class=nv>E</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>pop</span> <span class=nb>esi</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CE72</span> <span class=o>-</span> <span class=mi>5</span><span class=nv>D</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>pop</span> <span class=nb>ebp</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CE73</span> <span class=o>-</span> <span class=mi>5</span><span class=nv>B</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>pop</span> <span class=nb>ebx</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CE74</span> <span class=o>-</span> <span class=mi>83</span> <span class=nv>C4</span> <span class=mi>30</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>add</span> <span class=nb>esp</span><span class=p>,</span><span class=mi>30</span> <span class=err>{</span> <span class=mi>48</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CE77</span> <span class=o>-</span> <span class=nv>C2</span> <span class=mi>0400</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err> </span><span class=o>-</span> <span class=nv>ret</span> <span class=mi>0004</span> <span class=err>{</span> <span class=mi>4</span> <span class=err>}</span>
</span></span></code></pre></div><p>从下往上找，不难找到mov eax,[esp+18] 这一句，验证一下，在这一句下方设置条件断点</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129004014334.webp width=1847 height=416 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129004014334_hu3c0cf16c80a23a5dcebecd95ba4f16e5_80738_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129004014334_hu3c0cf16c80a23a5dcebecd95ba4f16e5_80738_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129004014334 class=gallery-image data-flex-grow=443 data-flex-basis=1065px></p><p>断下</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129004050900.webp width=2349 height=1312 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129004050900_hub474cde9358c923f2a018a82af602943_257528_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129004050900_hub474cde9358c923f2a018a82af602943_257528_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129004050900 class=gallery-image data-flex-grow=179 data-flex-basis=429px></p><p>根据前面的经验，我们知道[esp+xxx]是之前入栈的某个地址，而这里ebx正好等于eax，所以我们就可以将问题转为找ebx</p><p>从下往上接着寻找可以找到</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-NASM data-lang=NASM><span class=line><span class=ln>1</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CDF9</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=nv>DE</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>ebx</span><span class=p>,</span><span class=nb>esi</span> <span class=err>{</span> <span class=nb>ebx</span><span class=err>被赋值</span> <span class=err>}</span>
</span></span></code></pre></div><p>于是ebx又变成了esi，接着往上找可以找到</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-NASM data-lang=NASM><span class=line><span class=ln> 1</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD70</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>D</span> <span class=mi>74</span> <span class=mi>24</span> <span class=mi>14</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>lea</span> <span class=nb>esi</span><span class=p>,[</span><span class=nb>esp</span><span class=o>+</span><span class=mi>14</span><span class=p>]</span><span class=err> </span> <span class=err>  </span> <span class=err>   {这里的</span><span class=nb>esp</span><span class=o>+</span><span class=mi>14</span><span class=err>正好和下面赋值对应}</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD74</span> <span class=o>-</span> <span class=mi>89</span> <span class=mi>44</span> <span class=mi>24</span> <span class=mi>18</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=p>[</span><span class=nb>esp</span><span class=o>+</span><span class=mi>18</span><span class=p>],</span><span class=nb>eax</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD78</span> <span class=o>-</span> <span class=mi>89</span> <span class=mi>44</span> <span class=mi>24</span> <span class=mi>1</span><span class=nv>C</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=p>[</span><span class=nb>esp</span><span class=o>+</span><span class=mi>1</span><span class=nv>C</span><span class=p>],</span><span class=nb>eax</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD7C</span> <span class=o>-</span> <span class=mi>89</span> <span class=mi>44</span> <span class=mi>24</span> <span class=mi>14</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=p>[</span><span class=nb>esp</span><span class=o>+</span><span class=mi>14</span><span class=p>],</span><span class=nb>eax</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD80</span> <span class=o>-</span> <span class=nv>E8</span> <span class=mi>6</span><span class=nv>BFBFAFF</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>call</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C8F0</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err> </span> <span class=err>{</span> <span class=nv>call</span> <span class=err>}</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD85</span> <span class=o>-</span> <span class=mi>84</span> <span class=nv>C0</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>test</span> <span class=nb>al</span><span class=p>,</span><span class=nb>al</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD87</span> <span class=o>-</span> <span class=mi>0</span><span class=nv>F84</span> <span class=nv>DF000000</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err> </span><span class=o>-</span> <span class=nv>je</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CE6C</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD8D</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>6</span><span class=nv>C</span> <span class=mi>24</span> <span class=mi>30</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>ebp</span><span class=p>,[</span><span class=nb>esp</span><span class=o>+</span><span class=mi>30</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD91</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>74</span> <span class=mi>24</span> <span class=mi>14</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>esi</span><span class=p>,[</span><span class=nb>esp</span><span class=o>+</span><span class=mi>14</span><span class=p>]</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   {</span> <span class=nb>esi</span><span class=err>被赋值</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD95</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>46</span> <span class=mi>1</span><span class=nv>C</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,[</span><span class=nb>esi</span><span class=o>+</span><span class=mi>1</span><span class=nv>C</span><span class=p>]</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD98</span> <span class=o>-</span> <span class=mi>2</span><span class=nv>B</span> <span class=mi>47</span> <span class=mi>1</span><span class=nv>C</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>sub</span> <span class=nb>eax</span><span class=p>,[</span><span class=nb>edi</span><span class=o>+</span><span class=mi>1</span><span class=nv>C</span><span class=p>]</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>6</span><span class=nv>CD9B</span> <span class=o>-</span> <span class=nv>BB</span> <span class=mi>19000000</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>ebx</span><span class=p>,</span><span class=mi>00000019</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err> </span> 
</span></span></code></pre></div><p>这里我们可以找到mov esi,[esp+14],在这里的下一句下条件断点，验证是否是esi被赋值</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129004650120.webp width=1864 height=361 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129004650120_hu8c591133321ee79fe7fb6147f9839b41_71240_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129004650120_hu8c591133321ee79fe7fb6147f9839b41_71240_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129004650120 class=gallery-image data-flex-grow=516 data-flex-basis=1239px></p><p>果然断下了,但这里我们发现没有寄存器的值和ESI相同，说明寄存器在<strong>入栈</strong>之后，又被改变了</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129004810875.webp width=2351 height=721 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129004810875_hubf3cb6feff663c9e771a551b6d8e47ff_179774_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129004810875_hubf3cb6feff663c9e771a551b6d8e47ff_179774_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129004810875 class=gallery-image data-flex-grow=326 data-flex-basis=782px></p><p>于是我们只能接着向上找push xxx，或者mov [esp+xx],xx ，这里找的是mov [esi]，xx 因为上面的lea esi,[esp+14]是传址指令，相当于mov [esi],xx = mov [esp+14],xx</p><p>我们很快看到上面有个mov [esp+14],eax 在那里的下一句设置条件断点EAX==0x14EE1914，很可惜并没有断下，说明CALL里面有压入的参数，于是我们直接进入CALL中查看</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129005559296.webp width=433 height=185 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129005559296_hu7cf022e1d380ff86987f484fcfeb54d7_13562_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129005559296_hu7cf022e1d380ff86987f484fcfeb54d7_13562_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129005559296 class=gallery-image data-flex-grow=234 data-flex-basis=561px></p><p>直接Ctrl+G，然后输入CALL后面的地址0041C8F0 即可跳转到CALL里面进行查看</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129005916187.webp width=3354 height=1357 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129005916187_hubba8f5a8bd4b0635ee039ae710f1a7ff_266124_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129005916187_hubba8f5a8bd4b0635ee039ae710f1a7ff_266124_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129005916187 class=gallery-image data-flex-grow=247 data-flex-basis=593px></p><p>CALL里面的代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-NASM data-lang=NASM><span class=line><span class=ln> 1</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C8F0</span> <span class=o>-</span> <span class=mi>57</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>push</span> <span class=nb>edi</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C8F1</span> <span class=o>-</span> <span class=nv>BF</span> <span class=mi>0000</span><span class=nv>FFFF</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>edi</span><span class=p>,</span><span class=nv>FFFF0000</span> <span class=err>{</span> <span class=o>-</span><span class=mi>65536</span> <span class=err>}</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C8F6</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>06</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,[</span><span class=nb>esi</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C8F8</span> <span class=o>-</span> <span class=mi>85</span> <span class=nv>C0</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>test</span> <span class=nb>eax</span><span class=p>,</span><span class=nb>eax</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C8FA</span> <span class=o>-</span> <span class=mi>75</span> <span class=mi>08</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jne</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C904</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C8FC</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>82</span> <span class=mi>90000000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,[</span><span class=nb>edx</span><span class=o>+</span><span class=mi>00000090</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C902</span> <span class=o>-</span> <span class=nv>EB</span> <span class=mi>05</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jmp</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C909</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C904</span> <span class=o>-</span> <span class=mi>05</span> <span class=mi>5</span><span class=nv>C010000</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>add</span> <span class=nb>eax</span><span class=p>,</span><span class=mi>0000015</span><span class=nv>C</span> <span class=err>{</span> <span class=mi>348</span> <span class=err>}</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C909</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>8</span><span class=nv>A</span> <span class=mi>94000000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>ecx</span><span class=p>,[</span><span class=nb>edx</span><span class=o>+</span><span class=mi>00000094</span><span class=p>]</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C90F</span> <span class=o>-</span> <span class=mi>69</span> <span class=nv>C9</span> <span class=mi>5</span><span class=nv>C010000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>imul</span> <span class=nb>ecx</span><span class=p>,</span><span class=nb>ecx</span><span class=p>,</span><span class=mi>0000015</span><span class=nv>C</span> <span class=err>{</span> <span class=mi>348</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C915</span> <span class=o>-</span> <span class=mi>03</span> <span class=mi>8</span><span class=nv>A</span> <span class=mi>90000000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>add</span> <span class=nb>ecx</span><span class=p>,[</span><span class=nb>edx</span><span class=o>+</span><span class=mi>00000090</span><span class=p>]</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C91B</span> <span class=o>-</span> <span class=mi>3</span><span class=nv>B</span> <span class=nv>C1</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=nb>eax</span><span class=p>,</span><span class=nb>ecx</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C91D</span> <span class=o>-</span> <span class=mi>73</span> <span class=mi>12</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jae</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C931</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C91F</span> <span class=o>-</span> <span class=mi>90</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>nop</span> 
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C920</span> <span class=o>-</span> <span class=mi>85</span> <span class=nv>B8</span> <span class=mi>58010000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>test</span> <span class=p>[</span><span class=nb>eax</span><span class=o>+</span><span class=mi>00000158</span><span class=p>],</span><span class=nb>edi</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C926</span> <span class=o>-</span> <span class=mi>75</span> <span class=mi>13</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jne</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C93B</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C928</span> <span class=o>-</span> <span class=mi>05</span> <span class=mi>5</span><span class=nv>C010000</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>add</span> <span class=nb>eax</span><span class=p>,</span><span class=mi>0000015</span><span class=nv>C</span> <span class=err>{</span> <span class=mi>348</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C92D</span> <span class=o>-</span> <span class=mi>3</span><span class=nv>B</span> <span class=nv>C1</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=nb>eax</span><span class=p>,</span><span class=nb>ecx</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C92F</span> <span class=o>-</span> <span class=mi>72</span> <span class=nv>EF</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jb</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C920</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C931</span> <span class=o>-</span> <span class=nv>C7</span> <span class=mi>06</span> <span class=nv>FFFFFFFF</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=p>[</span><span class=nb>esi</span><span class=p>],</span><span class=nv>FFFFFFFF</span> <span class=err>{</span> <span class=o>-</span><span class=mi>1</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C937</span> <span class=o>-</span> <span class=mi>32</span> <span class=nv>C0</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>xor</span> <span class=nb>al</span><span class=p>,</span><span class=nb>al</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C939</span> <span class=o>-</span> <span class=mi>5</span><span class=nv>F</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>pop</span> <span class=nb>edi</span>
</span></span><span class=line><span class=ln>23</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C93A</span> <span class=o>-</span> <span class=nv>C3</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>ret</span> 
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C93B</span> <span class=o>-</span> <span class=mi>89</span> <span class=mi>06</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=p>[</span><span class=nb>esi</span><span class=p>],</span><span class=nb>eax</span> <span class=err>{</span> <span class=err>赋值}</span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C93D</span> <span class=o>-</span> <span class=mi>80</span> <span class=nv>B8</span> <span class=nv>EC000000</span> <span class=mi>00</span><span class=err> </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=kt>byte</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>eax</span><span class=o>+</span><span class=mi>000000</span><span class=nv>EC</span><span class=p>],</span><span class=mi>00</span> <span class=err>{</span> <span class=mi>0</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>26</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C944</span> <span class=o>-</span> <span class=mi>75</span> <span class=nv>B0</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jne</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C8F6</span>
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C946</span> <span class=o>-</span> <span class=nv>B0</span> <span class=mi>01</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>al</span><span class=p>,</span><span class=mi>01</span> <span class=err>{</span> <span class=mi>1</span> <span class=err>}</span>
</span></span><span class=line><span class=ln>28</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C948</span> <span class=o>-</span> <span class=mi>5</span><span class=nv>F</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>pop</span> <span class=nb>edi</span>
</span></span><span class=line><span class=ln>29</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C949</span> <span class=o>-</span> <span class=nv>C3</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>ret</span> 
</span></span></code></pre></div><p>这个CALL比较简短,我们直接从下面找起 ,一下就找到了mov [esi],eax 可以下个条件断点验证一下</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129011029891.webp width=1867 height=404 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129011029891_hu42afa3cdc88f944d226f0cfeaaeec77b_86434_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129011029891_hu42afa3cdc88f944d226f0cfeaaeec77b_86434_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129011029891 class=gallery-image data-flex-grow=462 data-flex-basis=1109px></p><p>果然断下</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129011127073.webp width=2363 height=1136 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129011127073_hueff73dc5467b016c04dbfb0e7b6c846a_257078_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129011127073_hueff73dc5467b016c04dbfb0e7b6c846a_257078_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129011127073 class=gallery-image data-flex-grow=208 data-flex-basis=499px></p><p>于是问题又变成了找eax（这个14EE1914我们转了多少手寄存器了？？？）</p><p>接着向上找EAX，这里EAX上方是RET，则肯定是从上方的语句跳转过来的，</p><p>不难找到跳转过来的语句:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-NASM data-lang=NASM><span class=line><span class=ln>1</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C926</span> <span class=o>-</span> <span class=mi>75</span> <span class=mi>13</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jne</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C93B</span>
</span></span></code></pre></div><p>于是从跳转过来的语句接着向上找EAX的赋值</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-NASM data-lang=NASM><span class=line><span class=ln> 1</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C8F6</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>06</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,[</span><span class=nb>esi</span><span class=p>]</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err> {</span><span class=nb>eax</span><span class=err>赋值为</span><span class=p>[</span><span class=nb>esi</span><span class=p>]</span><span class=err>内部的值}</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C8F8</span> <span class=o>-</span> <span class=mi>85</span> <span class=nv>C0</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>test</span> <span class=nb>eax</span><span class=p>,</span><span class=nb>eax</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err> {判断</span><span class=nb>eax</span><span class=err>是否为</span><span class=mi>0</span><span class=err>}</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C8FA</span> <span class=o>-</span> <span class=mi>75</span> <span class=mi>08</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jne</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C904</span><span class=err> </span> <span class=err>  </span> <span class=err>   {为</span><span class=mi>0</span><span class=err>则不跳转}</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C8FC</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>82</span> <span class=mi>90000000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>eax</span><span class=p>,[</span><span class=nb>edx</span><span class=o>+</span><span class=mi>00000090</span><span class=p>]</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err> {</span><span class=nb>eax</span><span class=err>赋值为</span><span class=p>[</span><span class=nb>edx</span><span class=o>+</span><span class=mi>90</span><span class=p>]</span><span class=err>}</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C902</span> <span class=o>-</span> <span class=nv>EB</span> <span class=mi>05</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jmp</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C909</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C904</span> <span class=o>-</span> <span class=mi>05</span> <span class=mi>5</span><span class=nv>C010000</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>add</span> <span class=nb>eax</span><span class=p>,</span><span class=mi>0000015</span><span class=nv>C</span> <span class=err>{</span> <span class=mi>348</span> <span class=err>}</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C909</span> <span class=o>-</span> <span class=mi>8</span><span class=nv>B</span> <span class=mi>8</span><span class=nv>A</span> <span class=mi>94000000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>mov</span> <span class=nb>ecx</span><span class=p>,[</span><span class=nb>edx</span><span class=o>+</span><span class=mi>00000094</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C90F</span> <span class=o>-</span> <span class=mi>69</span> <span class=nv>C9</span> <span class=mi>5</span><span class=nv>C010000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>imul</span> <span class=nb>ecx</span><span class=p>,</span><span class=nb>ecx</span><span class=p>,</span><span class=mi>0000015</span><span class=nv>C</span> <span class=err>{</span> <span class=mi>348</span> <span class=err>}</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C915</span> <span class=o>-</span> <span class=mi>03</span> <span class=mi>8</span><span class=nv>A</span> <span class=mi>90000000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>add</span> <span class=nb>ecx</span><span class=p>,[</span><span class=nb>edx</span><span class=o>+</span><span class=mi>00000090</span><span class=p>]</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C91B</span> <span class=o>-</span> <span class=mi>3</span><span class=nv>B</span> <span class=nv>C1</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>cmp</span> <span class=nb>eax</span><span class=p>,</span><span class=nb>ecx</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C91D</span> <span class=o>-</span> <span class=mi>73</span> <span class=mi>12</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jae</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C931</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C91F</span> <span class=o>-</span> <span class=mi>90</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>nop</span> 
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C920</span> <span class=o>-</span> <span class=mi>85</span> <span class=nv>B8</span> <span class=mi>58010000</span><span class=err> </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>test</span> <span class=p>[</span><span class=nb>eax</span><span class=o>+</span><span class=mi>00000158</span><span class=p>],</span><span class=nb>edi</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=nf>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C926</span> <span class=o>-</span> <span class=mi>75</span> <span class=mi>13</span><span class=err> </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>  </span> <span class=err>   </span><span class=o>-</span> <span class=nv>jne</span> <span class=nv>PlantsVsZombies.exe</span><span class=o>+</span><span class=mi>1</span><span class=nv>C93B</span>
</span></span></code></pre></div><p>我们通过汇编语句不难得出 EAX刚开始是由[ESI]赋值的，但刚开始为0的话则为[EDX+90]赋值,也可以从外面对CALL下断，分析EAX的赋值过程得到：头部由来是[EDX+00000090],每个僵尸的大小是15C，这里其实我们已经得到了僵尸数组的动态头部地址[EDX+90]，我们接着追溯EDX，这里可以看一下动态地址的头部14EE0CD8，和我们的14EE1914相减得到C3C=3132        15C=348        3132/348=9，说明我们这个僵尸是由头部地址偏移了9个僵尸~~ 然后记录一下</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129013745019.webp width=2354 height=776 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129013745019_hu8082ac87129b06f60a64369cf9398cb0_182586_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129013745019_hu8082ac87129b06f60a64369cf9398cb0_182586_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129013745019 class=gallery-image data-flex-grow=303 data-flex-basis=728px></p><p>接着就是找EDX，此时EDX的值为14EDB520</p><p>到这里找EDX就直接在CE里搜索了（也可以汇编里接着向上找，但一是出于篇幅问题，二是留给大家练手当作业吧）</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122247763.webp width=1305 height=714 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122247763_hud2ea8a312a0e0af7d50f3414e3465009_95702_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122247763_hud2ea8a312a0e0af7d50f3414e3465009_95702_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129122247763 class=gallery-image data-flex-grow=182 data-flex-basis=438px></p><p>CE里直接搜索14EDB520，也就是EDX的值，然后去掉第一个动态的地址，第二个就是了，这个大家应该都很熟练了</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122404999.webp width=1372 height=856 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122404999_hu7e515f1dda61db3c8d12ac87a467699b_132958_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122404999_hu7e515f1dda61db3c8d12ac87a467699b_132958_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129122404999 class=gallery-image data-flex-grow=160 data-flex-basis=384px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122425097.webp width=842 height=734 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122425097_hu1c7d128353f9c88ce4d17e6d759d701b_54228_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122425097_hu1c7d128353f9c88ce4d17e6d759d701b_54228_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129122425097 class=gallery-image data-flex-grow=114 data-flex-basis=275px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122509689.webp width=1644 height=730 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122509689_hu1bbd503309a465d47a698541385392dd_110652_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122509689_hu1bbd503309a465d47a698541385392dd_110652_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129122509689 class=gallery-image data-flex-grow=225 data-flex-basis=540px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122547256.webp width=815 height=87 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122547256_hue2a1815227d8ba0989347c92fe0e0c84_9970_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122547256_hue2a1815227d8ba0989347c92fe0e0c84_9970_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129122547256 class=gallery-image data-flex-grow=936 data-flex-basis=2248px></p><p>基址找到了,手动添加验证一下:</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122652158.webp width=1094 height=678 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122652158_hu096940f473cb92c3047b6d32bfe306ba_42624_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210129122652158_hu096940f473cb92c3047b6d32bfe306ba_42624_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210129122652158 class=gallery-image data-flex-grow=161 data-flex-basis=387px></p><p>正确得到当前的僵尸血量~~~我们的反汇编追踪之旅算是告一段落了</p><h2 id=作业>作业</h2><p>实践是检验真理的唯一标准。这不来两份热乎的作业温习温习？</p><p>第一份作业就是上面说的，继续通过反汇编的方式，从下往上跟踪EDX，然后找到基址</p><p>第二份作业则利用到了我们找到的这个僵尸数组头部的赋值语句，我们都知道所有僵尸的产生都会在这里的代码通过，那么能否在这块代码HOOK，让僵尸直接GO DIE呢？这种全屏秒杀才算是真正的全屏秒杀，直接从源头将你弄死~~~现在大多数的全屏秒杀都是通过在僵尸移动的那一块代码直接修改僵尸的状态来实现的，但是别忘了最后的僵尸BOSS，它貌似没有移动吧？因此僵尸王无法被秒杀，秒杀不够完美。第二份作业要求：<strong>HOOK僵尸头部的这块代码，实现可以秒杀包括僵尸BOSS在内的所有僵尸</strong></p><h2 id=总结注意事项>总结(注意事项)</h2><p>反汇编找基址其实就是<strong>从下往上</strong>，寻找目标寄存器的来源，最终找到目标</p><p>寄存器中比较特殊的<strong>EBP和ESP</strong>，要通过寻找之前入栈的寄存器来获得赋值来源</p><p>入栈操作不仅仅是push xxx 指令 还有 mov [esp+xxx],xxx 或者先lea xxx,[esp+xxx]，再mov [xxx],xxx等等</p><p>有的时候向上追代码的时候，会遇到明明还没攻击到僵尸却引发了中断，并且此时寄存器锏哪谌荻疾欢裕锌赡苁�<strong>共用代码段</strong>，需要用<strong>条件断点</strong>来进行判断</p><p>找到赋值语句以后可以在那里下个断点，看是否执行以后寄存器内容被修改，<strong>验证语句来源的正确性</strong></p><p>有时候会遇到很多跳转，但要记住，如果我们的语句执行了，那么跳过我们语句的跳转肯定是没有跳的，不然我们怎么执行？</p><p>遇事不决的时候找不到来源的时候<strong>多下断点</strong>，看看寄存器的变化，实在找不到就去函数头部下断，然后一步步单步步过，看在哪里寄存器的值发生了改变</p><h2 id=个人感言无关技术可跳过>个人感言（无关技术，可跳过）</h2><p>白嫖了网络教程资源这么多年，都没写过技术教程，这次算是我的首次技术教程吧，能力不足，水平有限，欢迎大家指出我的不当之处,也请大家多多包涵一下，希望能够一起变强。</p><p>最后碎碎念一下：这个教程肝了我一晚上，<strong>太肝了</strong>。出这个教程的初衷是看到现在的找基址教程十个有九个是PVZ（夸张），但一个汇编追基址的都没有（可能有？），于是出一期看看反响如何，之后可能会接着出<strong>汇编硬追代码</strong>的系列教程，视大家的<strong>热情程度</strong>而定吧</p><h2 id=上篇前言>上篇前言：</h2><p>CE支持LUA和Plugin已经有一段时间了，但是相关的教程却并不是很多。LUA和Plugin的功能属实强大，今天就借着pvz绘制僵尸血量这个例子给大家侃侃CE的这两大功能</p><p>本教程分成两部分：</p><ul><li>LUA的使用</li><li>Plugin的开发</li></ul><p><strong>本上篇教程为LUA的使用部分</strong></p><p>PS：原本是打算直接用LUA写个绘制就好，但没想到LUA里没有<strong>直接</strong>提供获取窗口位置信息的函数，如WIN32提供的GetWindowRect，为此就自己<strong>写个插件提供接口给LUA调用</strong></p><h2 id=效果图>效果图</h2><p>先给大家看看效果</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/pvz.gif width=783 height=578 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/pvz_hufdfdc836e0cb53ad1bdabd4b149c4849_1589572_480x0_resize_box_1.gif 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/pvz_hufdfdc836e0cb53ad1bdabd4b149c4849_1589572_1024x0_resize_box_1.gif 1024w" loading=lazy alt=pvz class=gallery-image data-flex-grow=135 data-flex-basis=325px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210014449374.webp width=547 height=173 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210014449374_hub1d10dbfdd6c2fc4e82974e54d0bdb88_7184_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210014449374_hub1d10dbfdd6c2fc4e82974e54d0bdb88_7184_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210014449374 class=gallery-image data-flex-grow=316 data-flex-basis=758px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210014518897.webp width=955 height=559 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210014518897_hu3b766808b5086ed1a769128323a2e359_20858_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210014518897_hu3b766808b5086ed1a769128323a2e359_20858_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210014518897 class=gallery-image data-flex-grow=170 data-flex-basis=410px></p><h2 id=事前准备-1>事前准备</h2><p>本人使用的工具：CE7.2汉化版（这次要<strong>注意版本</strong>，插件和CE版本相关，汉化与否不影响）</p><p>论坛有：<a class=link href=https://down.52pojie.cn/Tools/Debuggers/Cheat%20Engine%20v7.2.exe target=_blank rel=noopener>https://down.52pojie.cn/Tools/Debuggers/Cheat%20Engine%20v7.2.exe</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>VS2015 （可以<strong>兼容XP</strong>的插件开发）</p><p><a class=link href="https://my.visualstudio.com/Downloads?q=visual%20studio%202015&amp;wt.mc_id=o~msft~vscom~older-downloads" target=_blank rel=noopener>https://my.visualstudio.com/Downloads?q=visual%20studio%202015&amp;wt.mc_id=o~msft~vscom~older-downloads</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>本人使用的游戏：植物大战僵尸<strong>原版</strong>的汉化版(非年度版)     就是阳光基址是006A9EC0+768+5560的那个（ps:劳模植物大战僵尸）</p><p>CE7.2源码一份:<a class=link href=https://github.com/cheat-engine/cheat-engine/archive/7.2.zip target=_blank rel=noopener>https://github.com/cheat-engine/cheat-engine/archive/7.2.zip</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><h2 id=需要知道的pvz数据>需要知道的pvz数据</h2><p>前面我们通过汇编硬追基址知道了</p><p>僵尸头部数组的地址是0x6a9ec0+0x768+0x90，僵尸数量上限地址为0x6a9ec0+0x768+0x94</p><p>僵尸血量为僵尸地址+0xc8，僵尸x坐标为僵尸地址+0x8，僵尸y坐标为僵尸地址+0xc</p><p>不知道的朋友们可以戳这里看之前的教程：<a class=link href=https://www.52pojie.cn/thread-1361473-1-1.html target=_blank rel=noopener>https://www.52pojie.cn/thread-1361473-1-1.html</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>知道了这些以后开启我们的LUA之旅</p><h2 id=教程内容-1>教程内容</h2><h2 id=编写我们的lua绘制脚本>编写我们的LUA绘制脚本</h2><h3 id=tip遇到不懂的方法或属性可以查看下方提供的lua参考文档>tip:<strong>遇到不懂的方法或属性可以查看下方提供的LUA参考文档</strong></h3><p>想要测试一个LUA脚本可以先打开LUA脚本窗口：表单→显示CT表的Lua脚本(Ctrl+Alt+L)</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210209212720399.webp width=1015 height=901 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210209212720399_hu8a99a77e33651e5ffe56625e137b456b_9324_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210209212720399_hu8a99a77e33651e5ffe56625e137b456b_9324_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210209212720399 class=gallery-image data-flex-grow=112 data-flex-basis=270px></p><h3 id=创建一个透明窗口>创建一个透明窗口</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln> 1</span><span class=cl><span class=kr>function</span> <span class=nf>createTransparentWindow</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=n>form</span><span class=o>=</span><span class=n>createForm</span><span class=p>()</span>                   <span class=c1>--创建窗体</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=n>canvas</span><span class=o>=</span><span class=n>form.Canvas</span>                  <span class=c1>--获取canvas</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=n>form.Color</span><span class=o>=</span><span class=mh>0x000000</span>                 <span class=c1>--设置窗体颜色为黑色 和透明相关</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=n>form.Width</span><span class=o>=</span><span class=n>getScreenWidth</span><span class=p>()</span>         <span class=c1>--设置窗体宽度为屏幕宽度</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=n>form.Height</span><span class=o>=</span><span class=n>getScreenHeight</span><span class=p>()</span>       <span class=c1>--设置窗体高度为屏幕高度</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=n>form.FormStyle</span><span class=o>=</span><span class=s1>&#39;fsSystemStayOnTop&#39;</span>  <span class=c1>--设置窗体风格为fsSystemStayOnTop,详见上方参考文档 这里为将窗口置顶</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=n>form.BorderStyle</span><span class=o>=</span><span class=s1>&#39;bsNone&#39;</span>           <span class=c1>--设置窗体边界风格为bsNone，详见上方参考文档        这里为设置无边框      </span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=n>form.setLayeredAttributes</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>LWA_COLORKEY</span><span class=p>)</span> <span class=c1>--设置窗口透明，详见上方参考文档</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h3 id=在透明窗口里绘制>在透明窗口里绘制</h3><p>如果要测试的话，记得要加上上面的createTransparentWindow代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln> 1</span><span class=cl><span class=c1>--设置画笔</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=kr>function</span> <span class=nf>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=n>canvas.Pen</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=n>Color</span> <span class=ow>or</span> <span class=mh>0xff00ff</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=n>canvas.Pen</span><span class=p>.</span><span class=n>Width</span><span class=o>=</span><span class=n>Width</span> <span class=ow>or</span> <span class=mi>2</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1>--设置字体</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=kr>function</span> <span class=nf>Font</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Size</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=n>canvas.Font</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=n>Color</span> <span class=ow>or</span> <span class=mh>0xff00ff</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=n>canvas.Font</span><span class=p>.</span><span class=n>Size</span><span class=o>=</span><span class=n>Size</span> <span class=ow>or</span> <span class=mi>12</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1>--绘制文字</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=kr>function</span> <span class=nf>textOut</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>text</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Size</span><span class=p>)</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=n>Font</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Size</span><span class=p>)</span>            <span class=c1>--设置字体</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=n>canvas.Brush</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=kc>nil</span>      <span class=c1>--设置画刷颜色</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=n>canvas.textOut</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>text</span><span class=p>)</span>    <span class=c1>--输出文字</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1>--画椭圆</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=kr>function</span> <span class=nf>ellipse</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=n>canvas.ellipse</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=c1>--画圆</span>
</span></span><span class=line><span class=ln>23</span><span class=cl><span class=kr>function</span> <span class=nf>circle</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>n</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=n>canvas.ellipse</span><span class=p>(</span><span class=n>x</span><span class=o>-</span><span class=n>n</span><span class=p>,</span><span class=n>y</span><span class=o>-</span><span class=n>n</span><span class=p>,</span><span class=n>x</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=ln>26</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=c1>--画线</span>
</span></span><span class=line><span class=ln>28</span><span class=cl><span class=kr>function</span> <span class=nf>line</span><span class=p>(</span><span class=n>sourcex</span><span class=p>,</span><span class=n>sourcey</span><span class=p>,</span><span class=n>destinationx</span><span class=p>,</span><span class=n>destinationy</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln>29</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln>30</span><span class=cl><span class=n>canvas.line</span><span class=p>(</span><span class=n>sourcex</span><span class=p>,</span><span class=n>sourcey</span><span class=p>,</span><span class=n>destinationx</span><span class=p>,</span><span class=n>destinationy</span><span class=p>)</span>
</span></span><span class=line><span class=ln>31</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>32</span><span class=cl><span class=c1>--画虚线矩形</span>
</span></span><span class=line><span class=ln>33</span><span class=cl><span class=kr>function</span> <span class=nf>drawFocusRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>,</span><span class=n>Color</span><span class=p>)</span>
</span></span><span class=line><span class=ln>34</span><span class=cl><span class=n>Font</span><span class=p>(</span><span class=n>Color</span><span class=p>)</span>
</span></span><span class=line><span class=ln>35</span><span class=cl><span class=n>canvas.drawFocusRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>)</span>
</span></span><span class=line><span class=ln>36</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>37</span><span class=cl><span class=c1>--绘制圆角矩形</span>
</span></span><span class=line><span class=ln>38</span><span class=cl><span class=kr>function</span> <span class=nf>roundRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>,</span><span class=n>rx</span><span class=p>,</span><span class=n>ry</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln>39</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln>40</span><span class=cl><span class=n>canvas.roundRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>,</span><span class=n>rx</span><span class=p>,</span><span class=n>ry</span><span class=p>)</span>
</span></span><span class=line><span class=ln>41</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>42</span><span class=cl><span class=c1>--绘制矩形rect(x1,y1,x2,y2,Color,Width,b)如果b=true则绘制填充矩形</span>
</span></span><span class=line><span class=ln>43</span><span class=cl><span class=kr>function</span> <span class=nf>rect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>,</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=ln>44</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln>45</span><span class=cl><span class=kr>if</span> <span class=n>b</span><span class=o>~=</span> <span class=kc>true</span> <span class=kr>then</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>   <span class=n>canvas.rect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>)</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>     <span class=kr>else</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>   <span class=n>canvas.Brush</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=n>Color</span> <span class=ow>or</span> <span class=mh>0xff00ff</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>   <span class=n>canvas.fillRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>)</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>   <span class=n>canvas.Brush</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=kc>nil</span>
</span></span><span class=line><span class=ln>51</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>52</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>53</span><span class=cl><span class=c1>--刷新绘制</span>
</span></span><span class=line><span class=ln>54</span><span class=cl><span class=kr>function</span> <span class=nf>Refresh</span><span class=p>()</span>
</span></span><span class=line><span class=ln>55</span><span class=cl><span class=n>form.repaint</span><span class=p>()</span>
</span></span><span class=line><span class=ln>56</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>57</span><span class=cl><span class=c1>--绘制 传入function</span>
</span></span><span class=line><span class=ln>58</span><span class=cl><span class=kr>function</span> <span class=nf>draw</span><span class=p>(</span><span class=n>mydraw</span><span class=p>)</span>
</span></span><span class=line><span class=ln>59</span><span class=cl><span class=n>form.OnPaint</span><span class=o>=</span><span class=n>mydraw</span>     <span class=c1>--设置OnPaint</span>
</span></span><span class=line><span class=ln>60</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>61</span><span class=cl><span class=c1>--创建窗口</span>
</span></span><span class=line><span class=ln>62</span><span class=cl><span class=n>createTransparentWindow</span><span class=p>()</span>
</span></span><span class=line><span class=ln>63</span><span class=cl><span class=n>draw</span><span class=p>(</span><span class=kr>function</span> <span class=p>()</span>
</span></span><span class=line><span class=ln>64</span><span class=cl><span class=c1>--在这里写绘制</span>
</span></span><span class=line><span class=ln>65</span><span class=cl><span class=n>rect</span><span class=p>(</span><span class=mi>300</span><span class=p>,</span><span class=mi>400</span><span class=p>,</span><span class=mi>500</span><span class=p>,</span><span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=ln>66</span><span class=cl><span class=n>rect</span><span class=p>(</span><span class=mi>400</span><span class=p>,</span><span class=mi>700</span><span class=p>,</span><span class=mi>300</span><span class=p>,</span><span class=mi>450</span><span class=p>,</span><span class=mh>0xBC8F8F</span><span class=p>,</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=ln>67</span><span class=cl><span class=n>rect</span><span class=p>(</span><span class=mi>123</span><span class=p>,</span><span class=mi>321</span><span class=p>,</span><span class=mi>222</span><span class=p>,</span><span class=mi>100</span><span class=p>,</span><span class=mh>0xBC8F8F</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=ln>68</span><span class=cl><span class=n>line</span><span class=p>(</span><span class=mi>500</span><span class=p>,</span><span class=mi>500</span><span class=p>,</span><span class=mi>500</span><span class=p>,</span><span class=mi>800</span><span class=p>,</span><span class=mh>0xADFF2F</span><span class=p>,</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=ln>69</span><span class=cl><span class=n>circle</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span><span class=mi>400</span><span class=p>,</span><span class=mi>50</span><span class=p>,</span><span class=mh>0x000080</span><span class=p>,</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=ln>70</span><span class=cl><span class=n>textOut</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span><span class=mi>500</span><span class=p>,</span><span class=s1>&#39;要输出的文字&#39;</span><span class=p>,</span><span class=mh>0xDC143C</span><span class=p>,</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=ln>71</span><span class=cl><span class=kr>end</span><span class=p>)</span>
</span></span><span class=line><span class=ln>72</span><span class=cl><span class=n>Refresh</span><span class=p>()</span>
</span></span></code></pre></div><p>执行结果</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210002131867.webp width=1920 height=1022 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210002131867_hu5c20b2ee9db1366aece7cc76ac490164_27380_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210002131867_hu5c20b2ee9db1366aece7cc76ac490164_27380_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210002131867 class=gallery-image data-flex-grow=187 data-flex-basis=450px></p><h3 id=添加时钟实时绘制绘制模板>添加时钟实时绘制(绘制模板)</h3><p>该模板没有用到我的插件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>  1</span><span class=cl><span class=p>{</span><span class=err>$</span><span class=n>lua</span><span class=p>}</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl><span class=c1>--表示下面的代码为lua</span>
</span></span><span class=line><span class=ln>  3</span><span class=cl><span class=c1>--语法检测，如果语法有误则不执行</span>
</span></span><span class=line><span class=ln>  4</span><span class=cl><span class=kr>if</span> <span class=n>syntaxcheck</span> <span class=kr>then</span> <span class=kr>return</span> <span class=kr>end</span>
</span></span><span class=line><span class=ln>  5</span><span class=cl><span class=p>[</span><span class=n>ENABLE</span><span class=p>]</span>
</span></span><span class=line><span class=ln>  6</span><span class=cl><span class=c1>--code from here to &#39;[DISABLE]&#39; will be used to enable the cheat</span>
</span></span><span class=line><span class=ln>  7</span><span class=cl><span class=kr>function</span> <span class=nf>createTransparentWindow</span><span class=p>()</span>
</span></span><span class=line><span class=ln>  8</span><span class=cl>    <span class=n>form</span><span class=o>=</span><span class=n>createForm</span><span class=p>()</span>                   <span class=c1>--创建窗体</span>
</span></span><span class=line><span class=ln>  9</span><span class=cl>    <span class=n>canvas</span><span class=o>=</span><span class=n>form.Canvas</span>                  <span class=c1>--获取canvas</span>
</span></span><span class=line><span class=ln> 10</span><span class=cl>    <span class=n>form.Color</span><span class=o>=</span><span class=mh>0x000000</span>                 <span class=c1>--设置窗体颜色为黑色 和透明相关</span>
</span></span><span class=line><span class=ln> 11</span><span class=cl>    <span class=n>form.Width</span><span class=o>=</span><span class=n>getScreenWidth</span><span class=p>()</span>         <span class=c1>--设置窗体宽度为屏幕宽度</span>
</span></span><span class=line><span class=ln> 12</span><span class=cl>    <span class=n>form.Height</span><span class=o>=</span><span class=n>getScreenHeight</span><span class=p>()</span>       <span class=c1>--设置窗体高度为屏幕高度</span>
</span></span><span class=line><span class=ln> 13</span><span class=cl>    <span class=n>form.FormStyle</span><span class=o>=</span><span class=s1>&#39;fsSystemStayOnTop&#39;</span>  <span class=c1>--设置窗体风格为fsSystemStayOnTop,详见上方参考文档 这里为将窗口置顶</span>
</span></span><span class=line><span class=ln> 14</span><span class=cl>    <span class=n>form.BorderStyle</span><span class=o>=</span><span class=s1>&#39;bsNone&#39;</span>           <span class=c1>--设置窗体边界风格为bsNone，详见上方参考文档        这里为设置无边框</span>
</span></span><span class=line><span class=ln> 15</span><span class=cl>    <span class=n>form.setLayeredAttributes</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>LWA_COLORKEY</span><span class=p>)</span> <span class=c1>--设置窗口透明，详见上方参考文档</span>
</span></span><span class=line><span class=ln> 16</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 17</span><span class=cl><span class=c1>--设置画笔</span>
</span></span><span class=line><span class=ln> 18</span><span class=cl><span class=kr>function</span> <span class=nf>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 19</span><span class=cl><span class=n>canvas.Pen</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=n>Color</span> <span class=ow>or</span> <span class=mh>0xff00ff</span>
</span></span><span class=line><span class=ln> 20</span><span class=cl><span class=n>canvas.Pen</span><span class=p>.</span><span class=n>Width</span><span class=o>=</span><span class=n>Width</span> <span class=ow>or</span> <span class=mi>2</span>
</span></span><span class=line><span class=ln> 21</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl><span class=c1>--设置字体</span>
</span></span><span class=line><span class=ln> 23</span><span class=cl><span class=kr>function</span> <span class=nf>Font</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Size</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 24</span><span class=cl><span class=n>canvas.Font</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=n>Color</span> <span class=ow>or</span> <span class=mh>0xff00ff</span>
</span></span><span class=line><span class=ln> 25</span><span class=cl><span class=n>canvas.Font</span><span class=p>.</span><span class=n>Size</span><span class=o>=</span><span class=n>Size</span> <span class=ow>or</span> <span class=mi>12</span>
</span></span><span class=line><span class=ln> 26</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 27</span><span class=cl><span class=c1>--绘制文字</span>
</span></span><span class=line><span class=ln> 28</span><span class=cl><span class=kr>function</span> <span class=nf>textOut</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>text</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Size</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 29</span><span class=cl><span class=n>Font</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Size</span><span class=p>)</span>            <span class=c1>--设置字体</span>
</span></span><span class=line><span class=ln> 30</span><span class=cl><span class=n>canvas.Brush</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=kc>nil</span>      <span class=c1>--设置画刷颜色</span>
</span></span><span class=line><span class=ln> 31</span><span class=cl><span class=n>canvas.textOut</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>text</span><span class=p>)</span>    <span class=c1>--输出文字</span>
</span></span><span class=line><span class=ln> 32</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 33</span><span class=cl><span class=c1>--画椭圆</span>
</span></span><span class=line><span class=ln> 34</span><span class=cl><span class=kr>function</span> <span class=nf>ellipse</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 35</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 36</span><span class=cl><span class=n>canvas.ellipse</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 37</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl><span class=c1>--画圆</span>
</span></span><span class=line><span class=ln> 39</span><span class=cl><span class=kr>function</span> <span class=nf>circle</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>n</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 40</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl><span class=n>canvas.ellipse</span><span class=p>(</span><span class=n>x</span><span class=o>-</span><span class=n>n</span><span class=p>,</span><span class=n>y</span><span class=o>-</span><span class=n>n</span><span class=p>,</span><span class=n>x</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 42</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 43</span><span class=cl><span class=c1>--画线</span>
</span></span><span class=line><span class=ln> 44</span><span class=cl><span class=kr>function</span> <span class=nf>line</span><span class=p>(</span><span class=n>sourcex</span><span class=p>,</span><span class=n>sourcey</span><span class=p>,</span><span class=n>destinationx</span><span class=p>,</span><span class=n>destinationy</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 45</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl><span class=n>canvas.line</span><span class=p>(</span><span class=n>sourcex</span><span class=p>,</span><span class=n>sourcey</span><span class=p>,</span><span class=n>destinationx</span><span class=p>,</span><span class=n>destinationy</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 47</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 48</span><span class=cl><span class=c1>--画虚线矩形</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl><span class=kr>function</span> <span class=nf>drawFocusRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>,</span><span class=n>Color</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 50</span><span class=cl><span class=n>Font</span><span class=p>(</span><span class=n>Color</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 51</span><span class=cl><span class=n>canvas.drawFocusRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 52</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 53</span><span class=cl><span class=c1>--绘制圆角矩形</span>
</span></span><span class=line><span class=ln> 54</span><span class=cl><span class=kr>function</span> <span class=nf>roundRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>,</span><span class=n>rx</span><span class=p>,</span><span class=n>ry</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 55</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 56</span><span class=cl><span class=n>canvas.roundRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>,</span><span class=n>rx</span><span class=p>,</span><span class=n>ry</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 57</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 58</span><span class=cl><span class=c1>--绘制矩形rect(x1,y1,x2,y2,Color,Width,b)如果b=true则绘制填充矩形</span>
</span></span><span class=line><span class=ln> 59</span><span class=cl><span class=kr>function</span> <span class=nf>rect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>,</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 60</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 61</span><span class=cl><span class=kr>if</span> <span class=n>b</span><span class=o>~=</span> <span class=kc>true</span> <span class=kr>then</span>
</span></span><span class=line><span class=ln> 62</span><span class=cl>   <span class=n>canvas.rect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 63</span><span class=cl>     <span class=kr>else</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>   <span class=n>canvas.Brush</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=n>Color</span> <span class=ow>or</span> <span class=mh>0xff00ff</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>   <span class=n>canvas.fillRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 66</span><span class=cl>   <span class=n>canvas.Brush</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=kc>nil</span>
</span></span><span class=line><span class=ln> 67</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 68</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 69</span><span class=cl><span class=c1>--刷新绘制</span>
</span></span><span class=line><span class=ln> 70</span><span class=cl><span class=kr>function</span> <span class=nf>Refresh</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 71</span><span class=cl><span class=n>form.repaint</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 72</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 73</span><span class=cl><span class=c1>--绘制 传入function</span>
</span></span><span class=line><span class=ln> 74</span><span class=cl><span class=kr>function</span> <span class=nf>draw</span><span class=p>(</span><span class=n>mydraw</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl><span class=n>form.OnPaint</span><span class=o>=</span><span class=n>mydraw</span>     <span class=c1>--设置OnPaint</span>
</span></span><span class=line><span class=ln> 76</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 77</span><span class=cl><span class=n>createTransparentWindow</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 78</span><span class=cl><span class=n>cnt</span><span class=o>=</span><span class=mi>0</span>                    <span class=c1>--计数，用来表示动态刷新数值</span>
</span></span><span class=line><span class=ln> 79</span><span class=cl><span class=n>draw</span><span class=p>(</span><span class=kr>function</span> <span class=p>()</span>
</span></span><span class=line><span class=ln> 80</span><span class=cl><span class=c1>--在这里写绘制</span>
</span></span><span class=line><span class=ln> 81</span><span class=cl><span class=n>cnt</span><span class=o>=</span><span class=n>cnt</span><span class=o>+</span><span class=mi>1</span>
</span></span><span class=line><span class=ln> 82</span><span class=cl><span class=n>rect</span><span class=p>(</span><span class=mi>300</span><span class=p>,</span><span class=mi>400</span><span class=p>,</span><span class=mi>500</span><span class=p>,</span><span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 83</span><span class=cl><span class=n>rect</span><span class=p>(</span><span class=mi>400</span><span class=p>,</span><span class=mi>700</span><span class=p>,</span><span class=mi>300</span><span class=p>,</span><span class=mi>450</span><span class=p>,</span><span class=mh>0xBC8F8F</span><span class=p>,</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 84</span><span class=cl><span class=n>rect</span><span class=p>(</span><span class=mi>123</span><span class=p>,</span><span class=mi>321</span><span class=p>,</span><span class=mi>222</span><span class=p>,</span><span class=mi>100</span><span class=p>,</span><span class=mh>0xBC8F8F</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 85</span><span class=cl><span class=n>line</span><span class=p>(</span><span class=mi>500</span><span class=p>,</span><span class=mi>500</span><span class=p>,</span><span class=mi>500</span><span class=p>,</span><span class=mi>800</span><span class=p>,</span><span class=mh>0xADFF2F</span><span class=p>,</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 86</span><span class=cl><span class=n>circle</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span><span class=mi>400</span><span class=p>,</span><span class=mi>50</span><span class=p>,</span><span class=mh>0x000080</span><span class=p>,</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 87</span><span class=cl><span class=n>textOut</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span><span class=mi>500</span><span class=p>,</span><span class=n>cnt</span><span class=p>,</span><span class=mh>0xDC143C</span><span class=p>,</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 88</span><span class=cl><span class=kr>end</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 89</span><span class=cl><span class=c1>--创建Timer</span>
</span></span><span class=line><span class=ln> 90</span><span class=cl><span class=n>Timer</span><span class=o>=</span><span class=n>createTimer</span><span class=p>(</span><span class=n>getMainForm</span><span class=p>())</span>
</span></span><span class=line><span class=ln> 91</span><span class=cl><span class=c1>--时钟周期设置为0.1s</span>
</span></span><span class=line><span class=ln> 92</span><span class=cl><span class=n>Timer.Interval</span><span class=o>=</span><span class=mi>100</span>
</span></span><span class=line><span class=ln> 93</span><span class=cl><span class=c1>--添加时钟周期执行的函数</span>
</span></span><span class=line><span class=ln> 94</span><span class=cl><span class=n>Timer.OnTimer</span><span class=o>=</span> <span class=kr>function</span><span class=p>(</span><span class=n>timer</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 95</span><span class=cl><span class=c1>--刷新绘制</span>
</span></span><span class=line><span class=ln> 96</span><span class=cl><span class=n>Refresh</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 97</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 98</span><span class=cl><span class=p>[</span><span class=n>DISABLE</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 99</span><span class=cl><span class=c1>--code from here till the end of the code will be used to disable the cheat</span>
</span></span><span class=line><span class=ln>100</span><span class=cl><span class=n>Timer.Enabled</span><span class=o>=</span><span class=kc>false</span>
</span></span><span class=line><span class=ln>101</span><span class=cl><span class=n>Timer.destroy</span><span class=p>()</span>
</span></span><span class=line><span class=ln>102</span><span class=cl><span class=n>form.destroy</span><span class=p>()</span>
</span></span></code></pre></div><p>执行结果</p><p><img src=/%E7%BB%98%E5%88%B6%E6%A8%A1%E6%9D%BF.gif loading=lazy alt=绘制模板></p><h3 id=lua和asm混用>lua和asm混用</h3><p>Auto assembler scripts support section written in Lua.You can start such a section using the <a class=link href="https://wiki.cheatengine.org/index.php?title=Auto_Assembler:LUA_ASM" target=_blank rel=noopener>{$lua}</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span>keyword, and end it with <a class=link href="https://wiki.cheatengine.org/index.php?title=Auto_Assembler:LUA_ASM" target=_blank rel=noopener>{$asm}</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span>.</p><p>自动汇编脚本支持部分用Lua来写，你可以开始一段lua代码以 {$lua} 开始，以{$asm}结束lua代码</p><p>例:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=p>{</span><span class=err>$</span><span class=n>asm</span><span class=p>}</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=n>newmem</span><span class=p>,</span><span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=p>{</span><span class=err>$</span><span class=n>lua</span><span class=p>}</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=n>print</span><span class=p>(</span><span class=s1>&#39;this is lua&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=p>{</span><span class=err>$</span><span class=n>asm</span><span class=p>}</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=n>label</span><span class=p>(</span><span class=n>originalcode</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=修改绘制模板实现pvz僵尸血量绘制需要加载插件>修改绘制模板实现pvz僵尸血量绘制（需要加载插件）</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>  1</span><span class=cl><span class=p>{</span><span class=err>$</span><span class=n>lua</span><span class=p>}</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl><span class=c1>--表示下面的代码为lua</span>
</span></span><span class=line><span class=ln>  3</span><span class=cl><span class=c1>--语法检测，如果语法有误则不执行</span>
</span></span><span class=line><span class=ln>  4</span><span class=cl><span class=kr>if</span> <span class=n>syntaxcheck</span> <span class=kr>then</span> <span class=kr>return</span> <span class=kr>end</span>
</span></span><span class=line><span class=ln>  5</span><span class=cl><span class=p>[</span><span class=n>ENABLE</span><span class=p>]</span>
</span></span><span class=line><span class=ln>  6</span><span class=cl><span class=c1>--code from here to &#39;[DISABLE]&#39; will be used to enable the cheat</span>
</span></span><span class=line><span class=ln>  7</span><span class=cl><span class=kr>function</span> <span class=nf>createTransparentWindow</span><span class=p>()</span>
</span></span><span class=line><span class=ln>  8</span><span class=cl>    <span class=n>form</span><span class=o>=</span><span class=n>createForm</span><span class=p>()</span>                   <span class=c1>--创建窗体</span>
</span></span><span class=line><span class=ln>  9</span><span class=cl>    <span class=n>canvas</span><span class=o>=</span><span class=n>form.Canvas</span>                  <span class=c1>--获取canvas</span>
</span></span><span class=line><span class=ln> 10</span><span class=cl>    <span class=n>form.Color</span><span class=o>=</span><span class=mh>0x000000</span>                 <span class=c1>--设置窗体颜色为黑色 和透明相关</span>
</span></span><span class=line><span class=ln> 11</span><span class=cl>    <span class=n>form.Width</span><span class=o>=</span><span class=n>getScreenWidth</span><span class=p>()</span>         <span class=c1>--设置窗体宽度为屏幕宽度</span>
</span></span><span class=line><span class=ln> 12</span><span class=cl>    <span class=n>form.Height</span><span class=o>=</span><span class=n>getScreenHeight</span><span class=p>()</span>       <span class=c1>--设置窗体高度为屏幕高度</span>
</span></span><span class=line><span class=ln> 13</span><span class=cl>    <span class=n>form.FormStyle</span><span class=o>=</span><span class=s1>&#39;fsSystemStayOnTop&#39;</span>  <span class=c1>--设置窗体风格为fsSystemStayOnTop,详见上方参考文档 这里为将窗口置顶</span>
</span></span><span class=line><span class=ln> 14</span><span class=cl>    <span class=n>form.BorderStyle</span><span class=o>=</span><span class=s1>&#39;bsNone&#39;</span>           <span class=c1>--设置窗体边界风格为bsNone，详见上方参考文档        这里为设置无边框</span>
</span></span><span class=line><span class=ln> 15</span><span class=cl>    <span class=n>form.setLayeredAttributes</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>LWA_COLORKEY</span><span class=p>)</span> <span class=c1>--设置窗口透明，详见上方参考文档</span>
</span></span><span class=line><span class=ln> 16</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 17</span><span class=cl><span class=c1>--设置画笔</span>
</span></span><span class=line><span class=ln> 18</span><span class=cl><span class=kr>function</span> <span class=nf>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 19</span><span class=cl><span class=n>canvas.Pen</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=n>Color</span> <span class=ow>or</span> <span class=mh>0xff00ff</span>
</span></span><span class=line><span class=ln> 20</span><span class=cl><span class=n>canvas.Pen</span><span class=p>.</span><span class=n>Width</span><span class=o>=</span><span class=n>Width</span> <span class=ow>or</span> <span class=mi>2</span>
</span></span><span class=line><span class=ln> 21</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl><span class=c1>--设置字体</span>
</span></span><span class=line><span class=ln> 23</span><span class=cl><span class=kr>function</span> <span class=nf>Font</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Size</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 24</span><span class=cl><span class=n>canvas.Font</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=n>Color</span> <span class=ow>or</span> <span class=mh>0xff00ff</span>
</span></span><span class=line><span class=ln> 25</span><span class=cl><span class=n>canvas.Font</span><span class=p>.</span><span class=n>Size</span><span class=o>=</span><span class=n>Size</span> <span class=ow>or</span> <span class=mi>12</span>
</span></span><span class=line><span class=ln> 26</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 27</span><span class=cl><span class=c1>--绘制文字</span>
</span></span><span class=line><span class=ln> 28</span><span class=cl><span class=kr>function</span> <span class=nf>textOut</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>text</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Size</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 29</span><span class=cl><span class=n>Font</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Size</span><span class=p>)</span>            <span class=c1>--设置字体</span>
</span></span><span class=line><span class=ln> 30</span><span class=cl><span class=n>canvas.Brush</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=kc>nil</span>      <span class=c1>--设置画刷颜色</span>
</span></span><span class=line><span class=ln> 31</span><span class=cl><span class=n>canvas.textOut</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>text</span><span class=p>)</span>    <span class=c1>--输出文字</span>
</span></span><span class=line><span class=ln> 32</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 33</span><span class=cl><span class=c1>--画椭圆</span>
</span></span><span class=line><span class=ln> 34</span><span class=cl><span class=kr>function</span> <span class=nf>ellipse</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 35</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 36</span><span class=cl><span class=n>canvas.ellipse</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 37</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl><span class=c1>--画圆</span>
</span></span><span class=line><span class=ln> 39</span><span class=cl><span class=kr>function</span> <span class=nf>circle</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>n</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 40</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl><span class=n>canvas.ellipse</span><span class=p>(</span><span class=n>x</span><span class=o>-</span><span class=n>n</span><span class=p>,</span><span class=n>y</span><span class=o>-</span><span class=n>n</span><span class=p>,</span><span class=n>x</span><span class=o>+</span><span class=n>n</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 42</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 43</span><span class=cl><span class=c1>--画线</span>
</span></span><span class=line><span class=ln> 44</span><span class=cl><span class=kr>function</span> <span class=nf>line</span><span class=p>(</span><span class=n>sourcex</span><span class=p>,</span><span class=n>sourcey</span><span class=p>,</span><span class=n>destinationx</span><span class=p>,</span><span class=n>destinationy</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 45</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl><span class=n>canvas.line</span><span class=p>(</span><span class=n>sourcex</span><span class=p>,</span><span class=n>sourcey</span><span class=p>,</span><span class=n>destinationx</span><span class=p>,</span><span class=n>destinationy</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 47</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 48</span><span class=cl><span class=c1>--画虚线矩形</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl><span class=kr>function</span> <span class=nf>drawFocusRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>,</span><span class=n>Color</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 50</span><span class=cl><span class=n>Font</span><span class=p>(</span><span class=n>Color</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 51</span><span class=cl><span class=n>canvas.drawFocusRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 52</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 53</span><span class=cl><span class=c1>--绘制圆角矩形</span>
</span></span><span class=line><span class=ln> 54</span><span class=cl><span class=kr>function</span> <span class=nf>roundRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>,</span><span class=n>rx</span><span class=p>,</span><span class=n>ry</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 55</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 56</span><span class=cl><span class=n>canvas.roundRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>,</span><span class=n>rx</span><span class=p>,</span><span class=n>ry</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 57</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 58</span><span class=cl><span class=c1>--绘制矩形rect(x1,y1,x2,y2,Color,Width,b)如果b=true则绘制填充矩形</span>
</span></span><span class=line><span class=ln> 59</span><span class=cl><span class=kr>function</span> <span class=nf>rect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>,</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>,</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 60</span><span class=cl><span class=n>Pen</span><span class=p>(</span><span class=n>Color</span><span class=p>,</span><span class=n>Width</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 61</span><span class=cl><span class=kr>if</span> <span class=n>b</span><span class=o>~=</span> <span class=kc>true</span> <span class=kr>then</span>
</span></span><span class=line><span class=ln> 62</span><span class=cl>   <span class=n>canvas.rect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 63</span><span class=cl>     <span class=kr>else</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>   <span class=n>canvas.Brush</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=n>Color</span> <span class=ow>or</span> <span class=mh>0xff00ff</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>   <span class=n>canvas.fillRect</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span><span class=n>y1</span><span class=p>,</span><span class=n>x2</span><span class=p>,</span><span class=n>y2</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 66</span><span class=cl>   <span class=n>canvas.Brush</span><span class=p>.</span><span class=n>Color</span><span class=o>=</span><span class=kc>nil</span>
</span></span><span class=line><span class=ln> 67</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 68</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 69</span><span class=cl><span class=c1>--刷新绘制</span>
</span></span><span class=line><span class=ln> 70</span><span class=cl><span class=kr>function</span> <span class=nf>Refresh</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 71</span><span class=cl><span class=n>form.repaint</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 72</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 73</span><span class=cl><span class=c1>--绘制 传入function</span>
</span></span><span class=line><span class=ln> 74</span><span class=cl><span class=kr>function</span> <span class=nf>draw</span><span class=p>(</span><span class=n>mydraw</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl><span class=n>form.OnPaint</span><span class=o>=</span><span class=n>mydraw</span>     <span class=c1>--设置OnPaint</span>
</span></span><span class=line><span class=ln> 76</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln> 77</span><span class=cl>
</span></span><span class=line><span class=ln> 78</span><span class=cl><span class=n>createTransparentWindow</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 79</span><span class=cl><span class=c1>--获取窗口句柄    --这里的窗口类名MainWindow是事先用Spy++查看的 根据窗口类名得到窗口句柄</span>
</span></span><span class=line><span class=ln> 80</span><span class=cl><span class=n>handle</span><span class=o>=</span><span class=n>findWindow</span><span class=p>(</span><span class=s1>&#39;MainWindow&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 81</span><span class=cl><span class=c1>--获取窗口标题</span>
</span></span><span class=line><span class=ln> 82</span><span class=cl><span class=n>caption</span><span class=o>=</span><span class=n>getWindowCaption</span><span class=p>(</span><span class=n>handle</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 83</span><span class=cl><span class=c1>--print(ansiToUtf8(caption))</span>
</span></span><span class=line><span class=ln> 84</span><span class=cl>
</span></span><span class=line><span class=ln> 85</span><span class=cl><span class=n>draw</span><span class=p>(</span><span class=kr>function</span> <span class=p>()</span>
</span></span><span class=line><span class=ln> 86</span><span class=cl><span class=c1>--在这里写绘制</span>
</span></span><span class=line><span class=ln> 87</span><span class=cl>
</span></span><span class=line><span class=ln> 88</span><span class=cl><span class=c1>--调用插件提供的函数获取窗口的位置信息</span>
</span></span><span class=line><span class=ln> 89</span><span class=cl><span class=n>left</span><span class=p>,</span><span class=n>top</span><span class=p>,</span><span class=n>right</span><span class=p>,</span><span class=n>bottom</span><span class=o>=</span><span class=n>GetWindowRect</span><span class=p>(</span><span class=n>handle</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 90</span><span class=cl>
</span></span><span class=line><span class=ln> 91</span><span class=cl><span class=n>num</span><span class=o>=</span><span class=n>readInteger</span><span class=p>(</span><span class=s2>&#34;[[006a9ec0]+768]+94&#34;</span><span class=p>)</span><span class=c1>--得到僵尸数上限</span>
</span></span><span class=line><span class=ln> 92</span><span class=cl><span class=c1>--print(num)</span>
</span></span><span class=line><span class=ln> 93</span><span class=cl><span class=n>addr</span><span class=o>=</span><span class=n>readInteger</span><span class=p>(</span><span class=s2>&#34;[[006a9ec0]+768]+90&#34;</span><span class=p>)</span>   <span class=c1>--得到僵尸数组头部地址</span>
</span></span><span class=line><span class=ln> 94</span><span class=cl><span class=n>cnt</span><span class=o>=</span><span class=mi>0</span>                                     <span class=c1>--记录僵尸个数，达到数量上限则停止循环</span>
</span></span><span class=line><span class=ln> 95</span><span class=cl><span class=c1>--开始遍历僵尸数组并绘制</span>
</span></span><span class=line><span class=ln> 96</span><span class=cl><span class=kr>while</span><span class=p>(</span> <span class=kc>true</span> <span class=p>)</span>
</span></span><span class=line><span class=ln> 97</span><span class=cl><span class=kr>do</span> 
</span></span><span class=line><span class=ln> 98</span><span class=cl>  <span class=n>tmp</span><span class=o>=</span><span class=n>addr</span><span class=o>+</span><span class=n>cnt</span><span class=o>*</span><span class=mh>0x15c</span>             <span class=c1>--获得僵尸地址</span>
</span></span><span class=line><span class=ln> 99</span><span class=cl>
</span></span><span class=line><span class=ln>100</span><span class=cl>  <span class=n>hp</span><span class=o>=</span><span class=n>readInteger</span><span class=p>(</span><span class=n>tmp</span><span class=o>+</span><span class=mh>0xc8</span><span class=p>)</span>     <span class=c1>--读取血量</span>
</span></span><span class=line><span class=ln>101</span><span class=cl>  <span class=n>x</span><span class=o>=</span><span class=n>readInteger</span><span class=p>(</span><span class=n>tmp</span><span class=o>+</span><span class=mh>0x8</span><span class=p>)</span>
</span></span><span class=line><span class=ln>102</span><span class=cl>  <span class=n>y</span><span class=o>=</span><span class=n>readInteger</span><span class=p>(</span><span class=n>tmp</span><span class=o>+</span><span class=mh>0xc</span><span class=p>)</span>
</span></span><span class=line><span class=ln>103</span><span class=cl>  <span class=kr>if</span><span class=p>(</span><span class=n>x</span><span class=o>&lt;</span><span class=mi>800</span> <span class=ow>and</span> <span class=n>hp</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span> <span class=kr>then</span>      <span class=c1>--判断位置是否在屏幕外和血量是否归零</span>
</span></span><span class=line><span class=ln>104</span><span class=cl>  <span class=n>rect</span><span class=p>(</span><span class=n>x</span><span class=o>+</span><span class=mi>10</span><span class=o>+</span><span class=n>left</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=mi>50</span><span class=o>+</span><span class=n>top</span><span class=p>,</span><span class=n>x</span><span class=o>+</span><span class=mi>100</span><span class=o>+</span><span class=n>left</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=mi>180</span><span class=o>+</span><span class=n>top</span><span class=p>,</span><span class=mh>0xBC8F8F</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=ln>105</span><span class=cl>  <span class=n>textOut</span><span class=p>(</span><span class=n>x</span><span class=o>+</span><span class=mi>20</span><span class=o>+</span><span class=n>left</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=mi>10</span><span class=o>+</span><span class=n>top</span><span class=p>,</span><span class=n>hp</span><span class=p>,</span><span class=mh>0xDC143C</span><span class=p>,</span><span class=mi>12</span><span class=p>)</span>
</span></span><span class=line><span class=ln>106</span><span class=cl>  <span class=kr>end</span>
</span></span><span class=line><span class=ln>107</span><span class=cl>
</span></span><span class=line><span class=ln>108</span><span class=cl>  <span class=c1>--print(&#34;僵尸&#34;,cnt+1,&#34;号&#34;,&#34;hp:&#34;,hp)</span>
</span></span><span class=line><span class=ln>109</span><span class=cl>  <span class=c1>--print(&#34;僵尸&#34;,cnt+1,&#34;号&#34;,&#34;x坐标:&#34;,x)</span>
</span></span><span class=line><span class=ln>110</span><span class=cl>  <span class=c1>--print(&#34;僵尸&#34;,cnt+1,&#34;号&#34;,&#34;y坐标:&#34;,y)</span>
</span></span><span class=line><span class=ln>111</span><span class=cl>  <span class=n>cnt</span><span class=o>=</span><span class=n>cnt</span><span class=o>+</span><span class=mi>1</span>
</span></span><span class=line><span class=ln>112</span><span class=cl>  <span class=kr>if</span><span class=p>(</span><span class=n>cnt</span><span class=o>&gt;=</span><span class=n>num</span><span class=p>)</span>
</span></span><span class=line><span class=ln>113</span><span class=cl>  <span class=kr>then</span>
</span></span><span class=line><span class=ln>114</span><span class=cl>      <span class=kr>break</span>
</span></span><span class=line><span class=ln>115</span><span class=cl>  <span class=kr>end</span>
</span></span><span class=line><span class=ln>116</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>117</span><span class=cl>
</span></span><span class=line><span class=ln>118</span><span class=cl><span class=kr>end</span><span class=p>)</span>
</span></span><span class=line><span class=ln>119</span><span class=cl><span class=c1>--创建Timer</span>
</span></span><span class=line><span class=ln>120</span><span class=cl><span class=n>Timer</span><span class=o>=</span><span class=n>createTimer</span><span class=p>(</span><span class=n>getMainForm</span><span class=p>())</span>
</span></span><span class=line><span class=ln>121</span><span class=cl><span class=c1>--时钟周期设置为0.1s</span>
</span></span><span class=line><span class=ln>122</span><span class=cl><span class=n>Timer.Interval</span><span class=o>=</span><span class=mi>100</span>
</span></span><span class=line><span class=ln>123</span><span class=cl><span class=c1>--添加时钟周期执行的函数</span>
</span></span><span class=line><span class=ln>124</span><span class=cl><span class=n>Timer.OnTimer</span><span class=o>=</span> <span class=kr>function</span><span class=p>(</span><span class=n>timer</span><span class=p>)</span>
</span></span><span class=line><span class=ln>125</span><span class=cl><span class=c1>--刷新绘制</span>
</span></span><span class=line><span class=ln>126</span><span class=cl><span class=n>Refresh</span><span class=p>()</span>
</span></span><span class=line><span class=ln>127</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>128</span><span class=cl><span class=p>[</span><span class=n>DISABLE</span><span class=p>]</span>
</span></span><span class=line><span class=ln>129</span><span class=cl><span class=c1>--code from here till the end of the code will be used to disable the cheat</span>
</span></span><span class=line><span class=ln>130</span><span class=cl><span class=n>Timer.Enabled</span><span class=o>=</span><span class=kc>false</span>
</span></span><span class=line><span class=ln>131</span><span class=cl><span class=n>Timer.destroy</span><span class=p>()</span>
</span></span><span class=line><span class=ln>132</span><span class=cl><span class=n>form.destroy</span><span class=p>()</span>
</span></span></code></pre></div><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210015207888.webp width=752 height=579 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210015207888_hu2ba41a0a84f052689332027d18573482_56250_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210015207888_hu2ba41a0a84f052689332027d18573482_56250_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210015207888 class=gallery-image data-flex-grow=129 data-flex-basis=311px></p><p>可以将以上代码复制到自动汇编窗口里然后 文件→分配到当前的CT表以后执行</p><h4 id=不使用插件插件使用lua间接调用>不使用插件插件使用LUA间接调用</h4><p>上述代码加上这个方法即无需插件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln> 1</span><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>GetWindowRect</span><span class=p>(</span><span class=n>hWnd</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1>--创建一个内存流</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=kd>local</span> <span class=n>My</span> <span class=o>=</span> <span class=n>createMemoryStream</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1>--设置流的大小</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=n>My.Size</span><span class=o>=</span> <span class=mi>16</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1>--获取要调用的方法地址</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1>--user32为要调用的模块名 后面的GetWindowRect为要调用的方法（该方法在user32模块中）,hWnd是要调用的参数</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1>--调用win32 API</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=n>executeCodeLocalEx</span><span class=p>(</span><span class=s1>&#39;user32.GetWindowRect&#39;</span><span class=p>,</span><span class=n>hWnd</span><span class=p>,</span><span class=n>My.Memory</span><span class=p>)</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=kd>local</span> <span class=n>left</span><span class=o>=</span> <span class=n>My.readDword</span><span class=p>()</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=kr>if</span> <span class=n>left</span> <span class=o>&gt;</span> <span class=mh>0xffffff</span> <span class=kr>then</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=n>left</span><span class=o>=</span> <span class=o>-</span><span class=mh>0xfffffffe</span><span class=o>~</span><span class=n>left</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=kd>local</span> <span class=n>top</span><span class=o>=</span><span class=n>My.readDword</span><span class=p>()</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=kd>local</span> <span class=n>right</span><span class=o>=</span><span class=n>My.readDword</span><span class=p>()</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=kd>local</span> <span class=n>bottom</span><span class=o>=</span><span class=n>My.readDword</span><span class=p>()</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=n>My.destroy</span><span class=p>()</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=kr>return</span> <span class=n>left</span><span class=p>,</span><span class=n>top</span><span class=p>,</span><span class=n>right</span><span class=p>,</span><span class=n>bottom</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h2 id=lua参考文档>LUA参考文档</h2><h2 id=lua文档查询>LUA文档查询</h2><p>CE Lua的相关接口可以参考：</p><p><a class=link href="https://wiki.cheatengine.org/index.php?title=Lua" target=_blank rel=noopener>https://wiki.cheatengine.org/index.php?title=Lua</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>具体函数的内容通过 帮助(H)→Cheat Engine Lua文件来查看：</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210209184722820.webp width=1594 height=1426 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210209184722820_hubca69d095ebb608d132fffafd91ade30_222462_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210209184722820_hubca69d095ebb608d132fffafd91ade30_222462_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210209184722820 class=gallery-image data-flex-grow=111 data-flex-basis=268px></p><h2 id=lua常用函数介绍>LUA常用函数介绍</h2><h3 id=数据读取相关>数据读取相关</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=kr>function</span> <span class=nf>readInteger</span><span class=p>(</span><span class=n>Address</span><span class=p>)</span> <span class=p>:</span> <span class=n>integer</span>
</span></span></code></pre></div><p>Reads a DWORD (4 bytes) at the given address and interprets them as an integer</p><p>在给定的地址读取一个DWORD（4字节）并且将他们以integer(整型)类型返回</p><ul><li>参数:要读取的地址</li><li>参数类型： <a class=link href="https://wiki.cheatengine.org/index.php?title=CEAddressString" target=_blank rel=noopener>CEAddressString</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span>或 Integer</li><li>返回值：地址里存储的数据</li><li>返回值类型：integer</li></ul><p>CEAddressString是CE自己定义的一种数据类型，是CE内部的一种格式化的字符串，作为 internal symbol handler(内部符号handler)用来表示一个地址，例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>sun</span><span class=o>=</span><span class=n>readInteger</span><span class=p>(</span><span class=s2>&#34;[[006a9ec0]+768]+5560&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>读取阳光的数值，[]代表读取地址里面的值，这里面的偏移默认就是十六进制</p><p>同样的也可以写成</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>addr</span><span class=o>=</span><span class=n>readInteger</span><span class=p>(</span><span class=mh>0x6a9ec0</span><span class=p>)</span>      <span class=c1>--这里注意要加上0x 表示十六进制</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=n>addr</span><span class=o>=</span><span class=n>addr</span><span class=o>+</span><span class=mh>0x768</span>         <span class=c1>--一级偏移</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=n>addr</span><span class=o>=</span><span class=n>readInteger</span><span class=p>(</span><span class=n>addr</span><span class=p>)</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=n>addr</span><span class=o>=</span><span class=n>addr</span><span class=o>+</span><span class=mh>0x5560</span>            <span class=c1>--二级偏移</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=n>sun</span><span class=o>=</span><span class=n>readInteger</span><span class=p>(</span><span class=n>addr</span><span class=p>)</span>
</span></span></code></pre></div><p>和数据读取相关的函数还有很多，如</p><p><a class=link href="https://wiki.cheatengine.org/index.php?title=Lua:readBytes" target=_blank rel=noopener>readBytes</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p><a class=link href="https://wiki.cheatengine.org/index.php?title=Lua:readSmallInteger" target=_blank rel=noopener>readSmallInteger</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p><a class=link href="https://wiki.cheatengine.org/index.php?title=Lua:readQword" target=_blank rel=noopener>readQword</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p><a class=link href="https://wiki.cheatengine.org/index.php?title=Lua:readPointer" target=_blank rel=noopener>readPointer</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p><a class=link href="https://wiki.cheatengine.org/index.php?title=Lua:readFloat" target=_blank rel=noopener>readFloat</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p><a class=link href="https://wiki.cheatengine.org/index.php?title=Lua:readDouble" target=_blank rel=noopener>readDouble</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p><a class=link href="https://wiki.cheatengine.org/index.php?title=Lua:readString" target=_blank rel=noopener>readString</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>其使用方法大同小异，我这里就不每个都介绍了，感兴趣的可以自己去研究研究</p><p>而我的教程里只用到了readInteger于是接着介绍其它Lua函数了</p><p>接下来介绍有关绘制的相关类，主要是<strong>自己翻译和补充了</strong>一下参考文档，之前<strong>绘制透明窗口用到相关的类</strong>，类的来源在这里</p><h3 id=绘制相关类参考文档>绘制相关类(参考文档)</h3><h4 id=form-class>Form Class</h4><p>(Inheritance: ScrollingWinControl->CustomControl->WinControl->Control->Component->Object)</p><p><strong>Form的Canvas属性继承自CustomControl、Color属性继承自Control</strong></p><p><strong>Form的setLayeredAttributes方法继承自WinControl</strong></p><p>这里的Form是<strong>Delphi</strong>绘制的Form，Form属性可参考DelPhi的Form，PS：<strong>CE的文档并不是很全</strong></p><p>Delphi Form参考链接:<a class=link href=http://docwiki.embarcadero.com/Libraries/Sydney/en/Vcl.Forms.TForm_Properties target=_blank rel=noopener>http://docwiki.embarcadero.com/Libraries/Sydney/en/Vcl.Forms.TForm_Properties</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>属性（列举了CE文档里没有的）</p><p>FormStyle（窗体样式）:</p><div class=table-wrapper><table><thead><tr><th>Value（值）</th><th><strong>Meaning</strong>（意义）</th></tr></thead><tbody><tr><td>fsNormal</td><td>该窗体既不是MDI父窗口，也不是MDI子窗口</td></tr><tr><td>fsMDIChild</td><td>该窗体是一个MDI子窗口</td></tr><tr><td>fsMDIForm</td><td>该窗体是一个MDI父窗口</td></tr><tr><td>fsStayOnTop</td><td>该窗体始终在桌面和项目中的其他窗体的顶部，但FormStyle设置为fsStayOnTop的其他窗体除外。如果一个fsStayOnTop窗体启动另一个fsStayOnTop窗体，那么两个表单都不会始终保持在顶部</td></tr></tbody></table></div><p>参考链接：<a class=link href=http://docwiki.embarcadero.com/Libraries/Sydney/en/Vcl.Forms.TForm.FormStyle target=_blank rel=noopener>http://docwiki.embarcadero.com/Libraries/Sydney/en/Vcl.Forms.TForm.FormStyle</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>BorderStyle（边界样式）</p><div class=table-wrapper><table><thead><tr><th><strong>Value</strong>（值）</th><th><strong>Meaning</strong>（意义）</th></tr></thead><tbody><tr><td>bsDialog</td><td>不能调整大小的;没有菜单最小化或最大化</td></tr><tr><td>bsSingle</td><td>没有可调整大小的;有最小化或最大化菜单</td></tr><tr><td>bsNone</td><td>没有可调整大小的;无可见边界线</td></tr><tr><td>bsSizeable</td><td>标准可调整大小的边界</td></tr><tr><td>bsToolWindow</td><td>像bsSingle，但是标题更小</td></tr><tr><td>bsSizeToolWin</td><td>像bsSizeable但标题要小一些</td></tr></tbody></table></div><p>参考链接：<a class=link href=http://docwiki.embarcadero.com/Libraries/Sydney/en/Vcl.Forms.TCustomForm.BorderStyle target=_blank rel=noopener>http://docwiki.embarcadero.com/Libraries/Sydney/en/Vcl.Forms.TCustomForm.BorderStyle</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><h4 id=custmcontrol-class>CustmControl class</h4><p>(CustomControl->WinControl->Control->Component->Object)</p><p>属性</p><ul><li><strong>Canvas</strong>(画布) : 在控件中用来绘制的画布对象</li><li>OnPaint: 一个OnPaint 事件，你可以设置它来做一些额外的绘制</li></ul><p>方法</p><ul><li>getCanvas() : 在给定的对象(这个对象继承自customControl)中返回Canvas对象</li></ul><h4 id=wincontrol-class>WinControl Class</h4><p>属性</p><ul><li>Handle（句柄）: Integer - The internal windows handle（内部窗口局部）</li><li>DoubleBuffered（双缓冲）: boolean - Graphical updates will go to a offscreen bitmap which will then be shown on the screen instead of directly to the screen. May reduce flickering（图形更新将转到屏幕外的位图，然后该位图将显示在屏幕上，而不是直接显示在屏幕上。可减少闪烁）</li><li>ControlCount(控件数) : integer - The number of child controls of this wincontrol(这个控件的子控件数)</li><li>Control[] （子控件数组）: Control - Array to access a child control（子控件数组 用来访问子控件）</li><li>OnEnter（进入事件） : function - Function to be called when the WinControl gains focus（当该控件获取焦点时被调用的事件）</li><li>OnExit （退出事件）: function - Function to be called when the WinControl loses focus（当该控件失去焦点时被调用的事件）</li></ul><p>方法</p><ul><li>getControlCount()  Returns the number of Controls attached to this class（返回依附此类的控件数）</li><li>getControl(index) : Returns a WinControl class object（返回一个WinControl 类对象）</li><li>getControlAtPos(x,y):  Gets the control at the given x,y position relative to the wincontrol&rsquo;s position（获取相对于wincontrol位置的给定x，y位置的控件）</li><li>canFocus(): returns true if the object can be focused（返回真如果如果该对象可被聚焦）</li><li>focused(): returns boolean true when focused（返回真如果该对象正获得焦点）</li><li>setFocus(): tries to set keyboard focus the object（尝试设置对象的键盘焦点）</li><li>setShape(Region): Sets the region object as the new shape for this wincontrol（设置region对象作为该控件的新形状）</li><li>setShape(Bitmap):</li><li>setOnEnter(function) : Sets an onEnter event. (Triggered on focus enter)（设置一个进入事件 当焦点进入时触发）</li><li>getOnEnter()</li><li>setOnExit(function) : Sets an onExit event. (Triggered on lost focus)(设置一个退出事件 当焦点失去时触发)</li><li>getOnExit()</li><li><strong>setLayeredAttributes(Key, Alpha, Flags)</strong> : Sets the layered state for the control if possible (Only Forms are supported in in windows 7 and earlier) （如果可行的话 为控件设置层次状态（windows 7及更早版本中仅支持窗体））flags can be a combination of LWA_ALPHA and/or LWA_COLORKEY （标志可以是 LWA_ALPHA 和/或LWA_COLORKEY ）<br>See msdn SetLayeredWindowAttributes for more information（参考msdn的SetLayeredWindowAttributes 来获取更多信息）</li></ul><p>LWA_ALPHA时：crKey参数无效，bAlpha参数有效；</p><p>LWA_COLORKEY：<a class=link href=https://baike.baidu.com/item/%E7%AA%97%E4%BD%93 target=_blank rel=noopener>窗体</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span>中的所有颜色为crKey的地方将变为透明，bAlpha参数无效。其常量值为1。</p><p>LWA_ALPHA | LWA_COLORKEY：crKey的地方将变为全透明，而其它地方根据bAlpha参数确定透明度。</p><h4 id=control-class>Control Class</h4><p>(Inheritance: Component->Object)</p><p>属性</p><ul><li><p>Caption（标题）: string - The text of a control（控件文本）</p></li><li><p>Top（顶部） : integer - The x position（x位置）</p></li><li><p>Left （左边）: integer - The y position（y位置）</p></li><li><p>Width （宽）: integer - The width of the control（控件宽度）</p></li><li><p>Height （高）: integer - The height of the control（控件高度）</p></li><li><p>ClientWidth（Client宽度）: integer - The usable width inside the control (minus the borders)（在控件里的可用宽度,减少边界）</p></li><li><p>ClientHeight（Client高度）: integer - The usable height the control (minus the borders)（在控件里的可用高度,减少边界）  </p></li><li><p>Align(对齐): AlignmentOption - Alignment of the control（控件对齐）</p></li><li><p>Enabled（启用）: boolean - Determines if the object is usable or greyed out（决定对象是否可用）</p></li><li><p>Visible（可见）: boolean - Determines if the object is visible or not（决定对象是否可见）</p></li><li><p><strong>Color</strong>（颜色）: ColorDefinition/RGBInteger - The color of the object. Does not affect the caption（对象的颜色，不影响标题）</p></li><li><p>RGBColor（RGB颜色）: RGBInteger - The color of the object in RGB formatting（对象的颜色，RGB格式）</p></li><li><p>Parent（父类）: WinControl - The owner of this control（这个控件的拥有者）</p></li><li><p>PopupMenu（弹出菜单）: PopupMenu - The popup menu that shows when rightclicking the control</p><p>弹出菜单（在右键控件时显示）</p></li><li><p>Font（字体）: Font - The font class associated with the control</p><p>和控件绑定的字体类</p></li><li><p>OnClick(点击事件): function(sender) - The function to call when a button is pressed</p><p>当按钮按下后被调用的方法</p></li><li><p>OnChangeBounds（改变Bounds事件）:function(sender) - Called when the size or position of the control changes</p><p>当控件的大小或位置改变时调用的方法</p></li></ul><h4 id=canvas-class>Canvas Class</h4><p>(Inheritance: CustomCanvas->Object)</p><p>属性</p><ul><li>Brush（画刷）: Brush - The brush object</li><li>Pen（画笔）: Pen - The pen object</li><li>Font（字体）: Font - The font object</li><li>Width（宽）: integer - Width of the canvas</li><li>Height（高）: integer - Height of the canvas</li><li>Handle（句柄）: integer - DC handle of the canvas</li></ul><p>方法</p><ul><li><p>getBrush(): Returns the brush object of this canvas（返回该画布的画刷对象）</p></li><li><p>getPen(): Returns the pen object of this canvas（返回该画布的画笔对象）</p></li><li><p>getFont(): Returns the font object of this canvas（返回该画布的字体对象）</p></li><li><p>getWidth()（返回画布宽度）</p></li><li><p>getHeight()（返回画布高度）</p></li><li><p>getPenPosition()（获得画笔位置）</p></li><li><p>setPenPosition(x,y)（设置画笔位置）</p></li><li><p>clear() - Clears the canvas（清空画布）</p></li><li><p>line(sourcex, sourcey, destinationx, destinationy)（画线，参数为(起点x坐标，起点y坐标，终点x坐标，终点y坐标)）</p></li><li><p>lineTo(destinationx, destinationy)（添加一个新点，然后创建从该点到画布中最后指定点的线条）</p></li><li><p>moveTo(destinationx, destinationy)（开始一条路径，移动到位置 x,y）</p></li><li><p>rect(x1,y1,x2,y2) - Draws a rectangle（画一个矩形 参数（矩形左上顶点x,矩形左上顶点y，矩形右下顶点x，矩形右下顶点y））</p></li><li><p>fillRect(x1,y1,x2,y2) - Draws a filled rectangle(画一个填充的矩形)</p></li><li><p>roundRect(x1,y1,x2,y2,rx,ry) - Draws a rectangle with rounded corners（画一个圆角矩形）</p></li><li><p>drawFocusRect(x1,y1,x2,y2) - Draws the focus rectangle shape（画一个焦点矩形）</p></li><li><p>textOut(x,y, text)（输出文字）</p></li><li><p>textRect(rect,x,y,text): write the text within the given rectangle. The text supports some ansi escape characters</p><p>在给定的矩形内写下文本。文本支持一些ansi转义字符</p></li><li><p>getTextWidth(text)（获取文本宽度）</p></li><li><p>getTextHeight(text)（获取文本高度）</p></li><li><p>getPixel(x,y)（获得指定坐标点的像素的<a class=link href=https://baike.baidu.com/item/RGB/342517 target=_blank rel=noopener>RGB</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span>颜色值）</p></li><li><p>setPixel(x,y,color)（设置指定坐标点的像素的<a class=link href=https://baike.baidu.com/item/RGB/342517 target=_blank rel=noopener>RGB</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span>颜色值）</p></li><li><p>floodFill(x,y, color OPTIONAL default=brush.Color, filltype OPTIONAL default=fsSurface): Fills the picture till/with a color.(颜色填充)<br>filltype can be<br>fsSurface: fill till the color (it fills all except this color)<br>fsBorder:  fill this color (it fills only connected pixels of this color)      </p></li><li><p>ellipse(x1,y1,x2,y2)（画椭圆）</p></li><li><p>gradientFill(x1,y1,x2,y2, startcolor, stopcolor, direction) : Gradient fills a rectangle. Direction can be 0 or 1. 0=Vertical 1=Horizontal</p><p>填充三角形和矩形颜色 可参考https://baike.baidu.com/item/GradientFill/6377439?fr=aladdin</p></li><li><p>copyRect(dest_x1,dest_y1,dest_x2,dest_y2, sourceCanvas, source_x1,source_y1,source_x2,source_y2) : Draws an image from one source to another. Useful in cases of doublebuffering</p><p>将图像从一个源绘制到另一个源。在双重缓冲的情况下有用</p></li><li><p>strectDraw(rectdraw(x,y, graphic) : Draw the image of a specific Graphic class</p><p>绘制特定图形类的图像</p></li><li><p>stretchDraw(rect, graphic): Draw the image of a specific Graphic class and stretch it so it fits in the given rectangle</p><p>绘制特定图形类的图像并拉伸它，使其适合给定的矩形</p></li><li><p>getClipRect() : Returns a table containing the fields Left, Top, Right and Bottom, which define the invalidated region of the graphical object. Use this to only render what needs to be rendered in the onPaint event of objects</p><p>返回包含字段Left、Top、Right和Bottom的表，这些字段定义图形对象的无效区域。使用此选项仅渲染对象的onPaint事件中需要渲染的内容</p></li></ul><h4 id=pen-class>Pen Class</h4><p>(Inheritance: CustomPen->CanvasHelper->Object)</p><p>属性</p><ul><li><p>Color: Integer - The color of the pen （画笔颜色）</p></li><li><p>Width: integer - Thickness of the pen（画笔的粗细宽度）</p></li></ul><p>方法</p><ul><li><p>getColor()    (获取颜色)</p></li><li><p>setColor(color)（设置颜色）</p></li><li><p>getWidth() （获取宽度）</p></li><li><p>setWidth(width)（设置宽度）</p></li></ul><h4 id=brush-class>Brush Class</h4><p>(Inheritance: CustomBrush->CanvasHelper->Object)</p><p>属性</p><ul><li>Color : Integer（颜色）</li></ul><p>方法</p><ul><li>getColor()    (获取颜色)</li><li>setColor(color)（设置颜色）</li></ul><h4 id=font-class>Font Class</h4><p>(Inheritance: CustomFont->CanvasHelper->Object)</p><p>属性</p><ul><li><p>Name: string（名字）</p></li><li><p>Size: integer（大小）</p></li><li><p>Height: integer（高度）</p></li><li><p>Orientation: integer（旋转角度, 单位是 1/10 度）</p></li><li><p>Pitch: string - &lsquo;fpDefault&rsquo;, &lsquo;fpVariable&rsquo;, &lsquo;fpFixed&rsquo;</p><p>字间距相关的, 有三个枚举值可选</p></li><li><p>Color: integer（颜色）</p></li><li><p>CharSet: integer（字符集, 是个整数）</p><p>ANSI_CHARSET    = 0;<br>DEFAULT_CHARSET   = 1;<br>SYMBOL_CHARSET   = 2;<br>SHIFTJIS_CHARSET  = 128;<br>HANGEUL_CHARSET   = 129;<br>GB2312_CHARSET   = 134;<br>CHINESEBIG5_CHARSET = 136;<br>OEM_CHARSET     = 255;<br>JOHAB_CHARSET    = 130;<br>HEBREW_CHARSET   = 177;<br>ARABIC_CHARSET   = 178;<br>GREEK_CHARSET    = 161;<br>TURKISH_CHARSET   = 162;<br>VIETNAMESE_CHARSET = 163;<br>THAI_CHARSET    = 222;<br>EASTEUROPE_CHARSET = 238;<br>RUSSIAN_CHARSET   = 204;</p></li><li><p>Quality: string - &lsquo;fqDefault&rsquo;, &lsquo;fqDraft&rsquo;, &lsquo;fqProof&rsquo;, &lsquo;fqNonAntialiased&rsquo;, &lsquo;fqAntialiased&rsquo;, &lsquo;fqCleartype&rsquo;, &lsquo;fqCleartypeNatural&rsquo;</p><div class=table-wrapper><table><thead><tr><th><strong>Value</strong>(值)</th><th><strong>Meaning</strong>（含义）</th></tr></thead><tbody><tr><td>fqDefault</td><td>quality 由系统设置决定</td></tr><tr><td>fqDraft</td><td>对于光栅字体，启用缩放；字体大小可以增加，但质量可能会降低。如果需要，字体还支持粗体、斜体、下划线或删除线。The quality is less important than when Proof is used.</td></tr><tr><td>fqProof</td><td>字符的quality很重要，因此对于光栅字体，禁用缩放，并选择大小最接近的字体</td></tr><tr><td>fqNonAntialiased</td><td>字体从不抗锯齿</td></tr><tr><td>fqAntialiased</td><td>如果字体支持抗锯齿，它总是抗锯齿的。字体大小不能太小或太大</td></tr><tr><td>fqClearType</td><td>字体使用ClearType抗锯齿方法渲染</td></tr><tr><td>fqClearTypeNatural</td><td>字体使用ClearTypeNatural抗锯齿方法渲染</td></tr></tbody></table></div></li><li><p>Style: string set - [&lsquo;fsBold&rsquo;, &lsquo;fsItalic&rsquo;, &lsquo;fsStrikeOut&rsquo;, &lsquo;fsUnderline&rsquo;]</p><p>fsBold 粗体<br>fsItalic 斜体<br>fsUnderline 下划线<br>fsStrikeOut 删除线</p></li></ul><p>方法</p><ul><li><p>getName(): Gets the fontname of the font</p><p>获取字体的字体名</p></li><li><p>setName(string): Sets the fontname of the font</p><p>设置字体的字体名</p></li><li><p>getSize(): Gets the size of the font</p><p>获取字体大小</p></li><li><p>setSize(integer): Sets the size of the font</p><p>设置字体大小</p></li><li><p>getColor(): Gets the color of the font</p><p>获取字体颜色</p></li><li><p>setColor(integer): Sets the color of the font</p><p>设置字体颜色</p></li><li><p>assign(font): Copies the contents of the font given as parameter to this font</p><p>将作为参数给定的字体的内容复制到此字体</p></li></ul><h3 id=时钟类参考文档>时钟类（参考文档）</h3><h4 id=timer-class>Timer Class</h4><p>(Inheritance: Component->object)</p><p>属性</p><ul><li><p>Interval: integer - The number of milliseconds (1000=1 second) between executions</p><p>时钟周期，单位为毫秒即千分之一秒</p></li><li><p>Enabled: boolean（是否激活）</p></li><li><p>OnTimer: function(timer) - The function to call when the timer triggers</p><p>计时器触发时要调用的函数</p></li></ul><p>方法</p><ul><li><p>getInterval() 获取时钟周期</p></li><li><p>setInterval(interval) : Sets the speed on how often the timer should trigger. In milliseconds (1000=1 second)   </p><p>设置时钟周期</p></li><li><p>getOnTimer()   获取时钟事件</p></li><li><p>setOnTimer(function(timer)) 设置时钟事件</p></li><li><p>getEnabled() 获取是否激活</p></li><li><p>setEnabled(boolean) 设置是否激活</p></li></ul><h3 id=内存流相关类参考文档>内存流相关类（参考文档）</h3><h4 id=memorystream-class>MemoryStream Class</h4><p>(Inheritance: Stream->Object)</p><p>MemoryStream的Size属性继承自Stream Class</p><p>属性</p><ul><li><p>Memory: Integer - The address in Cheat Engine&rsquo;s memory this stream is loaded (READONLY, tends to change on size change)</p><p>内存 此流加载的CE内存中的地址 （只读，随size变化而变化）</p></li></ul><p>方法</p><ul><li><p>loadFromFile(filename) : Replaces the contents in the memory stream with the contents of a file on disk</p><p>用磁盘上文件的内容替换内存流中的内容</p></li><li><p>saveToFile(filename) : Writes the contents of the memory stream to the specified file</p><p>将内存流的内容写入指定的文件</p></li><li><p>loadFromFileNoError(filename):boolean,string - Replaces the contents in the memory stream with the contents of a file on disk. On success returns true, else false with a secondary return the error message</p><p>用磁盘上文件的内容替换内存流中的内容。成功时返回true，否则返回false，并返回错误消息</p></li><li><p>saveToFileNoError(filename):boolean,string - Writes the contents of the memory stream to the specified file. On success returns true, else false with a secondary return the error message</p><p>将内存流的内容写入指定的文件。成功时返回true，否则返回false，并返回错误消息</p></li></ul><h4 id=stream-class>Stream Class</h4><p>属性</p><ul><li>Size: integer（流的大小）</li><li>Position: integer（流的位置）</li></ul><p>方法</p><ul><li><p>copyFrom(stream, count) - Copies count bytes from the given stream to this stream</p><p>将给定流中的count字节复制到此流</p></li><li><p>read(count): bytetable - Returns a bytetable containing the bytes of the stream. This increases the position</p><p>返回包含流字节的字节表。这会增加position</p></li><li><p>write(bytetable, count OPTIONAL)- Writes the given bytetable to the stream</p><p>将给定的bytetable写入流</p></li><li><p>readByte(): integer</p></li><li><p>writeByte(integer)</p></li><li><p>readWord(): integer</p></li><li><p>writeWord(integer)</p></li><li><p>readDword(): integer</p></li><li><p>writeDword(integer)</p></li><li><p>readQword(): integer</p></li><li><p>writeQword(integer)</p></li><li><p>readAnsiString(): string</p></li><li><p>writeAnsiString(string)</p></li></ul><h3 id=其它绘制用到的方法参考方法>其它绘制用到的方法（参考方法）</h3><h4 id=createform>createForm</h4><p>参考链接:<a class=link href="https://wiki.cheatengine.org/index.php?title=Lua:Class:Form" target=_blank rel=noopener>https://wiki.cheatengine.org/index.php?title=Lua:Class:Form</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>创建窗体:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>createForm</span><span class=p>(</span><span class=n>visible</span> <span class=n>OPT</span><span class=p>)</span> 
</span></span></code></pre></div><p>Creates a Form class object(window) and returns the pointer for it. Visible is default true but can be changed</p><p>创建一个Form 类对象(窗口) 并返回指向它的指针。默认是可见的窗体，但可以被改变</p><div class=table-wrapper><table><thead><tr><th>参数</th><th>参数类型</th><th>描述</th></tr></thead><tbody><tr><td>visible OPT</td><td>bool</td><td>创建的窗口是否可见    true为可见 false为不可见</td></tr></tbody></table></div><div class=table-wrapper><table><thead><tr><th>返回值</th><th>返回值类型</th><th>描述</th></tr></thead><tbody><tr><td>pointer for the created form</td><td>pointer</td><td>指向创建出来的form的指针</td></tr></tbody></table></div><p>例:createForm(true)<img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210209193158891.webp width=324 height=296 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210209193158891_hua93f218db9c2558acbd4ad5dead6daba_1474_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210209193158891_hua93f218db9c2558acbd4ad5dead6daba_1474_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210209193158891 class=gallery-image data-flex-grow=109 data-flex-basis=262px></p><h4 id=getscreenheight>getScreenHeight</h4><p>参考链接:<a class=link href="https://wiki.cheatengine.org/index.php?title=Lua:getScreenHeight" target=_blank rel=noopener>getScreenHeight</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>无参数</p><div class=table-wrapper><table><thead><tr><th>返回值</th><th>返回值类型</th><th>描述</th></tr></thead><tbody><tr><td>screenHeight</td><td>integer</td><td>屏幕高度</td></tr></tbody></table></div><h4 id=getscreenwidth>getScreenWidth</h4><p>参考链接:<a class=link href="https://wiki.cheatengine.org/index.php?title=Lua:getScreenWidth" target=_blank rel=noopener>getScreenWidth</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>无参数</p><div class=table-wrapper><table><thead><tr><th>返回值</th><th>返回值类型</th><th>描述</th></tr></thead><tbody><tr><td>screenWidth</td><td>integer</td><td>屏幕宽度</td></tr></tbody></table></div><h4 id=createtimer>createTimer</h4><p>参考链接:<a class=link href="https://wiki.cheatengine.org/index.php?title=createTimer" target=_blank rel=noopener>createTimer</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>createTimer</span><span class=p>(</span><span class=n>Owner</span> <span class=n>OPTIONAL</span><span class=p>,</span> <span class=n>Enabled</span> <span class=n>OPTIONAL</span><span class=p>)</span> <span class=p>:</span> <span class=n>Timer</span>
</span></span></code></pre></div><div class=table-wrapper><table><thead><tr><th>参数</th><th>参数类型</th><th>描述</th></tr></thead><tbody><tr><td>Owner</td><td><a class=link href="https://wiki.cheatengine.org/index.php?title=Control" target=_blank rel=noopener>Control</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span>or <a class=link href="https://wiki.cheatengine.org/index.php?title=Component" target=_blank rel=noopener>Component</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span>based object</td><td>计时器的所有者（用于资源清理）</td></tr><tr><td>Enabled</td><td>boolean</td><td>计时器的启用状态，设置为false以在创建时禁用计时器</td></tr></tbody></table></div><div class=table-wrapper><table><thead><tr><th>返回值</th><th>返回值类型</th><th>描述</th></tr></thead><tbody><tr><td>timer</td><td>Timer</td><td>新创建的timer对象</td></tr></tbody></table></div><p>Tip: 使用<a class=link href="https://wiki.cheatengine.org/index.php?title=getMainForm" target=_blank rel=noopener>getMainForm</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span>方法作为owner(创建者) 可以使得计时器和main form同步摧毁</p><h4 id=findwindow>findWindow</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>findWindow</span><span class=p>(</span><span class=n>classname</span> <span class=n>OPTIONAL</span><span class=p>,</span> <span class=n>caption</span> <span class=n>OPTIONAL</span><span class=p>):</span> <span class=n>windowhandle</span> 
</span></span></code></pre></div><p>Finds a window with the given classname and/or windowname</p><p>根据给定的窗口类名和/或窗口名称得到窗口句柄</p><div class=table-wrapper><table><thead><tr><th>参数</th><th>参数类型</th><th>描述</th></tr></thead><tbody><tr><td>classname</td><td>string</td><td>窗口类名</td></tr><tr><td>caption</td><td>string</td><td>窗口标题名称</td></tr></tbody></table></div><div class=table-wrapper><table><thead><tr><th>返回值</th><th>返回值类型</th><th>描述</th></tr></thead><tbody><tr><td>windowhandle</td><td>windowhandle</td><td>窗口句柄</td></tr></tbody></table></div><h4 id=getwindowcaption>getWindowCaption</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>getWindowCaption</span><span class=p>(</span><span class=n>windowhandle</span><span class=p>)</span> <span class=p>:</span> <span class=n>string</span> 
</span></span></code></pre></div><p>Returns the caption of the window</p><p>返回窗口的标题</p><div class=table-wrapper><table><thead><tr><th>参数</th><th>参数类型</th><th>描述</th></tr></thead><tbody><tr><td>windowhandle</td><td>windowhandle</td><td>窗口句柄</td></tr></tbody></table></div><div class=table-wrapper><table><thead><tr><th>返回值</th><th>返回值类型</th><th>描述</th></tr></thead><tbody><tr><td>caption</td><td>string</td><td>窗口标题名称</td></tr></tbody></table></div><h3 id=补充方法可以间接调用win32-api等>补充方法(可以间接调用Win32 API等)</h3><h4 id=creatememorystream>createMemoryStream</h4><p>创建一个内存流，返回指向创建出来的内存流指针</p><h4 id=executecodelocalex>executeCodeLocalEx</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>executeCodeLocalEx</span><span class=p>(</span><span class=n>address</span><span class=p>,</span> <span class=p>{</span><span class=n>type</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>value</span><span class=o>=</span><span class=n>param1</span><span class=p>}</span> <span class=ow>or</span> <span class=n>param1</span><span class=p>,{</span><span class=n>type</span><span class=o>=</span><span class=n>x</span><span class=p>,</span><span class=n>value</span><span class=o>=</span><span class=n>param2</span><span class=p>}</span> <span class=ow>or</span> <span class=n>param2</span><span class=p>,...)</span>
</span></span></code></pre></div><p>Calls a function using the given callmethod and parameters</p><p>使用给定的调用方法和参数来调用一个函数</p><p>If a direct parameter is given instead of a table entry describing the type, CE will &lsquo;guess&rsquo; the type it is</p><p>如果给定的是直接参数而不是描述类型的表项，CE将&rsquo;猜&rsquo;它是什么类型</p><p>Returns the E/RAX value returned by the called function (if no timeout or other interruption)</p><p>返回由被调用函数返回的 E/RAX 值 (如果没有超时或其它错误)</p><div class=table-wrapper><table><thead><tr><th>参数</th><th>参数类型</th><th>描述</th></tr></thead><tbody><tr><td>address</td><td>string</td><td>模块名或export</td></tr><tr><td>param</td><td>？</td><td>指定方法所需参数 多个参数通过逗号连接</td></tr><tr><td>memory</td><td>MemoryStream.Memory</td><td>内存地址</td></tr></tbody></table></div><div class=table-wrapper><table><thead><tr><th>返回值</th><th>返回值类型</th><th>描述</th></tr></thead><tbody><tr><td>？</td><td>？</td><td>由被调用方法决定返回值</td></tr></tbody></table></div><h4 id=getaddress>getAddress</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>getAddress</span><span class=p>(</span><span class=n>string</span> <span class=p>,</span> <span class=kd>local</span> <span class=n>OPTIONAL</span><span class=p>)</span>
</span></span></code></pre></div><p>returns the address of a symbol. Can be a modulename or an export. set Local to true if you wish to querry the symboltable of the ce process</p><p>返回一个符号的地址。可以是一个模块名或一个export。设置local为true如果你想要查询ce进程的符号表</p><div class=table-wrapper><table><thead><tr><th>参数</th><th>参数类型</th><th>描述</th></tr></thead><tbody><tr><td>symbol or export</td><td>string</td><td>模块名或export</td></tr><tr><td>local</td><td>bool</td><td>设置local为true如果你想要查询ce进程的符号表</td></tr></tbody></table></div><div class=table-wrapper><table><thead><tr><th>返回值</th><th>返回值类型</th><th>描述</th></tr></thead><tbody><tr><td>address</td><td>number</td><td>地址</td></tr></tbody></table></div><h2 id=注意事项>注意事项</h2><p>LUA的参考文档是本人集合CE官方的文档和Delphi等相关资料<strong>翻译整理</strong>而成，可能会有些地方并不是很准确，<strong>仅供参考</strong></p><p>（翻译和找文档真的好不容易QAQ）</p><p>提供的CT表里有三个脚本:</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210134618992.webp width=881 height=134 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210134618992_hu943bf6fe86adb0a60dfa942f925f201f_11402_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210134618992_hu943bf6fe86adb0a60dfa942f925f201f_11402_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210134618992 class=gallery-image data-flex-grow=657 data-flex-basis=1577px></p><p><strong>pvz的两个绘制脚本不要同时开启!!!</strong></p><p>我自己写的插件只是提供了GetWindowRect方法,并没有提供其它东西，主要是让大家了解<strong>CE插件的使用及开发</strong></p><p><strong>限于文章篇幅，此教程作为上篇仅为LUA的绘制教程，有关插件的开发教程放到下篇</strong></p><h2 id=个人感言及附件下载>个人感言及附件下载</h2><p>CE其实提供了不少给开发者拓展的功能，如LUA脚本、Plugin开发等等，但用到这些功能的人却并不那么多，于是抱着探索的态度和大家一起聊聊CE的这两大功能</p><h2 id=下篇前言>下篇前言：</h2><p>承接上篇教程，这次来讲讲如何为CE开发扩展的插件</p><p>上篇教程直达车：<a class=link href=https://www.52pojie.cn/thread-1369369-1-1.html target=_blank rel=noopener><strong>CE自写插件提供LUA接口实现pvz僵尸绘制之上篇</strong></a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><hr><p>总教程分成两部分：</p><ul><li>LUA的使用</li><li>Plugin的开发</li></ul><p><strong>本下篇教程为Plugin的开发部分</strong></p><h2 id=事前准备-2>事前准备</h2><p>本人使用的工具：CE7.2汉化版（这次要<strong>注意版本</strong>，插件和CE版本相关，汉化与否不影响）</p><p>论坛有：<a class=link href=https://down.52pojie.cn/Tools/Debuggers/Cheat%20Engine%20v7.2.exe target=_blank rel=noopener><strong>CE7.2</strong></a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>VS2015 （可以<strong>兼容XP</strong>的插件开发）</p><p>VS2015:<a class=link href="https://my.visualstudio.com/Downloads?q=visual%20studio%202015&amp;wt.mc_id=o~msft~vscom~older-downloads" target=_blank rel=noopener>https://my.visualstudio.com/Downloads?q=visual%20studio%202015&amp;wt.mc_id=o~msft~vscom~older-downloads</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>CE7.2源码一份:<a class=link href=https://github.com/cheat-engine/cheat-engine/archive/7.2.zip target=_blank rel=noopener>https://github.com/cheat-engine/cheat-engine/archive/7.2.zip</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><h2 id=教程内容-2>教程内容</h2><h2 id=vs2015的安装>VS2015的安装</h2><h3 id=插件编译环境>插件编译环境</h3><p>CE插件的编译中 example-c里使用的环境是**VS2015+WDK8.1(**能够兼容XP)</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210183952985.webp width=1948 height=1234 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210183952985_hu555712bcbb359c7ac69075068418ab9a_118674_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210183952985_hu555712bcbb359c7ac69075068418ab9a_118674_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210183952985 class=gallery-image data-flex-grow=157 data-flex-basis=378px></p><p>根据我上面提供的链接下载并安装VS2015 （貌似下载前要登陆Microsoft账号）</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210183416917.webp width=3839 height=1913 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210183416917_hue5193d7d5915f42bfc69232167c5feae_129354_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210183416917_hue5193d7d5915f42bfc69232167c5feae_129354_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210183416917 class=gallery-image data-flex-grow=200 data-flex-basis=481px></p><p>下载和安装VS2015的教程网上很多，这里不作重点，默认大家能安装好了</p><p>PS：安装好后用VS2015打开Plugin插件</p><h2 id=plugin-源码解析>Plugin 源码解析</h2><p>想知道如何开发一个插件，必不可少的就是去读一读别人的源码</p><p>下载并解压源码以后切换到\cheat-engine-7.2\Cheat Engine\plugin\example-c目录下</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210190512849.webp width=2129 height=624 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210190512849_hu9229f59d003362ea4e87539c20f2df83_63628_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210190512849_hu9229f59d003362ea4e87539c20f2df83_63628_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210190512849 class=gallery-image data-flex-grow=341 data-flex-basis=818px></p><p>用VS2015打开.sln文件（如果是第一次打开会让你下载WDK8.1等相关的组件，点击确定让它自动下载安装即可）</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210190706747.webp width=1459 height=1157 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210190706747_huf1ac5309ebb26ea0d4be3c29489686a5_53796_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210190706747_huf1ac5309ebb26ea0d4be3c29489686a5_53796_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210190706747 class=gallery-image data-flex-grow=126 data-flex-basis=302px></p><h3 id=源码结构>源码结构</h3><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210190934311.webp width=809 height=866 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210190934311_hua0d0c78150e69e7444581004512c1a66_39728_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210190934311_hua0d0c78150e69e7444581004512c1a66_39728_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210190934311 class=gallery-image data-flex-grow=93 data-flex-basis=224px></p><p>首先明确一点：我们编写出来的插件是dll格式，即是开发一个<strong>动态链接库程序</strong>作为插件给CE调用</p><p>我们可以大致将这个例子的结构分为四层</p><div class=table-wrapper><table><thead><tr><th>结构</th><th>包含文件</th></tr></thead><tbody><tr><td>一个全被注释的头文件和一个空的源文件，留给我们拓展用的，可以删去</td><td>bla.h bla.cpp</td></tr><tr><td>CE提供给我们的头文件和LUA提供给我们的头文件</td><td>cepluginsdk.h lauxlib.h lua.h luaconf.h lualib.h</td></tr><tr><td>主程序代码，即我们要编写插件的关键代码</td><td>example-c</td></tr><tr><td>定义我们要导出的函数</td><td>example-c.def</td></tr></tbody></table></div><h3 id=需要用到的静态库文件>需要用到的静态库文件</h3><p>我们看到了头文件里有LUA和CE提供的头文件，但源文件里并没有对应的源文件，于是我们知道是引入了.lib静态库文件</p><p>那么静态库文件在哪呢?</p><p>项目→属性→链接器→输入→附加依赖项</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192559410.webp width=1948 height=1234 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192559410_hube5e86d03ce865deb108c8db58ee464c_79968_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192559410_hube5e86d03ce865deb108c8db58ee464c_79968_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210192559410 class=gallery-image data-flex-grow=157 data-flex-basis=378px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192643755.webp width=1927 height=89 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192643755_hu2152cb7fd9b97cbe6b1600e3256bd707_8250_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192643755_hu2152cb7fd9b97cbe6b1600e3256bd707_8250_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210192643755 class=gallery-image data-flex-grow=2165 data-flex-basis=5196px></p><p>将上方的平台分别改为Win32和X64，可以看到附加依赖项分别显示为:</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192729562.webp width=1946 height=218 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192729562_hu699ae05d40e639f4bb43c8d8d6da982a_21348_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192729562_hu699ae05d40e639f4bb43c8d8d6da982a_21348_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210192729562 class=gallery-image data-flex-grow=892 data-flex-basis=2142px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192750875.webp width=1937 height=222 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192750875_hu067fd79a835c3a7b04a1f9967de49020_21348_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192750875_hu067fd79a835c3a7b04a1f9967de49020_21348_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210192750875 class=gallery-image data-flex-grow=872 data-flex-basis=2094px></p><p>我们可以知道该项目使用了lua53-32.lib和lua53-64.lib</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192949570.webp width=1967 height=904 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192949570_hu7f1208dfffb1586655352530e987d205_97074_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210192949570_hu7f1208dfffb1586655352530e987d205_97074_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210192949570 class=gallery-image data-flex-grow=217 data-flex-basis=522px></p><p>这两个lib文件就在cheat-engine-7.2\Cheat Engine\plugin目录下</p><p>我们可以将这两个.lib文件复制到cheat-engine-7.2\Cheat Engine\plugin\example-c中</p><p>下面简单说一下.lib文件的来源，我们也可以<strong>自己生成</strong>这两个.lib文件</p><h3 id=编译lib静态库文件非必须>编译lib静态库文件(非必须)</h3><p>cheat-engine-7.2\Cheat Engine\lua53\lua53\vs2013\lua53目录下自己编译.lib静态库文件</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210193527486.webp width=2021 height=602 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210193527486_hu44e55447c04883f3c9aee18a39f3de2c_34290_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210193527486_hu44e55447c04883f3c9aee18a39f3de2c_34290_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210193527486 class=gallery-image data-flex-grow=335 data-flex-basis=805px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210193720043.webp width=1459 height=1157 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210193720043_hu53dc00d904c44354e7989b91b6a22e3b_49320_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210193720043_hu53dc00d904c44354e7989b91b6a22e3b_49320_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210193720043 class=gallery-image data-flex-grow=126 data-flex-basis=302px></p><h4 id=生成lua53-64lib>生成lua53-64.lib</h4><p>打开项目以后需要设置一下项目的属性</p><p>将lua53的平台工具集改为Visual Studio 2015 - Windows XP (v140_xp)</p><p>平台改为x64</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210194051711.webp width=1948 height=1234 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210194051711_hu82d26b0ab92981fe5f43746792131165_124932_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210194051711_hu82d26b0ab92981fe5f43746792131165_124932_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210194051711 class=gallery-image data-flex-grow=157 data-flex-basis=378px></p><p>然后打开配置管理器，将活动解决方案配置改为Release，活动解决方案平台改成x64</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210194421050.webp width=1402 height=915 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210194421050_hu5c364673e58aaa3c44f9230b031916ac_27544_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210194421050_hu5c364673e58aaa3c44f9230b031916ac_27544_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210194421050 class=gallery-image data-flex-grow=153 data-flex-basis=367px></p><p>然后Ctrl+Shift+B或者生成→生成解决方案</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210194602657.webp width=2989 height=421 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210194602657_hu21d127cc04c3b12cbe59599484119ead_47576_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210194602657_hu21d127cc04c3b12cbe59599484119ead_47576_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210194602657 class=gallery-image data-flex-grow=709 data-flex-basis=1703px></p><p>可以看到我们所需要的静态库文件生成在了cheat-engine-7.2\Cheat Engine\bin下</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195004287.webp width=1976 height=1700 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195004287_hue077d0d976c2a05b8fef4b9e80493f1e_228550_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195004287_hue077d0d976c2a05b8fef4b9e80493f1e_228550_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210195004287 class=gallery-image data-flex-grow=116 data-flex-basis=278px></p><p>我图中用红框框出来的就是我们刚刚生成的文件，其中我们只需要用到.lib文件</p><h4 id=生成lua53-32lib>生成lua53-32.lib</h4><p>将之前的属性页和配置管理器页中的平台改成Win32，再生成一份lua53-32</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195218993.webp width=1402 height=915 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195218993_hu254076813c9250eaae7505ad5432c7d8_28634_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195218993_hu254076813c9250eaae7505ad5432c7d8_28634_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210195218993 class=gallery-image data-flex-grow=153 data-flex-basis=367px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195239192.webp width=1948 height=1234 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195239192_hue2d39cc20db75b6967f9b27be77165f6_125346_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195239192_hue2d39cc20db75b6967f9b27be77165f6_125346_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210195239192 class=gallery-image data-flex-grow=157 data-flex-basis=378px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195444569.webp width=2967 height=434 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195444569_hu71504ea7453a6b09dfb1186a9d1ec4fe_49736_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195444569_hu71504ea7453a6b09dfb1186a9d1ec4fe_49736_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210195444569 class=gallery-image data-flex-grow=683 data-flex-basis=1640px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195533901.webp width=2019 height=1694 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195533901_hucfce39c780334bda14cc491994a870c7_220900_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210195533901_hucfce39c780334bda14cc491994a870c7_220900_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210195533901 class=gallery-image data-flex-grow=119 data-flex-basis=286px></p><h3 id=编译example-c插件>编译example-c插件</h3><p>拿到源码以后最想干的事莫过于先让它跑起来，验证是否能够正确运行，于是我们先将插件编译出来再慢慢分析</p><p>将前面我们生成好的(或者直接拿上级目录里的)lua53-32.lib和lua53-64.lib复制到cheat-engine-7.2\Cheat Engine\plugin\example-c下</p><p>复制完以后打开example-c这个项目</p><p>然后确保将配置管理器改成 Release和x64</p><p>属性页设置为所有平台</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210202752883.webp width=1402 height=915 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210202752883_hu796e045405a811230607b0ebe2713c4e_26392_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210202752883_hu796e045405a811230607b0ebe2713c4e_26392_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210202752883 class=gallery-image data-flex-grow=153 data-flex-basis=367px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210202845467.webp width=1948 height=1234 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210202845467_hu8a708aa7d130deba8c92c6c131be5211_118072_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210202845467_hu8a708aa7d130deba8c92c6c131be5211_118072_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210202845467 class=gallery-image data-flex-grow=157 data-flex-basis=378px></p><p>设置完以后就可以Ctrl+Shift+B编译插件了</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205119056.webp width=2971 height=440 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205119056_hud83cf50eb4451b290be1e79b01885a59_44526_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205119056_hud83cf50eb4451b290be1e79b01885a59_44526_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210205119056 class=gallery-image data-flex-grow=675 data-flex-basis=1620px></p><p>完美生成插件</p><p>在cheat-engine-7.2\Cheat Engine\plugin\example-c\x64\Release查看</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205436686.webp width=1563 height=591 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205436686_hua81be80a06bf89ce80e10d972b0afe15_60620_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205436686_hua81be80a06bf89ce80e10d972b0afe15_60620_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210205436686 class=gallery-image data-flex-grow=264 data-flex-basis=634px></p><p>我们试着用CE加载一下插件</p><p>打开CE→编辑→设置→插件→添加</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205838298.webp width=1387 height=887 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205838298_hu820602763c86ed78eb3b17e69ae4c5cc_46114_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205838298_hu820602763c86ed78eb3b17e69ae4c5cc_46114_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210205838298 class=gallery-image data-flex-grow=156 data-flex-basis=375px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205852327.webp width=1389 height=1354 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205852327_hu8bfb10ea8791fbbdb07e067e35f7f03a_37226_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205852327_hu8bfb10ea8791fbbdb07e067e35f7f03a_37226_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210205852327 class=gallery-image data-flex-grow=102 data-flex-basis=246px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205901681.webp width=820 height=250 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205901681_hu9dfe37c69987b34f6c8462dcde5ffa7d_8658_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210205901681_hu9dfe37c69987b34f6c8462dcde5ffa7d_8658_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210205901681 class=gallery-image data-flex-grow=328 data-flex-basis=787px></p><h3 id=源码解析>源码解析</h3><h4 id=导出函数说明>导出函数说明</h4><p>我们先看.def文件，查看导出的函数</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210211548799.webp width=750 height=265 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210211548799_hu1a06317f3a71294940a6f618801d6683_18704_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210210211548799_hu1a06317f3a71294940a6f618801d6683_18704_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210210211548799 class=gallery-image data-flex-grow=283 data-flex-basis=679px></p><p>有三个导出的函数：</p><p>分别为：CEPlugin_GetVersion        CEPlugin_InitializePlugin        CEPlugin_DisablePlugin</p><hr><p>我们可以看看有关CE插件的文档：<a class=link href=https://cheatengine.org/help/index.html target=_blank rel=noopener>https://cheatengine.org/help/index.html</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>Cheat Engine comes with a plugin system so developers can add extra functions and features to ce without having to code in Delphi (Any language that can create standard DLL&rsquo;s with normal exports can make plugins for ce), or having to share their sourcecode.</p><p>CE 带来了插件系统 这样一来开发者们就可以添加额外的功能和特性到CE里，无需用Delphi 编程（任何语言都可以为CE创建正常导出的标准的DLL）</p><p>To make use of the plugin system you need to create a dll that exports 3 functions:</p><p>为了确保插件系统的正常运转，你需要创建一个带有以下三个导出功能的dll</p><p>GetVersion, DisablePlugin, and InitializePlugin</p><p>Note: Unless stated otherwise, all function calls use the stdcall calling mechanism.</p><p>注意：除非额外声明，所有的功能调用协定都应该使用stdcall</p><p>Cheat Engine comes with some example plugins. They generally make use of a common SDK file. Currently, there is a version for Delphi and a version for C available</p><p>CE带来了一些例子插件。它们通常使用一个公共的SDK文件，目前，有一个Delphi版本和一个C版本</p><hr><p>所以我们知道为什么导出的函数里有这三个函数了</p><p>依次说说这三个函数</p><h5 id=getversion><strong>GetVersion</strong></h5><p>The GetVersion routine is a routine that will get called when the dll is queried for the first time.</p><p>GetVersion例程是第一次查询dll时将调用的例程GetVersion(</p><div class=table-wrapper><table><thead><tr><th>参数</th><th>参数类型</th><th>说明</th></tr></thead><tbody><tr><td>pv</td><td>PPluginVersion</td><td>指向PluginVersion的指针，必须填充</td></tr><tr><td>sizeofpluginversion</td><td>int</td><td>pv参数中提供的PluginVersion结构的大小。您可以使用这个来确保您的插件版本与作弊引擎插件系统的当前实现兼容。目前，应该是8</td></tr></tbody></table></div><div class=table-wrapper><table><thead><tr><th>返回值</th><th>返回值类型</th><th>说明</th></tr></thead><tbody><tr><td>true</td><td>bool</td><td>返回值必须设置为1</td></tr></tbody></table></div><h6 id=pluginversion>PluginVersion</h6><p>The PluginVersion lets you specify for which plugin version the dll was developed and what the name of that plugin is.</p><p>PluginVersion允许你指定插件版本以及该插件的名称</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>typedef</span> <span class=n>struct</span> <span class=n>_PluginVersion</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>
</span></span><span class=line><span class=ln>5</span><span class=cl> <span class=n>unsigned</span> <span class=n>int</span> <span class=n>version</span><span class=p>;</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>
</span></span><span class=line><span class=ln>7</span><span class=cl> <span class=n>char</span> <span class=o>*</span><span class=n>pluginname</span><span class=p>;</span>
</span></span><span class=line><span class=ln>8</span><span class=cl>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=p>}</span> <span class=n>PluginVersion</span><span class=p>,</span> <span class=o>*</span><span class=n>PPluginVersion</span><span class=p>;</span>
</span></span></code></pre></div><div class=table-wrapper><table><thead><tr><th>成员</th><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>version</td><td>unsigned int(无符号整型)</td><td>设置这个dll所期望的版本</td></tr><tr><td>pluginname</td><td>char *（字符串）</td><td>CE会在initializePlugin上为你的插件提供一个兼容的指针/函数列表。</td></tr></tbody></table></div><h5 id=disableplugin>DisablePlugin</h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>BOOL</span> <span class=n>DisablePlugin</span><span class=p>(</span><span class=n>void</span><span class=p>)</span>
</span></span></code></pre></div><p>The DisablePlugin routine is a routine that will get called when Cheat Engine closes or when the user deselects the plugin in settings.</p><p>DisablePlugin例程，当CE关闭或用户在设置中取消选择插件时，它将被调用。</p><div class=table-wrapper><table><thead><tr><th>返回值</th><th>返回值类型</th><th>说明</th></tr></thead><tbody><tr><td>true</td><td>bool</td><td>返回值必须设置为1</td></tr></tbody></table></div><h5 id=initializeplugin>InitializePlugin</h5><p>The InitializePlugin routine is called when Cheat Engine is started and the plugin is enabled in the registry, or when the user enables it in settings and clicks ok.</p><p>当启动CE并在注册表中启用插件时，或者当用户在“设置”中启用插件并单击“确定”时，将调用InitializePlugin例程。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>BOOL</span> <span class=n>InitializePlugin</span><span class=p>(</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=n>PExportedFunctions</span> <span class=n>ef</span> <span class=p>,</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=n>int</span> <span class=n>pluginid</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=p>);</span>
</span></span></code></pre></div><div class=table-wrapper><table><thead><tr><th>参数</th><th>参数类型</th><th>说明</th></tr></thead><tbody><tr><td>ef</td><td>PExportedFunctions</td><td>CE的ExportedFunctions结构的地址副本，在从InitializePlugin函数返回之前复制此结构</td></tr><tr><td>pluginid</td><td>int</td><td>插件id，只要你的插件处于活动状态，它的pluginid就一直存在。此ID用于注册回调</td></tr></tbody></table></div><div class=table-wrapper><table><thead><tr><th>返回值</th><th>返回值类型</th><th>说明</th></tr></thead><tbody><tr><td>true</td><td>bool</td><td>返回值必须设置为1</td></tr></tbody></table></div><p>It is recommended to register the callback functions in this routine and save ExportedFunctions for later usage. For more information about the callbacks see the relevant help topics</p><p>建议在此例程中注册回调函数，并保存ExportedFunctions以备以后使用。有关回调的更多信息，请参阅相关的帮助主题</p><h6 id=exportedfunctions>ExportedFunctions</h6><p>The ExportedFunctions structure contains several pointers to usefull functions in CE, and pointers to the pointers of specific functions that might be worth hooking.</p><p>ExportedFunctions结构包含几个指向CE中有用函数的指针，以及指向可能值得hook的特定函数的指针。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>  1</span><span class=cl><span class=n>typedef</span> <span class=n>struct</span> <span class=n>_ExportedFunctions</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>  3</span><span class=cl>  <span class=n>int</span> <span class=n>sizeofExportedFunctions</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  4</span><span class=cl>  <span class=n>CEP_SHOWMESSAGE</span> <span class=n>ShowMessage</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  5</span><span class=cl>  <span class=n>CEP_REGISTERFUNCTION</span> <span class=n>RegisterFunction</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  6</span><span class=cl>  <span class=n>CEP_UNREGISTERFUNCTION</span> <span class=n>UnregisterFunction</span> <span class=p>;</span>
</span></span><span class=line><span class=ln>  7</span><span class=cl>  <span class=n>PULONG</span> <span class=n>OpenedProcessID</span> <span class=p>;</span>
</span></span><span class=line><span class=ln>  8</span><span class=cl>  <span class=n>PHANDLE</span> <span class=n>OpenedProcessHandle</span> <span class=p>;</span>
</span></span><span class=line><span class=ln>  9</span><span class=cl>
</span></span><span class=line><span class=ln> 10</span><span class=cl>  <span class=n>CEP_GETMAINWINDOWHANDLE</span> <span class=n>GetMainWindowHandle</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 11</span><span class=cl>  <span class=n>CEP_AUTOASSEMBLE</span> <span class=n>AutoAssemble</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 12</span><span class=cl>  <span class=n>CEP_ASSEMBLER</span> <span class=n>Assembler</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 13</span><span class=cl>  <span class=n>CEP_DISASSEMBLER</span> <span class=n>Disassembler</span> <span class=p>;</span>
</span></span><span class=line><span class=ln> 14</span><span class=cl>  <span class=n>CEP_CHANGEREGATADDRESS</span> <span class=n>ChangeRegistersAtAddress</span> <span class=p>;</span>
</span></span><span class=line><span class=ln> 15</span><span class=cl>  <span class=n>CEP_INJECTDLL</span> <span class=n>InjectDLL</span> <span class=p>;</span>
</span></span><span class=line><span class=ln> 16</span><span class=cl>  <span class=n>CEP_FREEZEMEM</span> <span class=n>FreezeMem</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 17</span><span class=cl>  <span class=n>CEP_UNFREEZEMEM</span> <span class=n>UnfreezeMem</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 18</span><span class=cl>  <span class=n>CEP_FIXMEM</span> <span class=n>FixMem</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 19</span><span class=cl>  <span class=n>CEP_PROCESSLIST</span> <span class=n>ProcessList</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 20</span><span class=cl>  <span class=n>CEP_RELOADSETTINGS</span> <span class=n>ReloadSettings</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 21</span><span class=cl>  <span class=n>CEP_GETADDRESSFROMPOINTER</span> <span class=n>GetAddressFromPointer</span> <span class=p>;</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl>
</span></span><span class=line><span class=ln> 23</span><span class=cl>  <span class=o>//</span><span class=n>pointers</span> <span class=n>to</span> <span class=n>the</span> <span class=n>address</span> <span class=n>that</span> <span class=n>contains</span> <span class=n>the</span> <span class=n>pointers</span> <span class=n>to</span> <span class=n>the</span> <span class=n>functions</span>
</span></span><span class=line><span class=ln> 24</span><span class=cl>  <span class=o>//</span><span class=err>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</span></span><span class=line><span class=ln> 25</span><span class=cl>  <span class=n>PVOID</span> <span class=n>ReadProcessMemory</span><span class=p>;</span>                
</span></span><span class=line><span class=ln> 26</span><span class=cl>  <span class=n>PVOID</span> <span class=n>WriteProcessMemory</span><span class=p>;</span>               
</span></span><span class=line><span class=ln> 27</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetThreadContext</span><span class=p>;</span>                 
</span></span><span class=line><span class=ln> 28</span><span class=cl>  <span class=n>PVOID</span> <span class=n>SetThreadContext</span><span class=p>;</span>                 
</span></span><span class=line><span class=ln> 29</span><span class=cl>  <span class=n>PVOID</span> <span class=n>SuspendThread</span><span class=p>;</span>                    
</span></span><span class=line><span class=ln> 30</span><span class=cl>  <span class=n>PVOID</span> <span class=n>ResumeThread</span><span class=p>;</span>                     
</span></span><span class=line><span class=ln> 31</span><span class=cl>  <span class=n>PVOID</span> <span class=n>OpenProcess</span><span class=p>;</span>                      
</span></span><span class=line><span class=ln> 32</span><span class=cl>  <span class=n>PVOID</span> <span class=n>WaitForDebugEvent</span><span class=p>;</span>                
</span></span><span class=line><span class=ln> 33</span><span class=cl>  <span class=n>PVOID</span> <span class=n>ContinueDebugEvent</span><span class=p>;</span>               
</span></span><span class=line><span class=ln> 34</span><span class=cl>  <span class=n>PVOID</span> <span class=n>DebugActiveProcess</span><span class=p>;</span>               
</span></span><span class=line><span class=ln> 35</span><span class=cl>  <span class=n>PVOID</span> <span class=n>StopDebugging</span><span class=p>;</span>                    
</span></span><span class=line><span class=ln> 36</span><span class=cl>  <span class=n>PVOID</span> <span class=n>StopRegisterChange</span><span class=p>;</span>               
</span></span><span class=line><span class=ln> 37</span><span class=cl>  <span class=n>PVOID</span> <span class=n>VirtualProtect</span><span class=p>;</span>                   
</span></span><span class=line><span class=ln> 38</span><span class=cl>  <span class=n>PVOID</span> <span class=n>VirtualProtectEx</span><span class=p>;</span>                 
</span></span><span class=line><span class=ln> 39</span><span class=cl>  <span class=n>PVOID</span> <span class=n>VirtualQueryEx</span><span class=p>;</span>                   
</span></span><span class=line><span class=ln> 40</span><span class=cl>  <span class=n>PVOID</span> <span class=n>VirtualAllocEx</span><span class=p>;</span>                   
</span></span><span class=line><span class=ln> 41</span><span class=cl>  <span class=n>PVOID</span> <span class=n>CreateRemoteThread</span><span class=p>;</span>               
</span></span><span class=line><span class=ln> 42</span><span class=cl>  <span class=n>PVOID</span> <span class=n>OpenThread</span><span class=p>;</span>                       
</span></span><span class=line><span class=ln> 43</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetPEProcess</span><span class=p>;</span>                     
</span></span><span class=line><span class=ln> 44</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetPEThread</span><span class=p>;</span>                      
</span></span><span class=line><span class=ln> 45</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetThreadsProcessOffset</span><span class=p>;</span>    
</span></span><span class=line><span class=ln> 46</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetThreadListEntryOffset</span><span class=p>;</span>   
</span></span><span class=line><span class=ln> 47</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetProcessnameOffset</span><span class=p>;</span>       
</span></span><span class=line><span class=ln> 48</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetDebugportOffset</span><span class=p>;</span>         
</span></span><span class=line><span class=ln> 49</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetPhysicalAddress</span><span class=p>;</span>         
</span></span><span class=line><span class=ln> 50</span><span class=cl>  <span class=n>PVOID</span> <span class=n>ProtectMe</span><span class=p>;</span>                  
</span></span><span class=line><span class=ln> 51</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetCR4</span><span class=p>;</span>                     
</span></span><span class=line><span class=ln> 52</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetCR3</span><span class=p>;</span>                     
</span></span><span class=line><span class=ln> 53</span><span class=cl>  <span class=n>PVOID</span> <span class=n>SetCR3</span><span class=p>;</span>                     
</span></span><span class=line><span class=ln> 54</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetSDT</span><span class=p>;</span>                     
</span></span><span class=line><span class=ln> 55</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetSDTShadow</span><span class=p>;</span>               
</span></span><span class=line><span class=ln> 56</span><span class=cl>  <span class=n>PVOID</span> <span class=n>setAlternateDebugMethod</span><span class=p>;</span>    
</span></span><span class=line><span class=ln> 57</span><span class=cl>  <span class=n>PVOID</span> <span class=n>getAlternateDebugMethod</span><span class=p>;</span>    
</span></span><span class=line><span class=ln> 58</span><span class=cl>  <span class=n>PVOID</span> <span class=n>DebugProcess</span><span class=p>;</span>               
</span></span><span class=line><span class=ln> 59</span><span class=cl>  <span class=n>PVOID</span> <span class=n>ChangeRegOnBP</span><span class=p>;</span>              
</span></span><span class=line><span class=ln> 60</span><span class=cl>  <span class=n>PVOID</span> <span class=n>RetrieveDebugData</span><span class=p>;</span>          
</span></span><span class=line><span class=ln> 61</span><span class=cl>  <span class=n>PVOID</span> <span class=n>StartProcessWatch</span><span class=p>;</span>          
</span></span><span class=line><span class=ln> 62</span><span class=cl>  <span class=n>PVOID</span> <span class=n>WaitForProcessListData</span><span class=p>;</span>     
</span></span><span class=line><span class=ln> 63</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetProcessNameFromID</span><span class=p>;</span>       
</span></span><span class=line><span class=ln> 64</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetProcessNameFromPEProcess</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>  <span class=n>PVOID</span> <span class=n>KernelOpenProcess</span><span class=p>;</span>          
</span></span><span class=line><span class=ln> 66</span><span class=cl>  <span class=n>PVOID</span> <span class=n>KernelReadProcessMemory</span><span class=p>;</span>    
</span></span><span class=line><span class=ln> 67</span><span class=cl>  <span class=n>PVOID</span> <span class=n>KernelWriteProcessMemory</span><span class=p>;</span>   
</span></span><span class=line><span class=ln> 68</span><span class=cl>  <span class=n>PVOID</span> <span class=n>KernelVirtualAllocEx</span><span class=p>;</span>       
</span></span><span class=line><span class=ln> 69</span><span class=cl>  <span class=n>PVOID</span> <span class=n>IsValidHandle</span><span class=p>;</span>              
</span></span><span class=line><span class=ln> 70</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetIDTCurrentThread</span><span class=p>;</span>        
</span></span><span class=line><span class=ln> 71</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetIDTs</span><span class=p>;</span>                    
</span></span><span class=line><span class=ln> 72</span><span class=cl>  <span class=n>PVOID</span> <span class=n>MakeWritable</span><span class=p>;</span>               
</span></span><span class=line><span class=ln> 73</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetLoadedState</span><span class=p>;</span>             
</span></span><span class=line><span class=ln> 74</span><span class=cl>  <span class=n>PVOID</span> <span class=n>DBKSuspendThread</span><span class=p>;</span>           
</span></span><span class=line><span class=ln> 75</span><span class=cl>  <span class=n>PVOID</span> <span class=n>DBKResumeThread</span><span class=p>;</span>            
</span></span><span class=line><span class=ln> 76</span><span class=cl>  <span class=n>PVOID</span> <span class=n>DBKSuspendProcess</span><span class=p>;</span>          
</span></span><span class=line><span class=ln> 77</span><span class=cl>  <span class=n>PVOID</span> <span class=n>DBKResumeProcess</span><span class=p>;</span>           
</span></span><span class=line><span class=ln> 78</span><span class=cl>  <span class=n>PVOID</span> <span class=n>KernelAlloc</span><span class=p>;</span>                
</span></span><span class=line><span class=ln> 79</span><span class=cl>  <span class=n>PVOID</span> <span class=n>GetKProcAddress</span><span class=p>;</span>            
</span></span><span class=line><span class=ln> 80</span><span class=cl>  <span class=n>PVOID</span> <span class=n>CreateToolhelp32Snapshot</span><span class=p>;</span>   
</span></span><span class=line><span class=ln> 81</span><span class=cl>  <span class=n>PVOID</span> <span class=n>Process32First</span><span class=p>;</span>             
</span></span><span class=line><span class=ln> 82</span><span class=cl>  <span class=n>PVOID</span> <span class=n>Process32Next</span><span class=p>;</span>              
</span></span><span class=line><span class=ln> 83</span><span class=cl>  <span class=n>PVOID</span> <span class=n>Thread32First</span><span class=p>;</span>              
</span></span><span class=line><span class=ln> 84</span><span class=cl>  <span class=n>PVOID</span> <span class=n>Thread32Next</span><span class=p>;</span>               
</span></span><span class=line><span class=ln> 85</span><span class=cl>  <span class=n>PVOID</span> <span class=n>Module32First</span><span class=p>;</span>              
</span></span><span class=line><span class=ln> 86</span><span class=cl>  <span class=n>PVOID</span> <span class=n>Module32Next</span><span class=p>;</span>               
</span></span><span class=line><span class=ln> 87</span><span class=cl>  <span class=n>PVOID</span> <span class=n>Heap32ListFirst</span><span class=p>;</span>            
</span></span><span class=line><span class=ln> 88</span><span class=cl>  <span class=n>PVOID</span> <span class=n>Heap32ListNext</span><span class=p>;</span>             
</span></span><span class=line><span class=ln> 89</span><span class=cl>  <span class=o>//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
</span></span><span class=line><span class=ln> 90</span><span class=cl>
</span></span><span class=line><span class=ln> 91</span><span class=cl>  <span class=n>PVOID</span> <span class=n>mainform</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 92</span><span class=cl>  <span class=n>PVOID</span> <span class=n>memorybrowser</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 93</span><span class=cl>
</span></span><span class=line><span class=ln> 94</span><span class=cl>  <span class=n>CEP_GENERATEAPIHOOKSCRIPT</span> <span class=n>sym_nameToAddress</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 95</span><span class=cl>  <span class=n>CEP_ADDRESSTONAME</span> <span class=n>sym_addressToName</span> <span class=p>;</span>
</span></span><span class=line><span class=ln> 96</span><span class=cl>  <span class=n>CEP_NAMETOADDRESS</span> <span class=n>sym_generateAPIHookScript</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 97</span><span class=cl>
</span></span><span class=line><span class=ln> 98</span><span class=cl>  <span class=n>CEP_LOADDBK32</span> <span class=n>loadDBK32</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 99</span><span class=cl>  <span class=n>CEP_LOADDBVMIFNEEDED</span> <span class=n>loaddbvmifneeded</span><span class=p>;</span>
</span></span><span class=line><span class=ln>100</span><span class=cl>  <span class=n>CEP_PREVIOUSOPCODE</span> <span class=n>previousOpcode</span><span class=p>;</span>
</span></span><span class=line><span class=ln>101</span><span class=cl>  <span class=n>CEP_NEXTOPCODE</span> <span class=n>nextOpcode</span><span class=p>;</span>
</span></span><span class=line><span class=ln>102</span><span class=cl>  <span class=n>CEP_DISASSEMBLEEX</span> <span class=n>disassembleEx</span><span class=p>;</span>
</span></span><span class=line><span class=ln>103</span><span class=cl>  <span class=n>CEP_LOADMODULE</span> <span class=n>loadModule</span><span class=p>;</span>
</span></span><span class=line><span class=ln>104</span><span class=cl>  <span class=n>CEP_AA_ADDCOMMAND</span> <span class=n>aa_AddExtraCommand</span><span class=p>;</span>
</span></span><span class=line><span class=ln>105</span><span class=cl>  <span class=n>CEP_AA_DELCOMMAND</span> <span class=n>aa_RemoveExtraCommand</span><span class=p>;</span>
</span></span><span class=line><span class=ln>106</span><span class=cl>
</span></span><span class=line><span class=ln>107</span><span class=cl>  <span class=n>CEP_CREATETABLEENTRY</span> <span class=n>createTableEntry</span><span class=p>;</span>
</span></span><span class=line><span class=ln>108</span><span class=cl>  <span class=n>CEP_GETTABLEENTRY</span> <span class=n>getTableEntry</span><span class=p>;</span>
</span></span><span class=line><span class=ln>109</span><span class=cl>  <span class=n>CEP_MEMREC_SETDESCRIPTION</span> <span class=n>memrec_setDescription</span><span class=p>;</span>
</span></span><span class=line><span class=ln>110</span><span class=cl>  <span class=n>CEP_MEMREC_GETDESCRIPTION</span> <span class=n>memrec_getDescription</span><span class=p>;</span>
</span></span><span class=line><span class=ln>111</span><span class=cl>  <span class=n>CEP_MEMREC_GETADDRESS</span> <span class=n>memrec_getAddress</span><span class=p>;</span>
</span></span><span class=line><span class=ln>112</span><span class=cl>  <span class=n>CEP_MEMREC_SETADDRESS</span> <span class=n>memrec_setAddress</span><span class=p>;</span>
</span></span><span class=line><span class=ln>113</span><span class=cl>  <span class=n>CEP_MEMREC_GETTYPE</span> <span class=n>memrec_getType</span><span class=p>;</span>
</span></span><span class=line><span class=ln>114</span><span class=cl>  <span class=n>CEP_MEMREC_SETTYPE</span> <span class=n>memrec_setType</span><span class=p>;</span>
</span></span><span class=line><span class=ln>115</span><span class=cl>  <span class=n>CEP_MEMREC_GETVALUETYPE</span> <span class=n>memrec_getValue</span><span class=p>;</span>
</span></span><span class=line><span class=ln>116</span><span class=cl>  <span class=n>CEP_MEMREC_SETVALUETYPE</span> <span class=n>memrec_setValue</span><span class=p>;</span>
</span></span><span class=line><span class=ln>117</span><span class=cl>  <span class=n>CEP_MEMREC_GETSCRIPT</span> <span class=n>memrec_getScript</span><span class=p>;</span>
</span></span><span class=line><span class=ln>118</span><span class=cl>  <span class=n>CEP_MEMREC_SETSCRIPT</span> <span class=n>memrec_setScript</span><span class=p>;</span>
</span></span><span class=line><span class=ln>119</span><span class=cl>  <span class=n>CEP_MEMREC_ISFROZEN</span> <span class=n>memrec_isfrozen</span><span class=p>;</span>
</span></span><span class=line><span class=ln>120</span><span class=cl>  <span class=n>CEP_MEMREC_FREEZE</span> <span class=n>memrec_freeze</span><span class=p>;</span>
</span></span><span class=line><span class=ln>121</span><span class=cl>  <span class=n>CEP_MEMREC_UNFREEZE</span> <span class=n>memrec_unfreeze</span><span class=p>;</span>
</span></span><span class=line><span class=ln>122</span><span class=cl>  <span class=n>CEP_MEMREC_SETCOLOR</span> <span class=n>memrec_setColor</span><span class=p>;</span>
</span></span><span class=line><span class=ln>123</span><span class=cl>  <span class=n>CEP_MEMREC_APPENDTOENTRY</span> <span class=n>memrec_appendtoentry</span><span class=p>;</span>
</span></span><span class=line><span class=ln>124</span><span class=cl>  <span class=n>CEP_MEMREC_DELETE</span> <span class=n>memrec_delete</span><span class=p>;</span>
</span></span><span class=line><span class=ln>125</span><span class=cl>
</span></span><span class=line><span class=ln>126</span><span class=cl>  <span class=n>CEP_GETPROCESSIDFROMPROCESSNAME</span> <span class=n>getProcessIDFromProcessName</span><span class=p>;</span>
</span></span><span class=line><span class=ln>127</span><span class=cl>  <span class=n>CEP_OPENPROCESS</span> <span class=n>openProcessEx</span><span class=p>;</span>
</span></span><span class=line><span class=ln>128</span><span class=cl>  <span class=n>CEP_DEBUGPROCESS</span> <span class=n>debugProcessEx</span><span class=p>;</span>
</span></span><span class=line><span class=ln>129</span><span class=cl>  <span class=n>CEP_PAUSE</span> <span class=n>pause</span><span class=p>;</span>
</span></span><span class=line><span class=ln>130</span><span class=cl>  <span class=n>CEP_UNPAUSE</span> <span class=n>unpause</span><span class=p>;</span>
</span></span><span class=line><span class=ln>131</span><span class=cl>
</span></span><span class=line><span class=ln>132</span><span class=cl>  <span class=n>CEP_DEBUG_SETBREAKPOINT</span> <span class=n>debug_setBreakpoint</span><span class=p>;</span>
</span></span><span class=line><span class=ln>133</span><span class=cl>  <span class=n>CEP_DEBUG_REMOVEBREAKPOINT</span> <span class=n>debug_removeBreakpoint</span><span class=p>;</span>
</span></span><span class=line><span class=ln>134</span><span class=cl>  <span class=n>CEP_DEBUG_CONTINUEFROMBREAKPOINT</span> <span class=n>debug_continueFromBreakpoint</span><span class=p>;</span>
</span></span><span class=line><span class=ln>135</span><span class=cl>
</span></span><span class=line><span class=ln>136</span><span class=cl>  <span class=n>CEP_CLOSECE</span> <span class=n>closeCE</span><span class=p>;</span>
</span></span><span class=line><span class=ln>137</span><span class=cl>  <span class=n>CEP_HIDEALLCEWINDOWS</span> <span class=n>hideAllCEWindows</span><span class=p>;</span>
</span></span><span class=line><span class=ln>138</span><span class=cl>  <span class=n>CEP_UNHIDEMAINCEWINDOW</span> <span class=n>unhideMainCEwindow</span><span class=p>;</span>
</span></span><span class=line><span class=ln>139</span><span class=cl>  <span class=n>CEP_CREATEFORM</span> <span class=n>createForm</span><span class=p>;</span>
</span></span><span class=line><span class=ln>140</span><span class=cl>  <span class=n>CEP_FORM_CENTERSCREEN</span> <span class=n>form_centerScreen</span><span class=p>;</span>
</span></span><span class=line><span class=ln>141</span><span class=cl>  <span class=n>CEP_FORM_HIDE</span> <span class=n>form_hide</span><span class=p>;</span>
</span></span><span class=line><span class=ln>142</span><span class=cl>  <span class=n>CEP_FORM_SHOW</span> <span class=n>form_show</span><span class=p>;</span>
</span></span><span class=line><span class=ln>143</span><span class=cl>  <span class=n>CEP_FORM_ONCLOSE</span> <span class=n>form_onClose</span><span class=p>;</span>
</span></span><span class=line><span class=ln>144</span><span class=cl>
</span></span><span class=line><span class=ln>145</span><span class=cl>  <span class=n>CEP_CREATEPANEL</span> <span class=n>createPanel</span><span class=p>;</span>
</span></span><span class=line><span class=ln>146</span><span class=cl>  <span class=n>CEP_CREATEGROUPBOX</span> <span class=n>createGroupBox</span><span class=p>;</span>
</span></span><span class=line><span class=ln>147</span><span class=cl>  <span class=n>CEP_CREATEBUTTON</span> <span class=n>createButton</span><span class=p>;</span>
</span></span><span class=line><span class=ln>148</span><span class=cl>  <span class=n>CEP_CREATEIMAGE</span> <span class=n>createImage</span><span class=p>;</span>
</span></span><span class=line><span class=ln>149</span><span class=cl>  <span class=n>CEP_IMAGE_LOADIMAGEFROMFILE</span> <span class=n>image_loadImageFromFile</span><span class=p>;</span>
</span></span><span class=line><span class=ln>150</span><span class=cl>  <span class=n>CEP_IMAGE_TRANSPARENT</span> <span class=n>image_transparent</span><span class=p>;</span>
</span></span><span class=line><span class=ln>151</span><span class=cl>  <span class=n>CEP_IMAGE_STRETCH</span> <span class=n>image_stretch</span><span class=p>;</span>
</span></span><span class=line><span class=ln>152</span><span class=cl>
</span></span><span class=line><span class=ln>153</span><span class=cl>  <span class=n>CEP_CREATELABEL</span> <span class=n>createLabel</span><span class=p>;</span>
</span></span><span class=line><span class=ln>154</span><span class=cl>  <span class=n>CEP_CREATEEDIT</span> <span class=n>createEdit</span><span class=p>;</span>
</span></span><span class=line><span class=ln>155</span><span class=cl>  <span class=n>CEP_CREATEMEMO</span> <span class=n>createMemo</span><span class=p>;</span>
</span></span><span class=line><span class=ln>156</span><span class=cl>  <span class=n>CEP_CREATETIMER</span> <span class=n>createTimer</span><span class=p>;</span>
</span></span><span class=line><span class=ln>157</span><span class=cl>  <span class=n>CEP_TIMER_SETINTERVAL</span> <span class=n>timer_setInterval</span><span class=p>;</span>
</span></span><span class=line><span class=ln>158</span><span class=cl>  <span class=n>CEP_TIMER_ONTIMER</span> <span class=n>timer_onTimer</span><span class=p>;</span>
</span></span><span class=line><span class=ln>159</span><span class=cl>  <span class=n>CEP_CONTROL_SETCAPTION</span> <span class=n>control_setCaption</span><span class=p>;</span>
</span></span><span class=line><span class=ln>160</span><span class=cl>  <span class=n>CEP_CONTROL_GETCAPTION</span> <span class=n>control_getCaption</span><span class=p>;</span>
</span></span><span class=line><span class=ln>161</span><span class=cl>  <span class=n>CEP_CONTROL_SETPOSITION</span> <span class=n>control_setPosition</span><span class=p>;</span>
</span></span><span class=line><span class=ln>162</span><span class=cl>  <span class=n>CEP_CONTROL_GETX</span> <span class=n>control_getX</span><span class=p>;</span>
</span></span><span class=line><span class=ln>163</span><span class=cl>  <span class=n>CEP_CONTROL_GETY</span> <span class=n>control_getY</span><span class=p>;</span>
</span></span><span class=line><span class=ln>164</span><span class=cl>  <span class=n>CEP_CONTROL_SETSIZE</span> <span class=n>control_setSize</span><span class=p>;</span>
</span></span><span class=line><span class=ln>165</span><span class=cl>  <span class=n>CEP_CONTROL_GETWIDTH</span> <span class=n>control_getWidth</span><span class=p>;</span>
</span></span><span class=line><span class=ln>166</span><span class=cl>  <span class=n>CEP_CONTROL_GETHEIGHT</span> <span class=n>control_getHeight</span><span class=p>;</span>
</span></span><span class=line><span class=ln>167</span><span class=cl>  <span class=n>CEP_CONTROL_SETALIGN</span> <span class=n>control_setAlign</span><span class=p>;</span>
</span></span><span class=line><span class=ln>168</span><span class=cl>  <span class=n>CEP_CONTROL_ONCLICK</span> <span class=n>control_onClick</span><span class=p>;</span>
</span></span><span class=line><span class=ln>169</span><span class=cl>
</span></span><span class=line><span class=ln>170</span><span class=cl>  <span class=n>CEP_OBJECT_DESTROY</span> <span class=n>object_destroy</span><span class=p>;</span>
</span></span><span class=line><span class=ln>171</span><span class=cl>  <span class=n>CEP_MESSAGEDIALOG</span> <span class=n>messageDialog</span><span class=p>;</span>
</span></span><span class=line><span class=ln>172</span><span class=cl>  <span class=n>CEP_SPEEDHACK_SETSPEED</span> <span class=n>speedhack_setSpeed</span><span class=p>;</span> 
</span></span><span class=line><span class=ln>173</span><span class=cl>
</span></span><span class=line><span class=ln>174</span><span class=cl><span class=p>}</span> <span class=n>ExportedFunctions</span><span class=p>,</span> <span class=o>*</span><span class=n>PExportedFunctions</span><span class=p>;</span>
</span></span></code></pre></div><p>这个函数的成员太多了，具体的可以自己去看参考文档QAQ</p><h4 id=导出函数具体分析>导出函数具体分析</h4><h5 id=ceplugin_getversion>CEPlugin_GetVersion</h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>BOOL</span> <span class=n>__stdcall</span> <span class=n>CEPlugin_GetVersion</span><span class=p>(</span><span class=n>PPluginVersion</span> <span class=n>pv</span> <span class=p>,</span> <span class=n>int</span> <span class=n>sizeofpluginversion</span><span class=p>)</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>        <span class=n>pv</span><span class=o>-&gt;</span><span class=n>version</span><span class=o>=</span><span class=n>CESDK_VERSION</span><span class=p>;</span>        <span class=o>//</span><span class=err>这里的</span><span class=n>CESDK_VERSION为常量6</span><span class=err>，可以自行修改</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>        <span class=n>pv</span><span class=o>-&gt;</span><span class=n>pluginname</span><span class=o>=</span><span class=s2>&#34;C Example v1.3 (SDK version 4: 6.0+)&#34;</span><span class=p>;</span> <span class=o>//</span><span class=err>像这样的精确字符串是指向</span><span class=n>dll中的字符串的指针</span><span class=err>，因此是可行的</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>        <span class=kr>return</span> <span class=n>TRUE</span><span class=p>;</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h5 id=ceplugin_disableplugin>CEPlugin_DisablePlugin</h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>BOOL</span> <span class=n>__stdcall</span> <span class=n>CEPlugin_DisablePlugin</span><span class=p>(</span><span class=n>void</span><span class=p>)</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>        <span class=o>//</span><span class=err>调用</span><span class=n>MessageBoxA方法弹窗</span><span class=err>，表示当前插件已关闭</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>        <span class=n>MessageBoxA</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=s2>&#34;disabled plugin&#34;</span><span class=p>,</span><span class=s2>&#34;Example C plugin&#34;</span><span class=p>,</span> <span class=n>MB_OK</span><span class=p>);</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>
</span></span><span class=line><span class=ln>6</span><span class=cl>        <span class=kr>return</span> <span class=n>TRUE</span><span class=p>;</span>
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h5 id=ceplugin_initializeplugin>CEPlugin_InitializePlugin</h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln> 1</span><span class=cl><span class=n>BOOL</span> <span class=n>__stdcall</span> <span class=n>CEPlugin_InitializePlugin</span><span class=p>(</span><span class=n>PExportedFunctions</span> <span class=n>ef</span> <span class=p>,</span> <span class=n>int</span> <span class=n>pluginid</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=o>//</span><span class=err>中间省略的部分为在</span><span class=n>CE的窗口中添加自己的菜单等界面的功能</span><span class=err>，暂时没有用到，有兴趣的可以自己研究</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>        <span class=o>//</span><span class=p>....</span><span class=err>省略</span><span class=o>//</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>        <span class=n>selfid</span><span class=o>=</span><span class=n>pluginid</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>        <span class=o>//</span><span class=p>....</span><span class=err>省略</span><span class=o>//</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>        <span class=n>lua_State</span> <span class=o>*</span><span class=n>lua_state</span><span class=o>=</span><span class=n>ef</span><span class=o>-&gt;</span><span class=n>GetLuaState</span><span class=p>();</span>        <span class=o>//</span><span class=err>这里的</span><span class=n>lua_state固定写成这样就好</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=o>//</span><span class=err>注册</span><span class=n>lua的调用事件</span><span class=err>，这个是</span><span class=n>lua提供的函数</span>        
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=o>//</span><span class=err>这里的</span><span class=n>lua_pluginExample是我们按照LUA规范定义的C语言函数</span><span class=err>，提供给</span><span class=n>LUA调用</span><span class=p>,</span><span class=err>下面会具体讲解</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>        <span class=n>lua_register</span><span class=p>(</span><span class=n>lua_state</span><span class=p>,</span> <span class=s2>&#34;pluginExample&#34;</span><span class=p>,</span> <span class=n>lua_pluginExample</span><span class=p>);</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl>        <span class=n>Exported.ShowMessage</span><span class=p>(</span><span class=s2>&#34;The </span><span class=se>\&#34;</span><span class=s2>Example C</span><span class=se>\&#34;</span><span class=s2> plugin got enabled&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>        <span class=kr>return</span> <span class=n>TRUE</span><span class=p>;</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>关于lua的函数可以参考<a class=link href=https://www.runoob.com/manual/lua53doc/contents.html#index target=_blank rel=noopener>Lua 函数索引</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span>，这里只讲解用到的</p><h6 id=lua_register>lua_register</h6><p>参考<a class=link href=https://www.runoob.com/manual/lua53doc/manual.html#lua_register target=_blank rel=noopener>lua_register</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>void</span> <span class=n>lua_register</span> <span class=p>(</span><span class=n>lua_State</span> <span class=o>*</span><span class=n>L</span><span class=p>,</span> <span class=n>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>name</span><span class=p>,</span> <span class=n>lua_CFunction</span> <span class=n>f</span><span class=p>);</span>
</span></span></code></pre></div><p>把 C 函数 <code>f</code> 设到全局变量 <code>name</code> 中。 它通过一个宏定义：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-CPP data-lang=CPP><span class=line><span class=ln>1</span><span class=cl>     <span class=cp>#define lua_register(L,n,f) \
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=cp>            (lua_pushcfunction(L, f), lua_setglobal(L, n))
</span></span></span></code></pre></div><p>这里可以知道其实lua_register其实是在调用lua_pushcfunction和lua_setglobal</p><h6 id=lua_pushcfunction>lua_pushcfunction</h6><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>void</span> <span class=n>lua_pushcfunction</span> <span class=p>(</span><span class=n>lua_State</span> <span class=o>*</span><span class=n>L</span><span class=p>,</span> <span class=n>lua_CFunction</span> <span class=n>f</span><span class=p>);</span>
</span></span></code></pre></div><p>参考<a class=link href=https://www.runoob.com/manual/lua53doc/manual.html#lua_pushcfunction target=_blank rel=noopener>lua_pushcfunction</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><p>将一个 C 函数压栈。 这个函数接收一个 C 函数指针， 并将一个类型为 <code>function</code> 的 Lua 值压栈。 当这个栈顶的值被调用时，将触发对应的 C 函数。</p><p>注册到 Lua 中的任何函数都必须遵循正确的协议来接收参数和返回值 （参见 <a class=link href=https://www.runoob.com/manual/lua53doc/manual.html#lua_CFunction target=_blank rel=noopener><code>lua_CFunction</code></a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span>）</p><h6 id=lua_cfunction>lua_CFunction</h6><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>typedef</span> <span class=n>int</span> <span class=p>(</span><span class=o>*</span><span class=n>lua_CFunction</span><span class=p>)</span> <span class=p>(</span><span class=n>lua_State</span> <span class=o>*</span><span class=n>L</span><span class=p>);</span>
</span></span></code></pre></div><p>定义了要在LUA中调用的C函数的格式,下面看看example-c中的范例</p><h6 id=lua_pluginexample>lua_pluginExample</h6><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>int</span> <span class=n>lua_pluginExample</span><span class=p>(</span><span class=n>lua_State</span> <span class=o>*</span><span class=n>L</span><span class=p>)</span> <span class=o>//</span><span class=n>make</span> <span class=n>sure</span> <span class=n>this</span> <span class=n>is</span> <span class=n>cdecl</span>        <span class=err>确保采用默认的</span><span class=n>cdecl调用协定</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>        <span class=n>Exported.ShowMessage</span><span class=p>(</span><span class=s2>&#34;Called from lua&#34;</span><span class=p>);</span><span class=o>//</span><span class=n>CE中输出消息</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>        <span class=n>lua_pushinteger</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=mi>123</span><span class=p>);</span><span class=o>//</span><span class=err>将</span><span class=mi>123</span><span class=err>作为返回值压入到堆栈中</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>        <span class=kr>return</span> <span class=mi>1</span><span class=p>;</span><span class=o>//</span><span class=err>返回</span> <span class=err>返回值的个数，这里只有一个返回值</span><span class=mi>123</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>C 函数只需要把它们以正序压到堆栈上（第一个返回值最先压入）， 然后返回这些返回值的个数</p><p><strong>Lua和C/C++语言通信的主要方法是一个无处不在的虚拟栈</strong></p><h6 id=lua_setglobal>lua_setglobal</h6><p>参考<a class=link href=https://www.runoob.com/manual/lua53doc/manual.html#lua_setglobal target=_blank rel=noopener>lua_setglobal</a>
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>void</span> <span class=n>lua_setglobal</span> <span class=p>(</span><span class=n>lua_State</span> <span class=o>*</span><span class=n>L</span><span class=p>,</span> <span class=n>const</span> <span class=n>char</span> <span class=o>*</span><span class=n>name</span><span class=p>);</span>
</span></span></code></pre></div><p>从堆栈上弹出一个值，并将其设为全局变量 <code>name</code> 的新值</p><hr><p>综上分析我们可以得知<strong>lua_register的信息</strong>：</p><div class=table-wrapper><table><thead><tr><th>参数</th><th>参数类型</th><th>含义</th></tr></thead><tbody><tr><td>L</td><td>lua_State*</td><td>指向lua_State的指针，这里我们固定赋值为ef->GetLuaState()即可</td></tr><tr><td>name</td><td>const char *</td><td>在lua中要调用时的函数名称</td></tr><tr><td>f</td><td>lua_CFunction</td><td>遵循正确的lua协议的C函数</td></tr></tbody></table></div><div class=table-wrapper><table><thead><tr><th>返回值</th><th>返回值类型</th><th>说明</th></tr></thead><tbody><tr><td>num</td><td>int</td><td>返回前面压入到堆栈中的个数</td></tr></tbody></table></div><hr><h4 id=在ce-lua中调用插件提供的函数>在CE LUA中调用插件提供的函数</h4><p>上面给大家讲解了我们插件的源码以及插件中提供的LUA的接口，接下来演示在CE的LUA中调用函数</p><p>首先确保加载了example-c插件</p><p>可以看到后面的此时插件显示的面板为CEPlugin_GetVersion中我们设置的内容</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211131605923.webp width=1391 height=564 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211131605923_hue76f0cabd6d76d57dabf326185c8d825_36008_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211131605923_hue76f0cabd6d76d57dabf326185c8d825_36008_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211131605923 class=gallery-image data-flex-grow=246 data-flex-basis=591px></p><p>然后打开LUA窗口：表单→显示CT表的Lua脚本</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211132001336.webp width=511 height=449 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211132001336_hudd6497ca570b0b704b0a48dcfe15fff4_7098_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211132001336_hudd6497ca570b0b704b0a48dcfe15fff4_7098_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211132001336 class=gallery-image data-flex-grow=113 data-flex-basis=273px></p><p>我们输入lua命令来调用CEPlugin_InitializePlugin中通过lua_register注册的函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=ln>1</span><span class=cl><span class=n>ret</span><span class=o>=</span><span class=n>pluginExample</span><span class=p>()</span>        <span class=c1>--这里的pluginExample是在lua_register中注册的第二个参数</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span>                        <span class=c1>--这里的返回值是lua_pushinteger得来的</span>
</span></span></code></pre></div><p>执行以后可以看到:</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211132140107.webp width=822 height=251 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211132140107_hucb7700009c883f15352bd28bddf93bfe_6130_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211132140107_hucb7700009c883f15352bd28bddf93bfe_6130_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211132140107 class=gallery-image data-flex-grow=327 data-flex-basis=785px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211132204487.webp width=492 height=509 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211132204487_hufb1fd1fdb2f974d227ed8ec1ba9f83e3_7296_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211132204487_hufb1fd1fdb2f974d227ed8ec1ba9f83e3_7296_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211132204487 class=gallery-image data-flex-grow=96 data-flex-basis=231px></p><p>调用了我们在C中定义好的函数</p><h2 id=开发自己的ce-plugin>开发自己的CE Plugin</h2><p>前面分析完了CE自带的插件例子，我们开始着手自己写一个插件吧</p><h3 id=创建项目>创建项目</h3><p>打开VS2015        文件→新建→项目        （Ctrl+Shift+N）</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143036501.webp width=2162 height=1498 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143036501_hu760f226976076294070175ba627091f5_90626_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143036501_hu760f226976076294070175ba627091f5_90626_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211143036501 class=gallery-image data-flex-grow=144 data-flex-basis=346px></p><p>点击确定以后出现Win32 应用程序向导</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143115494.webp width=1555 height=1276 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143115494_hu98b8cb16ed11bb56b1d07b5bfc622fc5_39022_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143115494_hu98b8cb16ed11bb56b1d07b5bfc622fc5_39022_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211143115494 class=gallery-image data-flex-grow=121 data-flex-basis=292px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143613774.webp width=1555 height=1276 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143613774_hub28e5eced8075736b351c3f56f5d6657_42172_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143613774_hub28e5eced8075736b351c3f56f5d6657_42172_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211143613774 class=gallery-image data-flex-grow=121 data-flex-basis=292px></p><p>完成以后，一个空的DLL项目就出现了</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143847108.webp width=3840 height=2084 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143847108_hudacd03a7ad911252b3e29fe31b1eeee0_117314_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143847108_hudacd03a7ad911252b3e29fe31b1eeee0_117314_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211143847108 class=gallery-image data-flex-grow=184 data-flex-basis=442px></p><h3 id=设置项目属性>设置项目属性</h3><p>我们点击源文件，右键 添加→新建项 （Ctrl+Shift+A）</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143927942.webp width=785 height=318 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143927942_hudf1de09464110f4b703497c5361639bf_15090_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211143927942_hudf1de09464110f4b703497c5361639bf_15090_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211143927942 class=gallery-image data-flex-grow=246 data-flex-basis=592px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211144042090.webp width=2125 height=1473 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211144042090_hu0ba01a1f4a3954543ab413ab82088a7d_62348_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211144042090_hu0ba01a1f4a3954543ab413ab82088a7d_62348_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211144042090 class=gallery-image data-flex-grow=144 data-flex-basis=346px></p><p>创建出一个空的main.cpp以后，我们设置一下项目的属性：项目→属性</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211144146837.webp width=1703 height=124 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211144146837_hua70f3110903c1eeaad7a37959feb5b29_17550_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211144146837_hua70f3110903c1eeaad7a37959feb5b29_17550_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211144146837 class=gallery-image data-flex-grow=1373 data-flex-basis=3296px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211144218992.webp width=1950 height=1235 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211144218992_hu5c8df2017a8173f829a033227f37c971_117214_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211144218992_hu5c8df2017a8173f829a033227f37c971_117214_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211144218992 class=gallery-image data-flex-grow=157 data-flex-basis=378px></p><p>确保配置为Release 平台为所有平台</p><p>然后打开配置管理器，同样修改配置和平台</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211144313016.webp width=1404 height=916 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211144313016_hu747b22bddde47d1b92253a50d8d2351d_28010_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211144313016_hu747b22bddde47d1b92253a50d8d2351d_28010_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211144313016 class=gallery-image data-flex-grow=153 data-flex-basis=367px></p><h3 id=导入ce相关文件>导入CE相关文件</h3><p>接下来别忘了导入CE提供的 .lib文件以及.h头文件</p><p>将cheat-engine-7.2\Cheat Engine\plugin下的以下文件复制到我们项目的目录下</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211150935139.webp width=1654 height=911 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211150935139_hua1c476028dffbe4beea945e053a7ed26_77854_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211150935139_hua1c476028dffbe4beea945e053a7ed26_77854_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211150935139 class=gallery-image data-flex-grow=181 data-flex-basis=435px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151032944.webp width=1757 height=702 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151032944_hu413274ea6be1b01f1388d352f20eb7aa_79908_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151032944_hu413274ea6be1b01f1388d352f20eb7aa_79908_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211151032944 class=gallery-image data-flex-grow=250 data-flex-basis=600px></p><p>然后回到VS2015,选中项目 右键 添加→现有项</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151150372.webp width=796 height=534 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151150372_hua6f39e433fca2b7e39bffe368e7eb7cb_28118_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151150372_hua6f39e433fca2b7e39bffe368e7eb7cb_28118_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211151150372 class=gallery-image data-flex-grow=149 data-flex-basis=357px></p><p>将我们之前复制的文件全部添加进来</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151229766.webp width=1461 height=1158 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151229766_hue5c2494a96eb2464d8430b94c472ce54_89366_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151229766_hue5c2494a96eb2464d8430b94c472ce54_89366_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211151229766 class=gallery-image data-flex-grow=126 data-flex-basis=302px></p><p>此时.h头文件已经添加进来可以使用了，但静态库.lib文件还需要添加一下引用</p><p>项目→属性→链接器→输入→附加依赖项→编辑</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151637978.webp width=2245 height=1235 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151637978_hue7eb2bf8c9639003014e80da458fc9cc_89544_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151637978_hue7eb2bf8c9639003014e80da458fc9cc_89544_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211151637978 class=gallery-image data-flex-grow=181 data-flex-basis=436px></p><p>然后将lua53-32.lib和lua53-64.lib添加进来</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151718726.webp width=895 height=819 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151718726_hu5d900141ba6249b6d50e20a13e2234db_31364_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151718726_hu5d900141ba6249b6d50e20a13e2234db_31364_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211151718726 class=gallery-image data-flex-grow=109 data-flex-basis=262px></p><p>添加完成后显示为<img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151801331.webp width=1740 height=55 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151801331_hu7232c4dd192d0d70176745b9315137a8_10462_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211151801331_hu7232c4dd192d0d70176745b9315137a8_10462_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211151801331 class=gallery-image data-flex-grow=3163 data-flex-basis=7592px></p><p>PS：也可以在代码的开头添加下列代码来引入静态库文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-CPP data-lang=CPP><span class=line><span class=ln>1</span><span class=cl><span class=cp>#pragma comment(lib,&#34;lua53-32.lib&#34;)
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=cp>#pragma comment(lib,&#34;lua53-64.lib&#34;)
</span></span></span></code></pre></div><h3 id=添加dll入口函数>添加DLL入口函数</h3><p>这个是DLL函数必须的入口函数，可以从example-c那里拷贝过来，开发DLL的基础~~~</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-CPP data-lang=CPP><span class=line><span class=ln> 1</span><span class=cl><span class=n>BOOL</span> <span class=n>APIENTRY</span> <span class=nf>DllMain</span><span class=p>(</span><span class=n>HANDLE</span> <span class=n>hModule</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>        <span class=n>DWORD</span>  <span class=n>ul_reason_for_call</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>        <span class=n>LPVOID</span> <span class=n>lpReserved</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=n>ul_reason_for_call</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>        <span class=k>case</span> <span class=nl>DLL_PROCESS_ATTACH</span><span class=p>:</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>                <span class=c1>//MessageBox(0,&#34;This plugin dll got loaded (This message comes from the dll)&#34;,&#34;C Plugin Example&#34;,MB_OK);
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1></span>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl>        <span class=k>case</span> <span class=nl>DLL_THREAD_ATTACH</span><span class=p>:</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>        <span class=k>case</span> <span class=nl>DLL_THREAD_DETACH</span><span class=p>:</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>        <span class=k>case</span> <span class=nl>DLL_PROCESS_DETACH</span><span class=p>:</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>
</span></span><span class=line><span class=ln>18</span><span class=cl>        <span class=k>return</span> <span class=n>TRUE</span><span class=p>;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=添加del导出配置>添加.del导出配置</h3><p>在源文件这里 右键 新建→新建项</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211152717446.webp width=795 height=653 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211152717446_hu73a4b9915c83cc22bea4b5b7a7486233_27532_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211152717446_hu73a4b9915c83cc22bea4b5b7a7486233_27532_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211152717446 class=gallery-image data-flex-grow=121 data-flex-basis=292px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211152659630.webp width=2125 height=1473 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211152659630_hu7d46b816b1f0722a58a22b05c1cf2ba8_58090_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211152659630_hu7d46b816b1f0722a58a22b05c1cf2ba8_58090_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211152659630 class=gallery-image data-flex-grow=144 data-flex-basis=346px></p><p>在.def文件中写如以下内容</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-CPP data-lang=CPP><span class=line><span class=ln>1</span><span class=cl><span class=n>LIBRARY</span>        <span class=n>MyPlugin</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=n>EXPORTS</span>   
</span></span><span class=line><span class=ln>3</span><span class=cl>    <span class=n>CEPlugin_GetVersion</span>        <span class=err>@</span><span class=mi>1</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>    <span class=n>CEPlugin_InitializePlugin</span> <span class=err>@</span><span class=mi>2</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>    <span class=n>CEPlugin_DisablePlugin</span> <span class=err>@</span><span class=mi>3</span>
</span></span></code></pre></div><p>表明以上三个函数为要的导出函数，原因之前已经说过是CE规范要求的</p><h3 id=编写自己的功能>编写自己的功能</h3><p>接着就在我们的程序中分别添加这三个函数即可</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-CPP data-lang=CPP><span class=line><span class=ln> 1</span><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;windows.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;cepluginsdk.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=cp></span><span class=c1>//导入静态库
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1></span><span class=cp>#pragma comment(lib,&#34;lua53-32.lib&#34;)
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=cp>#pragma comment(lib,&#34;lua53-64.lib&#34;)
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=cp></span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1>//插件的id
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>selfid</span><span class=p>;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1>//CE 提供的导出功能
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1></span><span class=n>ExportedFunctions</span> <span class=n>Exported</span><span class=p>;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1>//入口函数
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=c1></span><span class=n>BOOL</span> <span class=n>APIENTRY</span> <span class=nf>DllMain</span><span class=p>(</span><span class=n>HANDLE</span> <span class=n>hModule</span><span class=p>,</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>        <span class=n>DWORD</span>  <span class=n>ul_reason_for_call</span><span class=p>,</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>        <span class=n>LPVOID</span> <span class=n>lpReserved</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=n>ul_reason_for_call</span><span class=p>)</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>        <span class=k>case</span> <span class=nl>DLL_PROCESS_ATTACH</span><span class=p>:</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>                <span class=c1>//MessageBox(0,&#34;This plugin dll got loaded (This message comes from the dll)&#34;,&#34;C Plugin Example&#34;,MB_OK);
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1></span>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>
</span></span><span class=line><span class=ln>26</span><span class=cl>        <span class=k>case</span> <span class=nl>DLL_THREAD_ATTACH</span><span class=p>:</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>        <span class=k>case</span> <span class=nl>DLL_THREAD_DETACH</span><span class=p>:</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>        <span class=k>case</span> <span class=nl>DLL_PROCESS_DETACH</span><span class=p>:</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>
</span></span><span class=line><span class=ln>32</span><span class=cl>        <span class=k>return</span> <span class=n>TRUE</span><span class=p>;</span>
</span></span><span class=line><span class=ln>33</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>
</span></span><span class=line><span class=ln>35</span><span class=cl><span class=n>BOOL</span> <span class=kr>__stdcall</span> <span class=nf>CEPlugin_GetVersion</span><span class=p>(</span><span class=n>PPluginVersion</span> <span class=n>pv</span> <span class=p>,</span> <span class=kt>int</span> <span class=n>sizeofpluginversion</span><span class=p>)</span>
</span></span><span class=line><span class=ln>36</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>        <span class=n>pv</span><span class=o>-&gt;</span><span class=n>version</span><span class=o>=</span><span class=n>CESDK_VERSION</span><span class=p>;</span>        <span class=c1>//这里的CESDK_VERSION为常量6，可以自行修改
</span></span></span><span class=line><span class=ln>38</span><span class=cl><span class=c1></span>        <span class=n>pv</span><span class=o>-&gt;</span><span class=n>pluginname</span><span class=o>=</span><span class=s>&#34;MyPlugin&#34;</span><span class=p>;</span> <span class=c1>//像这样的精确字符串是指向dll中的字符串的指针，因此是可行的
</span></span></span><span class=line><span class=ln>39</span><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>TRUE</span><span class=p>;</span>
</span></span><span class=line><span class=ln>40</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>
</span></span><span class=line><span class=ln>42</span><span class=cl><span class=c1>//满足LUA规范的C函数，这里为调用WIN32的GetWindowRect函数并返回
</span></span></span><span class=line><span class=ln>43</span><span class=cl><span class=c1></span><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>lua_GetWindowRect</span><span class=p>(</span><span class=n>lua_State</span> <span class=o>*</span><span class=n>L</span><span class=p>)</span> <span class=c1>//make sure this is cdecl
</span></span></span><span class=line><span class=ln>44</span><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>        <span class=n>DWORD</span> <span class=n>handle</span> <span class=o>=</span> <span class=n>luaL_checknumber</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>        <span class=c1>//Exported.ShowMessage(&#34;Called from lua&#34;);
</span></span></span><span class=line><span class=ln>47</span><span class=cl><span class=c1></span>        <span class=n>RECT</span> <span class=n>rect</span><span class=p>;</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>        <span class=n>ZeroMemory</span><span class=p>(</span><span class=o>&amp;</span><span class=n>rect</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>RECT</span><span class=p>));</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>        <span class=n>GetWindowRect</span><span class=p>((</span><span class=n>HWND</span><span class=p>)</span><span class=n>handle</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>rect</span><span class=p>);</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>        <span class=c1>//lua_pushinteger(L, handle);
</span></span></span><span class=line><span class=ln>51</span><span class=cl><span class=c1></span>        <span class=n>lua_pushinteger</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=n>rect</span><span class=p>.</span><span class=n>left</span><span class=p>);</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>        <span class=n>lua_pushinteger</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=n>rect</span><span class=p>.</span><span class=n>top</span><span class=p>);</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>        <span class=n>lua_pushinteger</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=n>rect</span><span class=p>.</span><span class=n>right</span><span class=p>);</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>        <span class=n>lua_pushinteger</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=n>rect</span><span class=p>.</span><span class=n>bottom</span><span class=p>);</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>        <span class=k>return</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=ln>56</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>
</span></span><span class=line><span class=ln>58</span><span class=cl><span class=n>BOOL</span> <span class=kr>__stdcall</span> <span class=nf>CEPlugin_InitializePlugin</span><span class=p>(</span><span class=n>PExportedFunctions</span> <span class=n>ef</span><span class=p>,</span> <span class=kt>int</span> <span class=n>pluginid</span><span class=p>)</span>
</span></span><span class=line><span class=ln>59</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>
</span></span><span class=line><span class=ln>61</span><span class=cl>        <span class=n>selfid</span> <span class=o>=</span> <span class=n>pluginid</span><span class=p>;</span>
</span></span><span class=line><span class=ln>62</span><span class=cl>
</span></span><span class=line><span class=ln>63</span><span class=cl>        <span class=c1>//copy the EF list to Exported
</span></span></span><span class=line><span class=ln>64</span><span class=cl><span class=c1></span>        <span class=n>Exported</span> <span class=o>=</span> <span class=o>*</span><span class=n>ef</span><span class=p>;</span> <span class=c1>//Exported is defined in the .h
</span></span></span><span class=line><span class=ln>65</span><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>Exported</span><span class=p>.</span><span class=n>sizeofExportedFunctions</span> <span class=o>!=</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>Exported</span><span class=p>))</span>
</span></span><span class=line><span class=ln>66</span><span class=cl>                <span class=k>return</span> <span class=n>FALSE</span><span class=p>;</span>
</span></span><span class=line><span class=ln>67</span><span class=cl>
</span></span><span class=line><span class=ln>68</span><span class=cl>        <span class=n>lua_State</span> <span class=o>*</span><span class=n>lua_state</span> <span class=o>=</span> <span class=n>ef</span><span class=o>-&gt;</span><span class=n>GetLuaState</span><span class=p>();</span>
</span></span><span class=line><span class=ln>69</span><span class=cl>        <span class=c1>//注册lua的调用事件，这个是lua提供的函数        
</span></span></span><span class=line><span class=ln>70</span><span class=cl><span class=c1></span>    <span class=c1>//这里的lua_GetWindowRect是我们按照LUA规范定义的C语言函数，提供给LUA调用
</span></span></span><span class=line><span class=ln>71</span><span class=cl><span class=c1></span>        <span class=n>lua_register</span><span class=p>(</span><span class=n>lua_state</span><span class=p>,</span> <span class=s>&#34;GetWindowRect&#34;</span><span class=p>,</span> <span class=n>lua_GetWindowRect</span><span class=p>);</span>
</span></span><span class=line><span class=ln>72</span><span class=cl>
</span></span><span class=line><span class=ln>73</span><span class=cl>        <span class=n>Exported</span><span class=p>.</span><span class=n>ShowMessage</span><span class=p>(</span><span class=s>&#34;The </span><span class=se>\&#34;</span><span class=s>MyPlugin</span><span class=se>\&#34;</span><span class=s> plugin got enabled&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>74</span><span class=cl>        <span class=k>return</span> <span class=n>TRUE</span><span class=p>;</span>
</span></span><span class=line><span class=ln>75</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>76</span><span class=cl>
</span></span><span class=line><span class=ln>77</span><span class=cl><span class=n>BOOL</span> <span class=kr>__stdcall</span> <span class=nf>CEPlugin_DisablePlugin</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=ln>78</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>79</span><span class=cl>        <span class=c1>//clean up memory you might have allocated
</span></span></span><span class=line><span class=ln>80</span><span class=cl><span class=c1></span>        <span class=n>MessageBoxA</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s>&#34;disabled plugin&#34;</span><span class=p>,</span> <span class=s>&#34;MyPlugin&#34;</span><span class=p>,</span> <span class=n>MB_OK</span><span class=p>);</span>
</span></span><span class=line><span class=ln>81</span><span class=cl>
</span></span><span class=line><span class=ln>82</span><span class=cl>        <span class=k>return</span> <span class=n>TRUE</span><span class=p>;</span>
</span></span><span class=line><span class=ln>83</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=测试自己的功能>测试自己的功能</h3><p>然后我们Ctrl+Shift+B编译我们的插件</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211153852967.webp width=2978 height=336 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211153852967_hu19334dcc6aa7c345d939f3f949499006_39226_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211153852967_hu19334dcc6aa7c345d939f3f949499006_39226_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211153852967 class=gallery-image data-flex-grow=886 data-flex-basis=2127px></p><p>将生成好的插件用CE加载</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211153810924.webp width=1563 height=462 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211153810924_hu57a9d8e69d7a2d97779a62eabc2873b8_44148_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211153810924_hu57a9d8e69d7a2d97779a62eabc2873b8_44148_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211153810924 class=gallery-image data-flex-grow=338 data-flex-basis=811px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211153933659.webp width=1389 height=888 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211153933659_hu9194caf96acc9531bc8aec87324c7f81_38810_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211153933659_hu9194caf96acc9531bc8aec87324c7f81_38810_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211153933659 class=gallery-image data-flex-grow=156 data-flex-basis=375px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211153954199.webp width=1391 height=564 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211153954199_hu1793c7d4b6cbfa1ec454c46ff9548b21_32606_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211153954199_hu1793c7d4b6cbfa1ec454c46ff9548b21_32606_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211153954199 class=gallery-image data-flex-grow=246 data-flex-basis=591px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154015117.webp width=822 height=251 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154015117_hu9534e04e719ed09ab16a2d094851379b_7926_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154015117_hu9534e04e719ed09ab16a2d094851379b_7926_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211154015117 class=gallery-image data-flex-grow=327 data-flex-basis=785px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154201166.webp width=847 height=449 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154201166_hu9d54cf28bf3fe5bcb0f26ab096060672_20454_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154201166_hu9d54cf28bf3fe5bcb0f26ab096060672_20454_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211154201166 class=gallery-image data-flex-grow=188 data-flex-basis=452px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154207493.webp width=533 height=836 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154207493_hue418542a05668a31fa30a3152ea49002_8342_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154207493_hue418542a05668a31fa30a3152ea49002_8342_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211154207493 class=gallery-image data-flex-grow=63 data-flex-basis=153px></p><p><strong>测试完毕</strong>！！！我们的函数可以正常调用，否则原本会显示</p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154352286.webp width=822 height=266 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154352286_hub02c0ce587df1fa9660f1086b75ef214_6984_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154352286_hub02c0ce587df1fa9660f1086b75ef214_6984_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211154352286 class=gallery-image data-flex-grow=309 data-flex-basis=741px></p><p><img src=/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154412069.webp width=533 height=836 srcset="/post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154412069_hu3c39804bd3bd8ade292012d95cd61523_21010_480x0_resize_q75_h2_box_2.webp 480w, /post/ce%E8%87%AA%E5%86%99%E6%8F%92%E4%BB%B6-lua%E6%8E%A5%E5%8F%A3-pvz-%E5%83%B5%E5%B0%B8%E7%BB%98%E5%88%B6/image-20210211154412069_hu3c39804bd3bd8ade292012d95cd61523_21010_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=image-20210211154412069 class=gallery-image data-flex-grow=63 data-flex-basis=153px></p><h2 id=总结>总结</h2><p>总算是把这个教程给更新完了，CE的插件功能可以让我们用C来实现很多强大的功能，我只是简单地带大家了解了一下有关CE的插件开发流程，还可以增加很多有用复杂的功能，我这里限于篇幅也不展开了。底下会<strong>附上我开发的插件的源码和插件</strong></p><p>最后，希望大家能一起变强，相互交流，相互进步，我也只是个<strong>勉强入门的萌新</strong>，能力不足，水平有限，希望大家多多支持和鼓励一下。以上~~~~期待我们的下次再会</p><p>下载链接：<a class=link href="MyPlugin.zip?versionId=CAEQHhiBgICetbLAvBciIDZkZWM2ZTA3NGZmZjRhZTE5ZTZiNWNhYzZlODQ0Mjhh">MyPlugin</a></p><p>源码太大了，只能用自己的阿里云OSS了 QAQ</p><p>PS：本插件和上篇教程的插件是同一个插件，改了个名字而已</p></section><footer class=article-footer><section class=article-tags><a href=/tags/ce%E4%BF%AE%E6%94%B9%E5%99%A8/>CE修改器</a>
<a href=/tags/%E5%8F%8D%E6%B1%87%E7%BC%96/>反汇编</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>转载</span></section><section class=article-lastmod><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>最后更新于 2024-01-01 05:59 UTC</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/post/ffmpeg-python-video-allinsmall/><div class=article-details><h2 class=article-title>ffmpeg批量压缩转换视频为30FPS</h2></div></a></article><article><a href=/post/bz-gzqc/><div class=article-details><h2 class=article-title>b站关注批量删除</h2></div></a></article><article><a href=/post/zhibo-24h/><div class=article-details><h2 class=article-title>使用linux进行24小时直播</h2></div></a></article><article><a href=/post/7z-jiake/><div class=article-details><h2 class=article-title>文件加壳方法（简单）</h2></div></a></article><article><a href=/post/vmosdl/><div class=article-details><h2 class=article-title>Android VMOS Pro(安卓虚拟机) v2.9.6 修改版</h2></div></a></article></div></div></aside><script src=//lib.baomitu.com/waline/2.14.8/waline.min.js></script>
<link href=//lib.baomitu.com/waline/2.14.8/waline.min.css rel=stylesheet><div id=waline class=waline-container></div><style>.waline-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding);--waline-font-size:var(--article-font-size)}.waline-container .wl-count{color:var(--card-text-color-main)}</style><script>Waline.init({dark:'html[data-scheme="dark"]',el:"#waline",emoji:["https://unpkg.com/@waline/emojis@1.1.0/bilibili","https://unpkg.com/@waline/emojis@1.1.0/alus","https://unpkg.com/@waline/emojis@1.1.0/bmoji"],lang:"zh-CN",locale:{admin:"站长",placeholder:"您在博客中所发表的评论仅代表您的个人观点与本博客立场无关，您发布的所有评论都需要由站长进行审核才能公开。"},pageview:!1,requiredMeta:["nick","email"],serverURL:"https://pl.xpdbk.com"})</script><footer class=site-footer><section class=copyright>&copy;
2022 -
2024 XiaoPang版权所有</section><section class=powerby><b><a href=https://shengming.xpdbk.com/ target=_blank>免责声明</a></b> <a href=https://blog.xpdbk.com/sitemap.xml target=_blank>站点地图</a> <a href=https://blog.xpdbk.com/index.xml target=_blank>RSS订阅</a><br>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计
<span>• 由LEl_FENG用❤️魔改</span></section><a href="https://icp.gov.moe/?keyword=20230087" target=_blank>萌ICP备20230087号</a><section class=powerby>作者共咕咕了 190.65k 字 · 共水了 65篇文章.</br><span><p></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-y/photoswipe/4.1.3/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-y/photoswipe/4.1.3/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/photoswipe/4.1.3/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-y/photoswipe/4.1.3/photoswipe.min.css crossorigin=anonymous></main></div><script src=/js/vibrant.min.js crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400&display=swap" rel=stylesheet><script src=https://lib.baomitu.com/ribbon.js/1.0.1/ribbon.min.js integrity=sha384-xC0eH8k8Nq6WKXlooH5kB+xWjFX/08AfAgcGiKWXj4+kYvrRuDr9MU2+MTrx2Jc6 crossorigin=anonymous size=150 alpha=0.5 zindex=-1 defer></script><!doctype html><html><head><link rel=stylesheet href=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css></head><body><div class=demo><div id=player1></div></div><script>async function loadAPlayer(){return new Promise((e,t)=>{const n=document.createElement("script");n.src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js",n.onload=e,n.onerror=t,document.head.appendChild(n)})}window.addEventListener("load",()=>{loadAPlayer().then(()=>{var e=new APlayer({element:document.getElementById("player1"),fixed:!0,autoplay:!1,mini:!0,theme:"#f8f4fc",loop:"all",order:"random",preload:"none",volume:.5,mutex:!0,listFolded:!1,listMaxHeight:90,lrcType:0,music:[{name:"超燃歌曲",url:"/music/chaoran2077.mp3",artists:"2077游戏公司",cover:"/avatar.webp"},{name:"2077边缘行者1",url:"/music/2077R.mp3",artists:"2077游戏公司",cover:"/avatar.webp"},{name:"2077边缘行者2",url:"/music/2077.mp3",artists:"2077游戏公司",cover:"/avatar.webp"}]})}).catch(e=>{console.log("APlayer加载失败:",e)})})</script></body><a href=# id=back-to-top title=返回顶部></a><style>#back-to-top{display:none;position:fixed;bottom:20px;right:55px;width:55px;height:55px;border-radius:7px;background-color:rgba(64,158,255,.5);box-shadow:var(--shadow-l2);font-size:30px;text-align:center;line-height:50px;cursor:pointer}#back-to-top:before{content:' ';display:inline-block;position:relative;top:0;transform:rotate(135deg);height:10px;width:10px;border-width:0 0 2px 2px;border-color:var(--back-to-top-color);border-style:solid}#back-to-top:hover:before{border-color:#2674e0}@media screen and (max-width:768px){#back-to-top{bottom:20px;right:20px;width:40px;height:40px;font-size:10px}}@media screen and (min-width:1024px){#back-to-top{bottom:20px;right:40px}}@media screen and (min-width:1280px){#back-to-top{bottom:20px;right:55px}}@media screen and (min-width:1536px){#back-to-top{visibility:hidden}}</style><script>function backToTop(){document.documentElement.scrollIntoView({behavior:"smooth"})}window.onload=function(){let t=this.document.documentElement.scrollTop||this.document.body.scrollTop,e=this.document.getElementById("back-to-top");t>0?e.style.display="inline":e.style.display="none"},window.onscroll=function(){let t=this.document.documentElement.scrollTop||this.document.body.scrollTop,e=this.document.getElementById("back-to-top");t<200?e.style.display="none":(e.style.display="inline",e.addEventListener("click",backToTop,!1))}</script><script src=//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js type=module></script></body></html>